{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/ui/sci-fi-lab.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Activity, Power, Settings, Cpu, Terminal, Hash, Code } from 'lucide-react';\r\n\r\n\r\n\r\n// --- 1. GLOBAL LAYOUT (TRUE IT THEME) ---\r\nexport const LabLayout = ({ children }: { children: React.ReactNode }) => {\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-100 dark:bg-[#050505] text-cyan-700 dark:text-cyan-500 font-mono selection:bg-cyan-500/30 selection:text-cyan-900 dark:selection:text-cyan-300 overflow-x-hidden relative transition-colors duration-300\">\r\n\r\n      {/* Minimalist Grid - Subtle Blue (Light) / Cyan (Dark) */}\r\n      <div className=\"fixed inset-0 z-0 pointer-events-none opacity-[0.03] dark:opacity-10 transition-opacity\"\r\n        style={{\r\n          backgroundImage: 'linear-gradient(#06b6d4 1px, transparent 1px), linear-gradient(90deg, #06b6d4 1px, transparent 1px)',\r\n          backgroundSize: '40px 40px',\r\n          maskImage: 'radial-gradient(ellipse at center, black 60%, transparent 100%)'\r\n        }}>\r\n      </div>\r\n\r\n      {/* Dark Mode Grid Override (using CSS for simplicity or just conditional rendering if needed, but here we let the light grid disappear or verify dark blend) */}\r\n      <div className=\"fixed inset-0 z-0 pointer-events-none opacity-0 dark:opacity-10 transition-opacity\"\r\n        style={{\r\n          backgroundImage: 'linear-gradient(#0891b2 0.5px, transparent 0.5px), linear-gradient(90deg, #0891b2 0.5px, transparent 0.5px)',\r\n          backgroundSize: '24px 24px',\r\n          maskImage: 'radial-gradient(ellipse at center, black 40%, transparent 100%)'\r\n        }}>\r\n      </div>\r\n\r\n      {/* Scanlines Effect (CRT) - Dark Mode Only */}\r\n      <div className=\"fixed inset-0 z-[1] pointer-events-none hidden dark:block opacity-[0.03] bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,6px_100%]\" />\r\n\r\n      {/* Main Content */}\r\n      <div className=\"relative z-10 max-w-[1800px] mx-auto p-4 md:p-6 flex flex-col h-screen\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- 2. HOLO CARD -> TERMINAL WINDOW ---\r\nexport const HoloCard = ({ children, className = \"\", title, icon: Icon, active = false }: { children: React.ReactNode, className?: string, title?: string, icon?: any, active?: boolean }) => (\r\n  <div className={`\r\n    relative backdrop-blur-md rounded-lg border-l-2 transition-all duration-300 ease-out group overflow-hidden\r\n    ${active\r\n      ? 'bg-white/90 dark:bg-[#0a0f1c]/90 border-cyan-600 dark:border-cyan-500 shadow-lg shadow-cyan-500/20 dark:shadow-cyan-500/20 ring-1 ring-cyan-500/30 dark:ring-cyan-500/20'\r\n      : 'bg-white/80 dark:bg-[#0a0f1c]/60 border-slate-300 dark:border-slate-800 hover:border-cyan-400 dark:hover:border-cyan-500 hover:bg-white dark:hover:bg-[#0f1629]/90 hover:-translate-y-1 hover:shadow-xl hover:shadow-cyan-200/50 dark:hover:shadow-cyan-500/10 group-hover:ring-1 group-hover:ring-cyan-300/30 dark:group-hover:ring-cyan-500/30'}\r\n    ${className}\r\n  `}>\r\n\r\n    {/* Scan/Sweep Effect */}\r\n    <div className=\"absolute inset-0 -translate-x-[150%] group-hover:translate-x-[150%] transition-transform duration-700 ease-linear bg-gradient-to-r from-transparent via-sky-400/20 dark:via-cyan-400/20 to-transparent z-20 pointer-events-none -skew-x-12\"></div>\r\n\r\n    {/* Terminal Header */}\r\n    {title && (\r\n      <div className={`px-3 py-2 border-b flex items-center justify-between text-[10px] font-mono tracking-wider uppercase\r\n        ${active ? 'bg-cyan-50 dark:bg-cyan-900/20 border-cyan-200 dark:border-cyan-500/30' : 'bg-slate-200/50 dark:bg-slate-900/50 border-slate-300 dark:border-slate-800'}`}>\r\n        <div className=\"flex items-center gap-2\">\r\n          {Icon ? <Icon size={14} className={active ? \"text-cyan-600 dark:text-cyan-400\" : \"text-cyan-400 dark:text-slate-500 group-hover:text-cyan-600 dark:group-hover:text-cyan-400\"} /> : <Terminal size={14} />}\r\n          <span className={`font-bold ${active ? 'text-cyan-700 dark:text-cyan-400' : 'text-slate-500 dark:text-slate-400 group-hover:text-cyan-600 dark:group-hover:text-cyan-300'}`}>\r\n            {title}\r\n          </span>\r\n        </div>\r\n        <div className=\"flex gap-1.5 opacity-50\">\r\n          <div className=\"w-2 h-2 rounded-full bg-slate-700 dark:bg-slate-600\"></div>\r\n          <div className=\"w-2 h-2 rounded-full bg-slate-700 dark:bg-slate-600\"></div>\r\n        </div>\r\n      </div>\r\n    )}\r\n    <div className=\"p-4 relative z-10\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// --- 3. MONITOR SCREEN (Keep dark but cleaner) ---\r\nexport const MonitorScreen = ({ children, label = \"EXECUTION_WINDOW\" }: { children: React.ReactNode, label?: string }) => (\r\n  <div className=\"relative rounded overflow-hidden border border-cyan-200 dark:border-slate-700 bg-white dark:bg-black shadow-inner group hover:border-cyan-400 dark:hover:border-cyan-500/50 transition-colors\">\r\n    {/* Scanline Effect */}\r\n    <div className=\"absolute inset-0 z-10 pointer-events-none opacity-20 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,6px_100%]\"></div>\r\n    <div className=\"absolute top-2 left-2 z-30 flex items-center gap-2 px-1 py-0.5 bg-white/90 dark:bg-black/80 text-[10px] font-mono text-cyan-600 dark:text-cyan-500 border border-cyan-200 dark:border-cyan-500/30\">\r\n      <span className=\"w-1.5 h-1.5 bg-cyan-500 dark:bg-cyan-500 animate-pulse\"></span>\r\n      {label}\r\n    </div>\r\n    {children}\r\n  </div>\r\n);\r\n\r\n// --- 4. NEON BUTTON (COMMAND STYLE) ---\r\n// --- 4. NEON BUTTON (COMMAND STYLE) ---\r\nexport const NeonButton = ({ children, onClick, active = false, variant = 'cyan', className = \"\" }: any) => {\r\n  // Mapping variants to IT colors: Cyan -> Blue/Green, Amber -> Orange, Red -> Red\r\n  const style = active\r\n    ? \"bg-cyan-600 text-white dark:bg-cyan-500/20 dark:text-cyan-400 border-cyan-600 dark:border-cyan-500 shadow-lg shadow-cyan-500/30 dark:shadow-cyan-500/20\"\r\n    : \"bg-white/80 dark:bg-transparent border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-400 hover:text-cyan-700 dark:hover:text-cyan-400 hover:border-cyan-500 dark:hover:border-cyan-500 hover:bg-white dark:hover:bg-cyan-950/30 hover:shadow-md dark:hover:shadow-none\";\r\n\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className={`\r\n        relative px-6 py-2.5 rounded-md border font-mono text-sm font-bold uppercase tracking-wider transition-all duration-200\r\n        active:scale-95 flex items-center justify-center gap-2 group\r\n        ${style} ${className}\r\n      `}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\n// --- 5. DATA READOUT (SYSTEM STATS) ---\r\nexport const DataReadout = ({ label, value, unit, color = \"text-cyan-400\" }: any) => (\r\n  <div className=\"flex flex-col border-l-2 border-cyan-200 dark:border-slate-800 pl-3 font-mono\">\r\n    <span className=\"text-[10px] text-slate-500 uppercase tracking-tighter mb-0.5 opacity-80\">{label}</span>\r\n    <div className=\"flex items-baseline gap-2\">\r\n      <span className={`text - xl font - bold leading - none ${color} `}>{value}</span>\r\n      <span className=\"text-xs text-slate-400\">{unit}</span>\r\n    </div>\r\n  </div>\r\n);"],"names":[],"mappings":";;;;;;;;;;;;;AACA;;;AAKO,MAAM,YAAY,CAAC,EAAE,QAAQ,EAAiC;IACnE,qBACE,6LAAC;QAAI,WAAU;;0BAGb,6LAAC;gBAAI,WAAU;gBACb,OAAO;oBACL,iBAAiB;oBACjB,gBAAgB;oBAChB,WAAW;gBACb;;;;;;0BAIF,6LAAC;gBAAI,WAAU;gBACb,OAAO;oBACL,iBAAiB;oBACjB,gBAAgB;oBAChB,WAAW;gBACb;;;;;;0BAIF,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;;AAIT;KA/Ba;AAkCN,MAAM,WAAW,CAAC,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,SAAS,KAAK,EAAmG,iBACvL,6LAAC;QAAI,WAAW,CAAC;;IAEf,EAAE,SACE,6KACA,mVAAmV;IACvV,EAAE,UAAU;EACd,CAAC;;0BAGC,6LAAC;gBAAI,WAAU;;;;;;YAGd,uBACC,6LAAC;gBAAI,WAAW,CAAC;QACf,EAAE,SAAS,2EAA2E,+EAA+E;;kCACrK,6LAAC;wBAAI,WAAU;;4BACZ,qBAAO,6LAAC;gCAAK,MAAM;gCAAI,WAAW,SAAS,qCAAqC;;;;;yFAAmG,6LAAC,yNAAQ;gCAAC,MAAM;;;;;;0CACpM,6LAAC;gCAAK,WAAW,CAAC,UAAU,EAAE,SAAS,qCAAqC,+FAA+F;0CACxK;;;;;;;;;;;;kCAGL,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;;;;;0CACf,6LAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;0BAIrB,6LAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;;MA7BM;AAmCN,MAAM,gBAAgB,CAAC,EAAE,QAAQ,EAAE,QAAQ,kBAAkB,EAAiD,iBACnH,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;;;;;0BACf,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAK,WAAU;;;;;;oBACf;;;;;;;YAEF;;;;;;;MARQ;AAcN,MAAM,aAAa,CAAC,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,KAAK,EAAE,UAAU,MAAM,EAAE,YAAY,EAAE,EAAO;IACrG,iFAAiF;IACjF,MAAM,QAAQ,SACV,4JACA;IAEJ,qBACE,6LAAC;QACC,SAAS;QACT,WAAW,CAAC;;;QAGV,EAAE,MAAM,CAAC,EAAE,UAAU;MACvB,CAAC;kBAEA;;;;;;AAGP;MAlBa;AAqBN,MAAM,cAAc,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,eAAe,EAAO,iBAC9E,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAK,WAAU;0BAA2E;;;;;;0BAC3F,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAK,WAAW,CAAC,qCAAqC,EAAE,MAAM,CAAC,CAAC;kCAAG;;;;;;kCACpE,6LAAC;wBAAK,WAAU;kCAA0B;;;;;;;;;;;;;;;;;;MALnC"}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/ui/theme-toggle.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport { Moon, Sun } from \"lucide-react\"\r\nimport { useTheme } from \"next-themes\"\r\n\r\nexport function ThemeToggle() {\r\n    const { setTheme, resolvedTheme } = useTheme()\r\n\r\n    return (\r\n        <button\r\n            onClick={() => setTheme(resolvedTheme === \"dark\" ? \"light\" : \"dark\")}\r\n            className=\"relative p-2.5 rounded-full border border-sky-200 dark:border-cyan-800/50 bg-white dark:bg-[#0a0f1c] hover:bg-sky-50 dark:hover:bg-cyan-950/30 hover:border-sky-400 dark:hover:border-cyan-500 text-sky-500 dark:text-cyan-400 shadow-sm hover:shadow-[0_0_15px_rgba(14,165,233,0.3)] dark:hover:shadow-[0_0_15px_rgba(6,182,212,0.3)] transition-all duration-300 hover:-translate-y-0.5 active:translate-y-0 active:scale-95 group\"\r\n            title=\"Toggle Theme\"\r\n        >\r\n            <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all duration-500 dark:-rotate-90 dark:scale-0 group-hover:text-amber-500\" />\r\n            <Moon className=\"absolute top-2.5 left-2.5 h-5 w-5 rotate-90 scale-0 transition-all duration-500 dark:rotate-0 dark:scale-100 dark:group-hover:text-cyan-300\" />\r\n            <span className=\"sr-only\">Toggle theme</span>\r\n        </button>\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAAA;AACA;;;AAJA;;;AAMO,SAAS;;IACZ,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,IAAA,+JAAQ;IAE5C,qBACI,6LAAC;QACG,SAAS,IAAM,SAAS,kBAAkB,SAAS,UAAU;QAC7D,WAAU;QACV,OAAM;;0BAEN,6LAAC,0MAAG;gBAAC,WAAU;;;;;;0BACf,6LAAC,6MAAI;gBAAC,WAAU;;;;;;0BAChB,6LAAC;gBAAK,WAAU;0BAAU;;;;;;;;;;;;AAGtC;GAdgB;;QACwB,+JAAQ;;;KADhC"}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/physics-intro.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useState, useEffect } from \"react\"\r\nimport {\r\n  Activity, Waves, Mic, Anchor, Aperture, Infinity, TrendingDown, Zap,\r\n  Database, Cpu, ArrowUpRight, Box, Trash2, Atom, Terminal, FileCode, FlaskConical\r\n} from \"lucide-react\"\r\n// Sửa đường dẫn import cho đúng cấu trúc thư mục\r\nimport { HoloCard, NeonButton } from \"../ui/sci-fi-lab\"\r\n\r\nconst EXPERIMENTS = [\r\n  {\r\n    id: \"spring-oscillator\",\r\n    title: \"Con lắc lò xo\",\r\n    icon: Activity,\r\n    code: \"EXP-01\",\r\n    desc: \"Mô phỏng dao động điều hòa lò xo ngang/dọc.\"\r\n  },\r\n  {\r\n    id: \"simple-pendulum\",\r\n    title: \"Con lắc đơn\",\r\n    icon: Anchor,\r\n    code: \"EXP-02\",\r\n    desc: \"Khảo sát chu kỳ và quỹ đạo con lắc đơn.\"\r\n  },\r\n  {\r\n    id: \"damped-oscillation\",\r\n    title: \"Dao động tắt dần\",\r\n    icon: TrendingDown,\r\n    code: \"EXP-03\",\r\n    desc: \"Sự suy giảm năng lượng trong môi trường cản.\"\r\n  },\r\n  {\r\n    id: \"harmonic-oscillation\",\r\n    title: \"Dao động điều hòa\",\r\n    icon: Zap,\r\n    code: \"EXP-04\",\r\n    desc: \"Mối liên hệ chuyển động tròn đều.\"\r\n  },\r\n  {\r\n    id: \"mechanical-waves\",\r\n    title: \"Sóng cơ\",\r\n    icon: Waves,\r\n    code: \"EXP-05\",\r\n    desc: \"Truyền sóng ngang và dọc trong môi trường.\"\r\n  },\r\n  {\r\n    id: \"sound-waves\",\r\n    title: \"Sóng âm\",\r\n    icon: Mic,\r\n    code: \"EXP-06\",\r\n    desc: \"Phân tích tần số và biên độ âm thanh.\"\r\n  },\r\n  {\r\n    id: \"wave-interference\",\r\n    title: \"Giao thoa sóng\",\r\n    icon: Aperture,\r\n    code: \"EXP-07\",\r\n    desc: \"Hiện tượng giao thoa hai nguồn kết hợp.\"\r\n  },\r\n  {\r\n    id: \"standing-waves\",\r\n    title: \"Sóng dừng\",\r\n    icon: Infinity,\r\n    code: \"EXP-08\",\r\n    desc: \"Bụng sóng và nút sóng trên dây.\"\r\n  },\r\n  {\r\n    id: \"sound-speed\",\r\n    title: \"Đo tốc độ truyền âm\",\r\n    icon: Mic,\r\n    code: \"EXP-09\",\r\n    desc: \"Đo tốc độ âm bằng cột khí cộng hưởng.\"\r\n  },\r\n]\r\n\r\n// Tách component Typewriter để tái sử dụng\r\nconst Typewriter = ({ text, speed = 30, delay = 0 }: { text: string, speed?: number, delay?: number }) => {\r\n  const [displayText, setDisplayText] = useState('');\r\n  const [showCursor, setShowCursor] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let timeout: NodeJS.Timeout;\r\n    const startTyping = () => {\r\n      let i = 0;\r\n      setDisplayText('');\r\n      const interval = setInterval(() => {\r\n        setDisplayText(text.substring(0, i + 1));\r\n        i++;\r\n        if (i === text.length) clearInterval(interval);\r\n      }, speed);\r\n    };\r\n\r\n    timeout = setTimeout(startTyping, delay);\r\n    return () => clearTimeout(timeout);\r\n  }, [text, speed, delay]);\r\n\r\n  // Cursor blinking effect\r\n  useEffect(() => {\r\n    const cursorInterval = setInterval(() => setShowCursor(v => !v), 500);\r\n    return () => clearInterval(cursorInterval);\r\n  }, []);\r\n\r\n  return (\r\n    <span className=\"font-sans\">\r\n      {displayText}\r\n      <span className={`${showCursor ? 'opacity-100' : 'opacity-0'} text-cyan-500 font-bold`}>_</span>\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default function PhysicsIntro({ onSelectExperiment }: { onSelectExperiment?: (id: string) => void }) {\r\n  const [customModules, setCustomModules] = useState<any[]>([])\r\n\r\n  useEffect(() => {\r\n    fetch('/api/modules')\r\n      .then(res => res.json())\r\n      .then(data => setCustomModules(data))\r\n      .catch(err => console.error(err))\r\n  }, [])\r\n\r\n  const handleDelete = async (e: React.MouseEvent, id: string) => {\r\n    e.stopPropagation()\r\n    if (!confirm(\"Bạn có chắc muốn xóa module này không?\")) return\r\n\r\n    try {\r\n      const res = await fetch('/api/modules', {\r\n        method: 'DELETE',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ id })\r\n      })\r\n      if (res.ok) {\r\n        setCustomModules(prev => prev.filter(m => m.id !== id))\r\n      } else {\r\n        alert(\"Xóa thất bại\")\r\n      }\r\n    } catch (err) {\r\n      console.error(err)\r\n      alert(\"Có lỗi xảy ra\")\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Hero Section */}\r\n      <div className=\"relative rounded-xl overflow-hidden border border-slate-300 dark:border-slate-800 bg-white/70 dark:bg-slate-900/50 py-8 pr-8 pl-20 md:pl-24 md:py-12 md:pr-12 shadow-sm dark:shadow-none group transition-all duration-300 hover:shadow-md hover:border-cyan-400/50 hover:shadow-cyan-500/20 dark:hover:shadow-cyan-500/20 dark:hover:border-cyan-500/50\">\r\n\r\n        {/* Left Tech Sidebar - \"Pro Dev\" Decoration */}\r\n        <div className=\"absolute left-0 top-0 bottom-0 w-14 border-r border-slate-300 dark:border-slate-800 bg-slate-50/50 dark:bg-black/20 flex flex-col items-center py-6 gap-6 z-20 backdrop-blur-sm\">\r\n          {/* Top Status Dots */}\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"w-1.5 h-1.5 rounded-full bg-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.8)] animate-pulse\"></div>\r\n            <div className=\"w-1.5 h-1.5 rounded-full bg-slate-300 dark:bg-slate-700\"></div>\r\n            <div className=\"w-1.5 h-1.5 rounded-full bg-slate-300 dark:bg-slate-700\"></div>\r\n          </div>\r\n\r\n          {/* Vertical Line */}\r\n          <div className=\"w-[1px] flex-1 bg-gradient-to-b from-slate-300 via-cyan-400/50 to-slate-300 dark:from-slate-800 dark:via-cyan-900 dark:to-slate-800 opacity-50\"></div>\r\n\r\n          {/* Vertical Text - REMOVED */}\r\n          <div className=\"flex-1\"></div>\r\n\r\n          {/* Bottom Code Block Decor */}\r\n          <div className=\"flex flex-col gap-1 opacity-40\">\r\n            <div className=\"w-4 h-[2px] bg-cyan-500\"></div>\r\n            <div className=\"w-2 h-[2px] bg-slate-400\"></div>\r\n            <div className=\"w-3 h-[2px] bg-slate-400\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Abstract Background Code Rain (Static for now, can be animated) */}\r\n        <div className=\"absolute inset-0 overflow-hidden opacity-[0.03] dark:opacity-20 pointer-events-none select-none font-mono text-[10px] leading-3 text-cyan-500 dark:text-cyan-900\">\r\n          {Array.from({ length: 20 }).map((_, i) => (\r\n            <div key={i} className=\"whitespace-nowrap transform -rotate-12 translate-y-[-50%]\" style={{ marginLeft: `${i * 5}%` }}>\r\n              {`0101011010101010101010101010101010101010101010101`}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Right 3D Animated Element - Solar System */}\r\n        <div className=\"absolute top-1/2 right-4 md:right-16 -translate-y-1/2 w-64 h-64 md:w-80 md:h-80 pointer-events-none opacity-90 dark:opacity-80 scale-65 md:scale-90\">\r\n          <div className=\"relative w-full h-full\">\r\n            {/* Sun */}\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-yellow-500 rounded-full shadow-[0_0_50px_rgba(234,179,8,0.6)] animate-pulse z-10\"></div>\r\n\r\n            {/* Mercury Orbit & Planet (Right) */}\r\n            <div className=\"absolute inset-[38%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '4s' }}>\r\n              <div className=\"absolute top-1/2 right-0 translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-slate-500 dark:bg-slate-400 rounded-full shadow-sm\"></div>\r\n            </div>\r\n\r\n            {/* Venus Orbit & Planet (Bottom) */}\r\n            <div className=\"absolute inset-[32%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '7s' }}>\r\n              <div className=\"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-2.5 h-2.5 bg-orange-400 dark:bg-orange-300 rounded-full shadow-sm\"></div>\r\n            </div>\r\n\r\n            {/* Earth Orbit & Planet (Top) + Moon */}\r\n            <div className=\"absolute inset-[26%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '12s' }}>\r\n              <div className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 flex items-center justify-center\">\r\n                {/* Earth */}\r\n                <div className=\"w-3 h-3 bg-blue-600 dark:bg-blue-500 rounded-full shadow-[0_0_8px_rgba(37,99,235,0.8)] relative z-10\"></div>\r\n                {/* Moon Orbit & Moon */}\r\n                <div className=\"absolute w-6 h-6 border border-slate-400/30 rounded-full animate-spin\" style={{ animationDuration: '2s' }}>\r\n                  <div className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-1 bg-slate-300 rounded-full\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Mars Orbit & Planet (Left) */}\r\n            <div className=\"absolute inset-[20%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '18s' }}>\r\n              <div className=\"absolute top-1/2 left-0 -translate-x-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-red-500 dark:bg-red-400 rounded-full shadow-sm\"></div>\r\n            </div>\r\n\r\n            {/* Jupiter Orbit & Planet (Bottom Right) */}\r\n            <div className=\"absolute inset-[12%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '30s' }}>\r\n              <div className=\"absolute bottom-[14.6%] right-[14.6%] translate-x-1/2 translate-y-1/2 w-6 h-6 bg-orange-300 dark:bg-orange-200 rounded-full shadow-sm flex items-center justify-center overflow-hidden\">\r\n                <div className=\"w-full h-[2px] bg-orange-400/50 mt-1\"></div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Saturn Orbit & Planet (Top Left) */}\r\n            <div className=\"absolute inset-[4%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '45s' }}>\r\n              <div className=\"absolute top-[14.6%] left-[14.6%] -translate-x-1/2 -translate-y-1/2 w-5 h-5 bg-yellow-300 dark:bg-yellow-200 rounded-full shadow-sm flex items-center justify-center\">\r\n                <div className=\"absolute w-8 h-2 border border-slate-500/50 dark:border-slate-400/50 rounded-full bg-slate-400/30 dark:bg-slate-300/20 transform -rotate-12\"></div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Uranus Orbit & Planet (Bottom Left) */}\r\n            <div className=\"absolute inset-[-4%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '60s' }}>\r\n              <div className=\"absolute bottom-[14.6%] left-[14.6%] -translate-x-1/2 translate-y-1/2 w-4 h-4 bg-cyan-300 dark:bg-cyan-400 rounded-full shadow-sm\"></div>\r\n            </div>\r\n\r\n            {/* Neptune Orbit & Planet (Top Right) */}\r\n            <div className=\"absolute inset-[-12%] border border-slate-400/50 dark:border-slate-600/30 rounded-full animate-spin\" style={{ animationDuration: '75s' }}>\r\n              <div className=\"absolute top-[14.6%] right-[14.6%] translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-blue-700 dark:bg-blue-600 rounded-full shadow-sm\"></div>\r\n            </div>\r\n\r\n            {/* Asteroid Belt (Decorative) */}\r\n            <div className=\"absolute inset-[10%] border border-dashed border-slate-500/20 dark:border-slate-400/10 rounded-full animate-spin-slow pointer-events-none\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"relative z-10 max-w-2xl\">\r\n          {/* Version Badge */}\r\n          <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded border border-cyan-200 dark:border-cyan-800 bg-white dark:bg-cyan-900/20 text-cyan-700 dark:text-cyan-400 text-[10px] font-bold uppercase tracking-widest mb-6 shadow-sm\">\r\n            <span className=\"relative flex h-2 w-2\">\r\n              <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 dark:bg-cyan-400 opacity-75\"></span>\r\n              <span className=\"relative inline-flex rounded-full h-2 w-2 bg-cyan-600 dark:bg-cyan-500\"></span>\r\n            </span>\r\n            <span>Phòng thí nghiệm ảo v2.0 // Minimalist</span>\r\n          </div>\r\n\r\n          <h1 className=\"text-4xl md:text-5xl font-bold text-slate-900 dark:text-white mb-6 leading-snug\">\r\n            Chào mừng đến với <br />\r\n            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-blue-600 dark:from-cyan-400 dark:to-blue-500 relative inline-block tracking-wide mt-2 drop-shadow-sm\">\r\n              PHÒNG THÍ NGHIỆM VẬT LÝ\r\n              <span className=\"absolute -inset-1 blur-xl bg-cyan-400/20 dark:bg-cyan-500/20 animate-pulse rounded-full opacity-50\"></span>\r\n            </span>\r\n          </h1>\r\n\r\n          <div className=\"min-h-[80px] text-slate-500 dark:text-slate-400 text-base md:text-lg mb-8 leading-relaxed font-mono border-l-[3px] border-cyan-400 dark:border-cyan-500/50 pl-4 py-1 bg-white/40 dark:bg-transparent rounded-r-lg\">\r\n            <span className=\"text-cyan-600 dark:text-cyan-400 mr-2 font-bold\">{'>'}</span>\r\n            <Typewriter\r\n              text=\"Hệ thống mô phỏng tương tác cao cấp dành cho Vật lý 11. Truy cập dữ liệu thời gian thực, đồ thị năng lượng và các tham số vật lý chính xác...\"\r\n              speed={20}\r\n              delay={500}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex gap-4\">\r\n            <NeonButton onClick={() => onSelectExperiment && onSelectExperiment('harmonic-oscillation')} active={true}>\r\n              <FileCode className=\"mr-2\" size={16} /> BẮT ĐẦU NGAY\r\n            </NeonButton>\r\n            <NeonButton onClick={() => window.open('https://github.com', '_blank')}>\r\n              <Terminal className=\"mr-2\" size={16} /> TÀI LIỆU HƯỚNG DẪN\r\n            </NeonButton>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Grid Dashboard */}\r\n      <div>\r\n        <div className=\"flex items-center gap-2 mb-6 border-b border-slate-300 dark:border-slate-800 pb-2\">\r\n          <Database size={18} className=\"text-cyan-600 dark:text-cyan-500\" />\r\n          <h2 className=\"text-sm font-bold text-cyan-800 dark:text-slate-300 uppercase tracking-widest font-mono\">Danh mục thí nghiệm</h2>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {EXPERIMENTS.map((exp) => (\r\n            <HoloCard key={exp.id} className=\"h-full flex flex-col hover:-translate-y-1 hover:shadow-lg transition-transform\">\r\n              <div className=\"flex justify-between items-start mb-4\">\r\n                <div className=\"p-2.5 rounded bg-white dark:bg-slate-900/50 border border-cyan-100 dark:border-slate-700 text-cyan-600 dark:text-cyan-400 group-hover:text-cyan-500 dark:group-hover:text-cyan-500 group-hover:border-cyan-400 dark:group-hover:border-cyan-500/50 transition-colors\">\r\n                  <exp.icon size={20} />\r\n                </div>\r\n                <span className=\"text-[10px] font-mono text-cyan-400 dark:text-slate-600 font-bold border border-cyan-100 dark:border-slate-800 px-1.5 py-0.5 rounded group-hover:text-cyan-700 dark:group-hover:text-cyan-500 group-hover:border-cyan-300 dark:group-hover:border-cyan-900 bg-white dark:bg-transparent\">\r\n                  {exp.code}\r\n                </span>\r\n              </div>\r\n\r\n              <h3 className=\"text-lg font-bold text-cyan-900 dark:text-slate-200 mb-2 group-hover:text-cyan-700 dark:group-hover:text-cyan-400\">{exp.title}</h3>\r\n              <p className=\"text-sm text-slate-600 dark:text-slate-500 leading-relaxed mb-6 flex-1\">{exp.desc}</p>\r\n\r\n              <button\r\n                onClick={() => onSelectExperiment && onSelectExperiment(exp.id)}\r\n                className=\"w-full py-2 rounded border border-slate-300 dark:border-slate-700 text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 hover:bg-cyan-600 hover:text-white hover:border-cyan-600 dark:hover:bg-slate-800 dark:hover:text-cyan-400 dark:hover:border-cyan-500 transition-all flex items-center justify-center gap-2 group-hover:bg-white dark:group-hover:bg-slate-800\"\r\n              >\r\n                Truy cập <ArrowUpRight size={14} />\r\n              </button>\r\n            </HoloCard>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Custom Modules Section */}\r\n\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1137, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/ui/control-panel.tsx"],"sourcesContent":["import type React from \"react\"\ninterface ControlPanelProps {\n  title: string\n  children: React.ReactNode\n}\n\nexport default function ControlPanel({ title, children }: ControlPanelProps) {\n  return (\n    <div className=\"bg-[#16213e] rounded-lg p-4 border border-cyan-900/50\">\n      <h3 className=\"text-cyan-400 font-semibold mb-3\">{title}</h3>\n      {children}\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;;AAMe,SAAS,aAAa,EAAE,KAAK,EAAE,QAAQ,EAAqB;IACzE,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAAoC;;;;;;YACjD;;;;;;;AAGP;KAPwB"}},
    {"offset": {"line": 1173, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/hooks/use-spring-physics.ts"],"sourcesContent":["import React, { useState, useRef, useCallback } from \"react\"\r\n\r\nexport interface SpringParams {\r\n    mass: number // kg\r\n    k: number // N/m spring constant\r\n    amplitude: number // cm (converted effectively to initial displacement)\r\n    phase: number // radians\r\n}\r\n\r\nexport interface PhysicsState {\r\n    t: number\r\n    x: number // cm\r\n    v: number // cm/s\r\n    a: number // cm/s^2\r\n    force: number // N\r\n    wd: number // Joules\r\n    wt: number // Joules\r\n    wTotal: number // Joules\r\n}\r\n\r\nexport const useSpringPhysics = (initialParams: SpringParams) => {\r\n    const [isPlaying, setIsPlaying] = useState(false)\r\n    const [params, setParams] = useState(initialParams)\r\n    const [time, setTime] = useState(0)\r\n\r\n    // Mutable refs for high-frequency updates without re-renders\r\n    const timeRef = useRef(0)\r\n    const historyRef = useRef<PhysicsState[]>([])\r\n\r\n    // Derived constants\r\n    const omega = Math.sqrt(params.k / params.mass)\r\n    const period = (2 * Math.PI) / omega\r\n    const frequency = omega / (2 * Math.PI)\r\n    const vmax = omega * params.amplitude\r\n    const amax = omega * omega * params.amplitude\r\n    const deltaL0 = (params.mass * 9.8) / params.k // Static extension (m)\r\n\r\n    const calculateState = useCallback(\r\n        (t: number): PhysicsState => {\r\n            // x = A cos(wt + phi)\r\n            const x = params.amplitude * Math.cos(omega * t + params.phase)\r\n            const v = -params.amplitude * omega * Math.sin(omega * t + params.phase)\r\n            const a = -params.amplitude * omega * omega * Math.cos(omega * t + params.phase)\r\n\r\n            // Force F = -kx (Hooke's law relative to equilibrium)\r\n            // Note: x is in cm, so we divide by 100 for Force calc (N)\r\n            const force = -params.k * (x / 100)\r\n\r\n            // Energy\r\n            const x_m = x / 100\r\n            const v_m = v / 100\r\n            const wt = 0.5 * params.k * x_m * x_m\r\n            const wd = 0.5 * params.mass * v_m * v_m\r\n            const wTotal = wt + wd\r\n\r\n            return { t, x, v, a, force, wt, wd, wTotal }\r\n        },\r\n        [params, omega]\r\n    )\r\n\r\n    const step = useCallback((dt: number) => {\r\n        timeRef.current += dt\r\n        // Prevent negative time\r\n        if (timeRef.current < 0) timeRef.current = 0\r\n\r\n        const state = calculateState(timeRef.current)\r\n\r\n        // Update history\r\n        historyRef.current.push(state)\r\n        if (historyRef.current.length > 500) historyRef.current.shift()\r\n\r\n        // Sync React state for low-frequency UI updates if needed\r\n        // (For high-perf canvas, we usually read refs directly, but we setTime to trigger animation effects if needed)\r\n        setTime(timeRef.current)\r\n\r\n        return state\r\n    }, [calculateState])\r\n\r\n    const reset = useCallback(() => {\r\n        setIsPlaying(false)\r\n        timeRef.current = 0\r\n        setTime(0)\r\n        historyRef.current = []\r\n    }, [])\r\n\r\n    return React.useMemo(() => ({\r\n        params,\r\n        setParams,\r\n        isPlaying,\r\n        setIsPlaying,\r\n        time,\r\n        timeRef,\r\n        historyRef,\r\n        calculateState,\r\n        step,\r\n        reset,\r\n        derived: {\r\n            omega,\r\n            period,\r\n            frequency,\r\n            vmax,\r\n            amax,\r\n            deltaL0\r\n        }\r\n    }), [params, isPlaying, time, calculateState, step, reset, omega, period, frequency, vmax, amax, deltaL0])\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAoBO,MAAM,mBAAmB,CAAC;;IAC7B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IAEjC,6DAA6D;IAC7D,MAAM,UAAU,IAAA,uKAAM,EAAC;IACvB,MAAM,aAAa,IAAA,uKAAM,EAAiB,EAAE;IAE5C,oBAAoB;IACpB,MAAM,QAAQ,KAAK,IAAI,CAAC,OAAO,CAAC,GAAG,OAAO,IAAI;IAC9C,MAAM,SAAS,AAAC,IAAI,KAAK,EAAE,GAAI;IAC/B,MAAM,YAAY,QAAQ,CAAC,IAAI,KAAK,EAAE;IACtC,MAAM,OAAO,QAAQ,OAAO,SAAS;IACrC,MAAM,OAAO,QAAQ,QAAQ,OAAO,SAAS;IAC7C,MAAM,UAAU,AAAC,OAAO,IAAI,GAAG,MAAO,OAAO,CAAC,CAAC,uBAAuB;;IAEtE,MAAM,iBAAiB,IAAA,4KAAW;wDAC9B,CAAC;YACG,sBAAsB;YACtB,MAAM,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,CAAC,QAAQ,IAAI,OAAO,KAAK;YAC9D,MAAM,IAAI,CAAC,OAAO,SAAS,GAAG,QAAQ,KAAK,GAAG,CAAC,QAAQ,IAAI,OAAO,KAAK;YACvE,MAAM,IAAI,CAAC,OAAO,SAAS,GAAG,QAAQ,QAAQ,KAAK,GAAG,CAAC,QAAQ,IAAI,OAAO,KAAK;YAE/E,sDAAsD;YACtD,2DAA2D;YAC3D,MAAM,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG;YAElC,SAAS;YACT,MAAM,MAAM,IAAI;YAChB,MAAM,MAAM,IAAI;YAChB,MAAM,KAAK,MAAM,OAAO,CAAC,GAAG,MAAM;YAClC,MAAM,KAAK,MAAM,OAAO,IAAI,GAAG,MAAM;YACrC,MAAM,SAAS,KAAK;YAEpB,OAAO;gBAAE;gBAAG;gBAAG;gBAAG;gBAAG;gBAAO;gBAAI;gBAAI;YAAO;QAC/C;uDACA;QAAC;QAAQ;KAAM;IAGnB,MAAM,OAAO,IAAA,4KAAW;8CAAC,CAAC;YACtB,QAAQ,OAAO,IAAI;YACnB,wBAAwB;YACxB,IAAI,QAAQ,OAAO,GAAG,GAAG,QAAQ,OAAO,GAAG;YAE3C,MAAM,QAAQ,eAAe,QAAQ,OAAO;YAE5C,iBAAiB;YACjB,WAAW,OAAO,CAAC,IAAI,CAAC;YACxB,IAAI,WAAW,OAAO,CAAC,MAAM,GAAG,KAAK,WAAW,OAAO,CAAC,KAAK;YAE7D,0DAA0D;YAC1D,+GAA+G;YAC/G,QAAQ,QAAQ,OAAO;YAEvB,OAAO;QACX;6CAAG;QAAC;KAAe;IAEnB,MAAM,QAAQ,IAAA,4KAAW;+CAAC;YACtB,aAAa;YACb,QAAQ,OAAO,GAAG;YAClB,QAAQ;YACR,WAAW,OAAO,GAAG,EAAE;QAC3B;8CAAG,EAAE;IAEL,OAAO,wKAAK,CAAC,OAAO;oCAAC,IAAM,CAAC;gBACxB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA,SAAS;oBACL;oBACA;oBACA;oBACA;oBACA;oBACA;gBACJ;YACJ,CAAC;mCAAG;QAAC;QAAQ;QAAW;QAAM;QAAgB;QAAM;QAAO;QAAO;QAAQ;QAAW;QAAM;QAAM;KAAQ;AAC7G;GArFa"}},
    {"offset": {"line": 1295, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/hooks/use-canvas-scale.ts"],"sourcesContent":["\r\nimport { useEffect, useState, RefObject } from \"react\"\r\n\r\nexport const useCanvasScale = (containerRef: RefObject<HTMLDivElement | null>) => {\r\n    const [size, setSize] = useState({ width: 0, height: 0 })\r\n    const [pixelRatio, setPixelRatio] = useState(1)\r\n\r\n    useEffect(() => {\r\n        // Check if we are in a browser environment\r\n        if (typeof window === \"undefined\" || !containerRef.current) return\r\n\r\n        const updateSize = () => {\r\n            if (containerRef.current) {\r\n                const { clientWidth, clientHeight } = containerRef.current\r\n                setSize({ width: clientWidth, height: clientHeight })\r\n                setPixelRatio(window.devicePixelRatio || 1)\r\n            }\r\n        }\r\n\r\n        // Initial size\r\n        updateSize()\r\n\r\n        const resizeObserver = new ResizeObserver(() => {\r\n            updateSize()\r\n        })\r\n\r\n        resizeObserver.observe(containerRef.current)\r\n\r\n        return () => {\r\n            resizeObserver.disconnect()\r\n        }\r\n    }, [containerRef])\r\n\r\n    return { width: size.width, height: size.height, pixelRatio }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;;AAEO,MAAM,iBAAiB,CAAC;;IAC3B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;QAAE,OAAO;QAAG,QAAQ;IAAE;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,IAAA,0KAAS;oCAAC;YACN,2CAA2C;YAC3C,IAAI,+CAAkB,eAAe,CAAC,aAAa,OAAO,EAAE;YAE5D,MAAM;uDAAa;oBACf,IAAI,aAAa,OAAO,EAAE;wBACtB,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,GAAG,aAAa,OAAO;wBAC1D,QAAQ;4BAAE,OAAO;4BAAa,QAAQ;wBAAa;wBACnD,cAAc,OAAO,gBAAgB,IAAI;oBAC7C;gBACJ;;YAEA,eAAe;YACf;YAEA,MAAM,iBAAiB,IAAI;4CAAe;oBACtC;gBACJ;;YAEA,eAAe,OAAO,CAAC,aAAa,OAAO;YAE3C;4CAAO;oBACH,eAAe,UAAU;gBAC7B;;QACJ;mCAAG;QAAC;KAAa;IAEjB,OAAO;QAAE,OAAO,KAAK,KAAK;QAAE,QAAQ,KAAK,MAAM;QAAE;IAAW;AAChE;GA/Ba"}},
    {"offset": {"line": 1356, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/lib/canvas-utils.ts"],"sourcesContent":["\r\nexport const drawSpring = (\r\n    ctx: CanvasRenderingContext2D,\r\n    startX: number,\r\n    startY: number,\r\n    endX: number,\r\n    endY: number,\r\n    coils = 12,\r\n    width = 20,\r\n    strokeStyle = \"#cbd5e1\",\r\n    lineWidth = 2\r\n) => {\r\n    const dx = endX - startX\r\n    const dy = endY - startY\r\n    const len = Math.sqrt(dx * dx + dy * dy)\r\n    const angle = Math.atan2(dy, dx)\r\n\r\n    ctx.save()\r\n    ctx.translate(startX, startY)\r\n    ctx.rotate(angle)\r\n\r\n    ctx.strokeStyle = strokeStyle\r\n    ctx.lineWidth = lineWidth\r\n    ctx.lineCap = \"round\"\r\n    ctx.lineJoin = \"round\"\r\n\r\n    ctx.beginPath()\r\n    ctx.moveTo(0, 0)\r\n    ctx.lineTo(10, 0)\r\n\r\n    const step = (len - 20) / coils\r\n    for (let i = 0; i < coils; i++) {\r\n        const x = 10 + i * step\r\n        ctx.lineTo(x + step * 0.25, width)\r\n        ctx.lineTo(x + step * 0.75, -width)\r\n    }\r\n\r\n    ctx.lineTo(len - 10, 0)\r\n    ctx.lineTo(len, 0)\r\n\r\n    ctx.stroke()\r\n    ctx.restore()\r\n}\r\n\r\nexport const drawArrow = (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    len: number,\r\n    color: string,\r\n    label: string = \"\",\r\n    direction: \"horizontal\" | \"vertical\" = \"horizontal\"\r\n) => {\r\n    if (Math.abs(len) < 2) return // Don't draw tiny arrows\r\n\r\n    ctx.save()\r\n    ctx.strokeStyle = color\r\n    ctx.fillStyle = color\r\n    ctx.lineWidth = 2\r\n\r\n    // Calculate end points based on direction\r\n    const endX = x + (direction === \"horizontal\" ? len : 0)\r\n    const endY = y + (direction === \"vertical\" ? len : 0)\r\n\r\n    // Determine angle for the arrow head\r\n    let angle = 0\r\n    if (direction === \"horizontal\") {\r\n        angle = len > 0 ? 0 : Math.PI;\r\n    } else {\r\n        angle = len > 0 ? Math.PI / 2 : -Math.PI / 2;\r\n    }\r\n\r\n    ctx.beginPath()\r\n    ctx.moveTo(x, y)\r\n    ctx.lineTo(endX, endY)\r\n    ctx.stroke()\r\n\r\n    // Draw arrow head\r\n    const headLen = 6\r\n    ctx.save()\r\n    ctx.translate(endX, endY)\r\n    ctx.rotate(angle)\r\n    ctx.beginPath()\r\n    ctx.moveTo(0, 0)\r\n    ctx.lineTo(-headLen, -headLen / 2)\r\n    ctx.lineTo(-headLen, headLen / 2)\r\n    ctx.lineTo(0, 0)\r\n    ctx.fill()\r\n    ctx.restore()\r\n\r\n    // Draw label\r\n    if (label) {\r\n        ctx.font = \"bold 12px sans-serif\"\r\n        ctx.textAlign = \"center\"\r\n        ctx.textBaseline = \"middle\"\r\n\r\n        let labelX = endX\r\n        let labelY = endY\r\n\r\n        if (direction === \"horizontal\") {\r\n            labelX += len > 0 ? 15 : -15\r\n        } else {\r\n            labelY += len > 0 ? 15 : -15\r\n        }\r\n\r\n        ctx.fillStyle = color\r\n        ctx.fillText(label, labelX, labelY)\r\n    }\r\n\r\n    ctx.restore()\r\n}\r\n\r\nexport const drawGrid = (ctx: CanvasRenderingContext2D, width: number, height: number, step = 40, color = \"#1e293b\") => {\r\n    ctx.save()\r\n    ctx.strokeStyle = color\r\n    ctx.lineWidth = 1\r\n    ctx.beginPath()\r\n    for (let i = 0; i < width; i += step) {\r\n        ctx.moveTo(i, 0)\r\n        ctx.lineTo(i, height)\r\n    }\r\n    for (let i = 0; i < height; i += step) {\r\n        ctx.moveTo(0, i)\r\n        ctx.lineTo(width, i)\r\n    }\r\n    ctx.stroke()\r\n    ctx.restore()\r\n}\r\n\r\nexport const clearCanvas = (ctx: CanvasRenderingContext2D) => {\r\n    const { width, height } = ctx.canvas;\r\n    ctx.clearRect(0, 0, width, height);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1468, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/oscillator-view.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useRef, useEffect, useState, useCallback } from \"react\"\r\nimport { useCanvasScale } from \"@/hooks/use-canvas-scale\"\r\nimport { drawSpring, drawArrow } from \"@/lib/canvas-utils\"\r\nimport { SpringParams, PhysicsState } from \"@/hooks/use-spring-physics\"\r\n\r\ninterface OscillatorViewProps {\r\n    sysId: string\r\n    params: SpringParams\r\n    state: PhysicsState\r\n    derived: {\r\n        omega: number\r\n        period: number\r\n        frequency: number\r\n        vmax: number\r\n        amax: number\r\n        deltaL0: number\r\n    }\r\n    layout: \"horizontal\" | \"vertical\"\r\n    onParameterChange: (newParams: Partial<SpringParams>) => void\r\n    onInteractionStart: () => void\r\n    onInteractionEnd: () => void\r\n    label?: string\r\n    colorTheme?: string\r\n}\r\n\r\nexport default function OscillatorView({\r\n    sysId,\r\n    params,\r\n    state,\r\n    derived,\r\n    layout,\r\n    onParameterChange,\r\n    onInteractionStart,\r\n    onInteractionEnd,\r\n    label,\r\n    colorTheme = \"blue\"\r\n}: OscillatorViewProps) {\r\n    const containerRef = useRef<HTMLDivElement>(null)\r\n    const canvasRef = useRef<HTMLCanvasElement>(null)\r\n\r\n    const [isDragging, setIsDragging] = useState(false)\r\n    const [localTime, setLocalTime] = useState(0)\r\n\r\n    // Responsive Hooks\r\n    const { width, height, pixelRatio } = useCanvasScale(containerRef)\r\n\r\n    // Interaction Check\r\n    const checkInteraction = useCallback((clientX: number, clientY: number) => {\r\n        if (!canvasRef.current || !width || !height) return null\r\n\r\n        const rect = canvasRef.current.getBoundingClientRect()\r\n        const x = clientX - rect.left\r\n        const y = clientY - rect.top\r\n\r\n        let massX, massY\r\n\r\n        if (layout === \"horizontal\") {\r\n            massX = (width / 2) + state.x\r\n            massY = height / 2\r\n        } else {\r\n            massX = width / 2\r\n            massY = (height / 2) + state.x\r\n        }\r\n\r\n        const dist = Math.sqrt(Math.pow(x - massX, 2) + Math.pow(y - massY, 2))\r\n        if (dist < 40) return true\r\n        return false\r\n    }, [layout, width, height, state.x])\r\n\r\n    const handlePointerDown = (e: React.PointerEvent) => {\r\n        if (checkInteraction(e.clientX, e.clientY)) {\r\n            setIsDragging(true)\r\n            onInteractionStart() // Pause parent\r\n            e.currentTarget.setPointerCapture(e.pointerId)\r\n        }\r\n    }\r\n\r\n    const handlePointerMove = (e: React.PointerEvent) => {\r\n        if (!isDragging || !width || !height) return\r\n\r\n        const rect = canvasRef.current!.getBoundingClientRect()\r\n        const x = e.clientX - rect.left\r\n        const y = e.clientY - rect.top\r\n\r\n        let delta = 0\r\n        if (layout === \"horizontal\") {\r\n            const equilibriumX = width / 2\r\n            delta = x - equilibriumX\r\n        } else {\r\n            const equilibriumY = height / 2\r\n            delta = y - equilibriumY\r\n        }\r\n\r\n        const newAmp = Math.abs(delta)\r\n        const newPhase = delta >= 0 ? 0 : Math.PI\r\n\r\n        const maxAmp = layout === \"horizontal\" ? width / 2 - 20 : height / 2 - 20\r\n        const clampedAmp = Math.min(Math.max(newAmp, 0), maxAmp)\r\n\r\n        onParameterChange({ amplitude: clampedAmp, phase: newPhase })\r\n    }\r\n\r\n    const handlePointerUp = (e: React.PointerEvent) => {\r\n        setIsDragging(false)\r\n        onInteractionEnd()\r\n        e.currentTarget.releasePointerCapture(e.pointerId)\r\n    }\r\n\r\n    const draw = useCallback(\r\n        (ctx: CanvasRenderingContext2D) => {\r\n            const currWidth = width\r\n            const currHeight = height\r\n\r\n            ctx.clearRect(0, 0, currWidth, currHeight)\r\n\r\n            // Grid\r\n            ctx.strokeStyle = \"#1e293b\"\r\n            ctx.lineWidth = 1\r\n            ctx.beginPath()\r\n            for (let i = 0; i < currWidth; i += 40) {\r\n                ctx.moveTo(i, 0)\r\n                ctx.lineTo(i, currHeight)\r\n            }\r\n            for (let i = 0; i < currHeight; i += 40) {\r\n                ctx.moveTo(0, i)\r\n                ctx.lineTo(currWidth, i)\r\n            }\r\n            ctx.stroke()\r\n\r\n            const primaryColor = colorTheme === \"blue\" ? \"#3b82f6\" : \"#f97316\" // Orange for sys2\r\n            const strokeColor = colorTheme === \"blue\" ? \"#60a5fa\" : \"#fb923c\"\r\n\r\n            if (layout === \"horizontal\") {\r\n                const centerY = currHeight / 2\r\n                const wallX = 60\r\n                const equilibriumX = currWidth / 2\r\n                const massX = equilibriumX + state.x\r\n\r\n                // Wall\r\n                ctx.fillStyle = \"#64748b\"\r\n                ctx.fillRect(wallX - 10, centerY - 50, 10, 100)\r\n                ctx.strokeStyle = \"#475569\"\r\n                ctx.beginPath()\r\n                ctx.moveTo(wallX, centerY + 30)\r\n                ctx.lineTo(currWidth, centerY + 30)\r\n                ctx.stroke()\r\n\r\n                // Limits -A, +A\r\n                ctx.strokeStyle = \"rgba(250, 204, 21, 0.3)\"\r\n                ctx.setLineDash([5, 5])\r\n                ctx.beginPath()\r\n                ctx.moveTo(equilibriumX - params.amplitude, centerY - 60)\r\n                ctx.lineTo(equilibriumX - params.amplitude, centerY + 60)\r\n                ctx.moveTo(equilibriumX + params.amplitude, centerY - 60)\r\n                ctx.lineTo(equilibriumX + params.amplitude, centerY + 60)\r\n                ctx.stroke()\r\n                ctx.setLineDash([])\r\n\r\n                ctx.fillStyle = \"rgba(250, 204, 21, 0.7)\"\r\n                ctx.font = \"10px monospace\"\r\n                ctx.textAlign = \"left\"\r\n                ctx.fillText(\"-A\", equilibriumX - params.amplitude - 15, centerY - 65)\r\n                ctx.fillText(\"+A\", equilibriumX + params.amplitude - 5, centerY - 65)\r\n\r\n                // Equilibrium Line\r\n                ctx.strokeStyle = \"#4ade80\"\r\n                ctx.setLineDash([5, 5])\r\n                ctx.beginPath()\r\n                ctx.moveTo(equilibriumX, centerY - 70)\r\n                ctx.lineTo(equilibriumX, centerY + 70)\r\n                ctx.stroke()\r\n                ctx.setLineDash([])\r\n                ctx.fillStyle = \"#4ade80\"\r\n                ctx.textAlign = \"right\"\r\n                ctx.fillText(\"VTCB (O)\", equilibriumX - 10, centerY - 75)\r\n\r\n                // Draw Spring\r\n                ctx.strokeStyle = \"#cbd5e1\"\r\n                drawSpring(ctx, wallX, centerY, massX - 25, centerY, 15, 15)\r\n\r\n                // Draw Mass\r\n                ctx.fillStyle = isDragging ? strokeColor : primaryColor\r\n                ctx.fillRect(massX - 25, centerY - 25, 50, 50)\r\n                ctx.strokeStyle = strokeColor\r\n                ctx.lineWidth = isDragging ? 3 : 1\r\n                ctx.strokeRect(massX - 25, centerY - 25, 50, 50)\r\n\r\n                // Vectors\r\n                if (!isDragging) {\r\n                    drawArrow(ctx, massX, centerY, state.v * 0.5, \"#22c55e\", \"v\")\r\n                    drawArrow(ctx, massX, centerY + 35, state.force * 5, \"#ef4444\", \"F_kv\")\r\n                }\r\n\r\n            } else {\r\n                // Vertical Layout\r\n                const centerX = currWidth / 2\r\n                const ceilingY = 40\r\n                const equilibriumY = currHeight / 2\r\n\r\n                const deltaL_px = derived.deltaL0 * 100 * 1.5\r\n                const naturalY = equilibriumY - deltaL_px\r\n                const massY = equilibriumY + state.x\r\n\r\n                // Ceiling\r\n                ctx.fillStyle = \"#64748b\"\r\n                ctx.fillRect(centerX - 50, ceilingY - 10, 100, 10)\r\n\r\n                // Natural Length Line\r\n                ctx.strokeStyle = \"#fbbf24\"\r\n                ctx.setLineDash([4, 4])\r\n                ctx.beginPath()\r\n                ctx.moveTo(centerX - 120, naturalY)\r\n                ctx.lineTo(centerX + 120, naturalY)\r\n                ctx.stroke()\r\n                ctx.fillStyle = \"#fbbf24\"\r\n                ctx.textAlign = \"right\"\r\n                ctx.fillText(\"Lò xo không giãn (L0)\", centerX - 130, naturalY + 4)\r\n\r\n                // Equilibrium Line\r\n                ctx.strokeStyle = \"#4ade80\"\r\n                ctx.beginPath()\r\n                ctx.moveTo(centerX - 120, equilibriumY)\r\n                ctx.lineTo(centerX + 120, equilibriumY)\r\n                ctx.stroke()\r\n                ctx.fillStyle = \"#4ade80\"\r\n                ctx.textAlign = \"right\"\r\n                ctx.fillText(\"VTCB (O)\", centerX - 130, equilibriumY + 4)\r\n                ctx.setLineDash([])\r\n\r\n                // Delta L\r\n                if (deltaL_px > 10) {\r\n                    const measureX = centerX + 100\r\n                    ctx.strokeStyle = \"#94a3b8\"\r\n                    ctx.beginPath()\r\n                    ctx.moveTo(measureX, naturalY)\r\n                    ctx.lineTo(measureX + 10, naturalY)\r\n                    ctx.moveTo(measureX, equilibriumY)\r\n                    ctx.lineTo(measureX + 10, equilibriumY)\r\n                    ctx.moveTo(measureX + 5, naturalY)\r\n                    ctx.lineTo(measureX + 5, equilibriumY)\r\n                    ctx.stroke()\r\n\r\n                    ctx.fillStyle = \"#f8fafc\"\r\n                    ctx.textAlign = \"left\"\r\n                    ctx.fillText(`Δl₀ = ${(derived.deltaL0 * 100).toFixed(1)} cm`, measureX + 15, naturalY + deltaL_px / 2)\r\n                }\r\n\r\n                // Limits\r\n                ctx.strokeStyle = \"rgba(250, 204, 21, 0.2)\"\r\n                ctx.setLineDash([2, 2])\r\n                ctx.beginPath()\r\n                ctx.moveTo(centerX - 60, equilibriumY - params.amplitude)\r\n                ctx.lineTo(centerX + 60, equilibriumY - params.amplitude)\r\n                ctx.moveTo(centerX - 60, equilibriumY + params.amplitude)\r\n                ctx.lineTo(centerX + 60, equilibriumY + params.amplitude)\r\n                ctx.stroke()\r\n                ctx.setLineDash([])\r\n\r\n                // Draw Spring\r\n                ctx.strokeStyle = \"#cbd5e1\"\r\n                drawSpring(ctx, centerX, ceilingY, centerX, massY - 25, 12, 15)\r\n\r\n                // Draw Mass\r\n                ctx.fillStyle = isDragging ? strokeColor : primaryColor\r\n                ctx.beginPath()\r\n                ctx.arc(centerX, massY, 25, 0, Math.PI * 2)\r\n                ctx.fill()\r\n                ctx.strokeStyle = strokeColor\r\n                ctx.lineWidth = isDragging ? 3 : 1\r\n                ctx.stroke()\r\n\r\n                if (!isDragging) {\r\n                    drawArrow(ctx, centerX + 30, massY, state.v * 0.5, \"#22c55e\", \"v\", \"vertical\")\r\n                    drawArrow(ctx, centerX - 30, massY, state.force * 5, \"#ef4444\", \"F\", \"vertical\")\r\n                }\r\n            }\r\n\r\n            // Info Box\r\n            ctx.fillStyle = \"rgba(15, 23, 42, 0.7)\"\r\n            ctx.fillRect(10, 10, 150, 70)\r\n            ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"\r\n            ctx.strokeRect(10, 10, 150, 70)\r\n\r\n            ctx.textAlign = \"left\"\r\n            ctx.textBaseline = \"alphabetic\"\r\n\r\n            ctx.fillStyle = \"#4ade80\"\r\n            ctx.font = \"13px monospace\"\r\n            ctx.fillText(`t = ${state.t.toFixed(2)} s`, 20, 30)\r\n            ctx.fillStyle = \"#38bdf8\"\r\n            ctx.fillText(`x = ${state.x.toFixed(1)} cm`, 20, 50)\r\n            ctx.fillStyle = \"#facc15\"\r\n            ctx.fillText(`v = ${state.v.toFixed(1)} cm/s`, 20, 70)\r\n\r\n            if (isDragging) {\r\n                ctx.fillStyle = \"#ffffff\"\r\n                ctx.font = \"12px sans-serif\"\r\n                ctx.fillText(\"✋ Đang kéo...\", 20, 95)\r\n            } else if (label) {\r\n                ctx.fillStyle = primaryColor\r\n                ctx.font = \"bold 12px sans-serif\"\r\n                ctx.fillText(label, 20, 95)\r\n            }\r\n\r\n        },\r\n        [layout, state, params, derived, width, height, isDragging, label, colorTheme]\r\n    )\r\n\r\n    useEffect(() => {\r\n        // Only Redraw when state or props change\r\n        if (canvasRef.current && width > 0 && height > 0) {\r\n            const canvas = canvasRef.current\r\n            if (canvas.width !== width * pixelRatio || canvas.height !== height * pixelRatio) {\r\n                canvas.width = width * pixelRatio\r\n                canvas.height = height * pixelRatio\r\n            }\r\n\r\n            const ctx = canvas.getContext(\"2d\")\r\n            if (ctx) {\r\n                ctx.save()\r\n                ctx.scale(pixelRatio, pixelRatio)\r\n                draw(ctx)\r\n                ctx.restore()\r\n            }\r\n        }\r\n    }, [draw, width, height, pixelRatio])\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"bg-[#16213e] rounded-xl overflow-hidden border border-cyan-900/50 shadow-lg relative w-full h-[300px] lg:h-[400px] touch-none\"\r\n        >\r\n            <canvas\r\n                ref={canvasRef}\r\n                className=\"w-full h-full block touch-none cursor-move\"\r\n                onPointerDown={handlePointerDown}\r\n                onPointerMove={handlePointerMove}\r\n                onPointerUp={handlePointerUp}\r\n                onPointerLeave={handlePointerUp}\r\n            />\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1803, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/spring-oscillator.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport ControlPanel from \"../ui/control-panel\"\nimport { TrendingUp, Ruler, Activity, RotateCcw, SkipBack, Play, Pause, SkipForward, SplitSquareHorizontal, Square } from \"lucide-react\"\nimport { useSpringPhysics } from \"@/hooks/use-spring-physics\"\nimport OscillatorView from \"./oscillator-view\"\n\nexport default function SpringOscillator() {\n  const energyCanvasRef = useRef<HTMLCanvasElement>(null)\n  const animationRef = useRef<number>()\n\n  const [layout, setLayout] = useState<\"horizontal\" | \"vertical\">(\"horizontal\")\n  const [mode, setMode] = useState<\"single\" | \"compare\">(\"single\")\n  const [activeTab, setActiveTab] = useState<\"system1\" | \"system2\">(\"system1\")\n\n  // System 1 Physics\n  const sys1 = useSpringPhysics({ mass: 0.5, k: 20, amplitude: 80, phase: 0 })\n\n  // System 2 Physics\n  const sys2 = useSpringPhysics({ mass: 1.0, k: 40, amplitude: 60, phase: 0 })\n\n  // Unified Controls\n  const togglePlay = () => {\n    const newState = !sys1.isPlaying\n    sys1.setIsPlaying(newState)\n    sys2.setIsPlaying(newState) // Sync playing state\n  }\n\n  const handleReset = () => {\n    sys1.reset()\n    sys2.reset()\n  }\n\n  const stepForward = () => {\n    sys1.step(0.05)\n    sys2.step(0.05)\n  }\n\n  const stepBackward = () => {\n    sys1.step(-0.05)\n    sys2.step(-0.05)\n  }\n\n  const activeSys = activeTab === \"system1\" ? sys1 : sys2\n  const isPlaying = sys1.isPlaying // Assuming synced\n\n  // Energy Graph Drawing\n  const drawEnergyGraph = useCallback(\n    (ctx: CanvasRenderingContext2D) => {\n      const w = ctx.canvas.width\n      const h = ctx.canvas.height\n\n      const history = activeSys.historyRef.current\n      const params = activeSys.params\n\n      // Transparent Background for Overlay\n      ctx.clearRect(0, 0, w, h)\n      ctx.fillStyle = \"rgba(15, 23, 42, 0.4)\" // Semi-transparent\n      ctx.fillRect(0, 50, w, h - 50)\n\n      // Grid\n      ctx.strokeStyle = \"#1e293b\"\n      ctx.lineWidth = 0.5\n      ctx.beginPath()\n      for (let x = 0; x < w; x += 50) {\n        ctx.moveTo(x, 0)\n        ctx.lineTo(x, h)\n      }\n      for (let y = 50; y < h - 10; y += 30) { // Adjusted grid to fit new fillRect area\n        ctx.moveTo(0, y)\n        ctx.lineTo(w, y)\n      }\n      ctx.stroke()\n\n      if (history.length < 2) return\n\n      // Use a fixed reference for max energy based on Max Amplitude (100cm)\n      const maxAmpMeters = 1.0 // 100cm\n      const maxRefEnergy = 0.5 * params.k * Math.pow(maxAmpMeters, 2)\n\n      // Scale so that Max Ref Energy hits 90% of height\n      const graphHeight = h - 60 // Total height for graph lines, leaving 50px for top label and 10px for bottom padding\n      const yScale = maxRefEnergy > 0 ? (graphHeight * 0.9) / maxRefEnergy : 1\n\n      const drawLine = (key: keyof typeof history[0], color: string) => {\n        ctx.strokeStyle = color\n        ctx.lineWidth = 2\n        ctx.beginPath()\n        const stepX = w / 300\n        const dataSlice = history.slice(-300)\n\n        dataSlice.forEach((pt, i) => {\n          const val = pt[key] as number\n          const x = i * stepX\n          const y = h - 10 - val * yScale // 10px padding bottom, graph starts from bottom\n          if (i === 0) ctx.moveTo(x, y)\n          else ctx.lineTo(x, y)\n        })\n        ctx.stroke()\n      }\n\n      drawLine(\"wd\", \"#22c55e\")\n      drawLine(\"wt\", \"#3b82f6\")\n      drawLine(\"wTotal\", \"#eab308\")\n\n      // Legend\n      ctx.font = \"10px monospace\"\n      ctx.fillStyle = \"#eab308\"; ctx.fillText(\"Cơ năng\", 10, h - 35)\n      ctx.fillStyle = \"#22c55e\"; ctx.fillText(\"Động năng\", 70, h - 35)\n      ctx.fillStyle = \"#3b82f6\"; ctx.fillText(\"Thế năng\", 140, h - 35)\n    },\n    [activeSys, activeTab]\n  )\n\n  // Stable Animation Loop Pattern\n  const renderLogic = useCallback(() => {\n    if (sys1.isPlaying) {\n      sys1.step(0.016)\n      sys2.step(0.016)\n    }\n\n    if (energyCanvasRef.current) {\n      const ctx = energyCanvasRef.current.getContext(\"2d\")\n      if (ctx) drawEnergyGraph(ctx)\n    }\n  }, [sys1.isPlaying, sys1.step, sys2.step, drawEnergyGraph])\n  // Note: relying on sys1.step stable identity. using sys1.isPlaying value. \n  // If we used [sys1], it would change every frame.\n  // sys1.step is stable. sys1.isPlaying changes only on user interaction.\n  // drawEnergyGraph depends on activeSys params/history which are stable refs/state-setters, \n  // but activeSys object changes.\n  // Actually drawEnergyGraph (lines 49-114) depends on [activeSys, activeTab].\n  // activeSys changes every frame. So drawEnergyGraph changes every frame.\n  // So renderLogic changes every frame.\n  // So renderRef updates every frame.\n  // Main loop calls separate function via ref. No cancel/restart. Correct.\n\n  const renderRef = useRef(renderLogic)\n  useEffect(() => {\n    renderRef.current = renderLogic\n  }, [renderLogic])\n\n  useEffect(() => {\n    const loop = () => {\n      if (renderRef.current) renderRef.current()\n      animationRef.current = requestAnimationFrame(loop)\n    }\n    animationRef.current = requestAnimationFrame(loop)\n    return () => {\n      if (animationRef.current) cancelAnimationFrame(animationRef.current)\n    }\n  }, [])\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n      <div className=\"lg:col-span-2 space-y-4\">\n\n        {/* VIEWPORT AREA */}\n        <div className={`grid gap-4 ${mode === \"compare\" ? \"grid-rows-2\" : \"grid-rows-1\"} relative`}>\n          {/* OVERLAY ENERGY GRAPH (Absolute over the viewport area) */}\n          <div className=\"absolute bottom-0 left-0 w-full h-[200px] pointer-events-none z-20 flex flex-col justify-end\">\n            <canvas\n              ref={energyCanvasRef}\n              width={800}\n              height={200}\n              className=\"w-full h-full\"\n            />\n          </div>\n\n          {/* System 1 */}\n          <div className=\"relative bg-[#1e293b] rounded-xl overflow-hidden border border-slate-700/50 h-[500px]\">\n            {mode === \"compare\" && <div className=\"absolute top-2 left-2 z-10 text-xs font-bold text-blue-400 bg-black/50 px-2 py-1 rounded\">System 1</div>}\n            <OscillatorView\n              sysId=\"sys1\"\n              params={sys1.params}\n              state={sys1.calculateState(sys1.timeRef.current)} // Get instantaneous state\n              derived={sys1.derived}\n              layout={layout}\n              onParameterChange={(p) => sys1.setParams(prev => ({ ...prev, ...p }))}\n              onInteractionStart={() => sys1.setIsPlaying(false)}\n              onInteractionEnd={() => { }}\n              colorTheme=\"blue\"\n              label={mode === \"single\" ? \"\" : \"Hệ 1\"}\n            />\n          </div>\n\n          {/* System 2 (Only in Compare Mode) */}\n          {mode === \"compare\" && (\n            <div className=\"relative animate-in slide-in-from-top-4 duration-300 bg-[#1e293b] rounded-xl overflow-hidden border border-slate-700/50\">\n              <div className=\"absolute top-2 left-2 z-10 text-xs font-bold text-orange-400 bg-black/50 px-2 py-1 rounded\">System 2</div>\n              <OscillatorView\n                sysId=\"sys2\"\n                params={sys2.params}\n                state={sys2.calculateState(sys2.timeRef.current)}\n                derived={sys2.derived}\n                layout={layout}\n                onParameterChange={(p) => sys2.setParams(prev => ({ ...prev, ...p }))}\n                onInteractionStart={() => {\n                  sys1.setIsPlaying(false)\n                  sys2.setIsPlaying(false)\n                }}\n                onInteractionEnd={() => { }}\n                colorTheme=\"orange\"\n                label=\"Hệ 2\"\n              />\n            </div>\n          )}\n        </div>\n\n        {/* UNIFIED CONTROLS */}\n        <div className=\"flex justify-center gap-3 py-2\">\n          <button onClick={handleReset} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <RotateCcw size={20} />\n          </button>\n          <button onClick={stepBackward} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <SkipBack size={20} />\n          </button>\n          <button\n            onClick={togglePlay}\n            className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg active:scale-95 border border-transparent ${isPlaying\n              ? \"bg-amber-600 hover:bg-amber-500 shadow-amber-900/20\"\n              : \"bg-cyan-600 hover:bg-cyan-500 shadow-cyan-500/30\"\n              } text-white`}\n          >\n            {isPlaying ? <Pause size={28} fill=\"currentColor\" /> : <Play size={28} fill=\"currentColor\" className=\"ml-1\" />}\n          </button>\n          <button onClick={stepForward} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <SkipForward size={20} />\n          </button>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <ControlPanel title=\"Cấu hình hệ thống\">\n          {/* Mode Selection */}\n\n          {/* Layout Selection */}\n          <div className=\"flex gap-2 mb-4\">\n            <button onClick={() => setLayout(\"horizontal\")} className={`flex-1 py-2 rounded border text-xs font-bold uppercase ${layout === \"horizontal\" ? \"bg-slate-700 border-slate-500 text-white\" : \"border-transparent bg-slate-800 text-slate-400\"}`}>Nằm ngang</button>\n            <button onClick={() => setLayout(\"vertical\")} className={`flex-1 py-2 rounded border text-xs font-bold uppercase ${layout === \"vertical\" ? \"bg-slate-700 border-slate-500 text-white\" : \"border-transparent bg-slate-800 text-slate-400\"}`}>Thẳng đứng</button>\n          </div>\n\n          {/* System Tabs (Only in Compare Mode) */}\n          {mode === \"compare\" && (\n            <div className=\"flex gap-1 mb-4 border-b border-slate-700\">\n              <button onClick={() => setActiveTab(\"system1\")} className={`flex-1 py-2 text-xs font-bold uppercase border-b-2 transition-colors ${activeTab === \"system1\" ? \"border-blue-500 text-blue-400\" : \"border-transparent text-slate-500 hover:text-slate-300\"}`}>\n                System 1\n              </button>\n              <button onClick={() => setActiveTab(\"system2\")} className={`flex-1 py-2 text-xs font-bold uppercase border-b-2 transition-colors ${activeTab === \"system2\" ? \"border-orange-500 text-orange-400\" : \"border-transparent text-slate-500 hover:text-slate-300\"}`}>\n                System 2\n              </button>\n            </div>\n          )}\n\n          <div className=\"space-y-4 animate-in fade-in slide-in-from-right-4 duration-300\" key={activeTab}>\n            <div>\n              <label className=\"text-xs text-gray-400 mb-1 block\">Khối lượng m</label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"range\"\n                  min=\"0.1\"\n                  max=\"2\"\n                  step=\"0.1\"\n                  value={activeSys.params.mass}\n                  onChange={(e) => activeSys.setParams(p => ({ ...p, mass: Number(e.target.value) }))}\n                  className={`flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer ${activeTab === 'system1' ? 'accent-cyan-500' : 'accent-orange-500'}`}\n                />\n                <span className={`w-16 text-right font-mono text-sm ${activeTab === 'system1' ? 'text-cyan-400' : 'text-orange-400'}`}>{activeSys.params.mass} kg</span>\n              </div>\n            </div>\n            <div>\n              <label className=\"text-xs text-gray-400 mb-1 block\">Độ cứng k</label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"range\"\n                  min=\"10\"\n                  max=\"200\"\n                  step=\"5\"\n                  value={activeSys.params.k}\n                  onChange={(e) => activeSys.setParams(p => ({ ...p, k: Number(e.target.value) }))}\n                  className={`flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer ${activeTab === 'system1' ? 'accent-cyan-500' : 'accent-orange-500'}`}\n                />\n                <span className={`w-16 text-right font-mono text-sm ${activeTab === 'system1' ? 'text-cyan-400' : 'text-orange-400'}`}>{activeSys.params.k} N/m</span>\n              </div>\n            </div>\n            <div>\n              <label className=\"text-xs text-gray-400 mb-1 block\">Biên độ A</label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"range\"\n                  min=\"10\"\n                  max=\"100\"\n                  value={activeSys.params.amplitude}\n                  onChange={(e) => activeSys.setParams(p => ({ ...p, amplitude: Number(e.target.value) }))}\n                  className={`flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer ${activeTab === 'system1' ? 'accent-cyan-500' : 'accent-orange-500'}`}\n                />\n                <span className={`w-16 text-right font-mono text-sm ${activeTab === 'system1' ? 'text-cyan-400' : 'text-orange-400'}`}>{Math.round(activeSys.params.amplitude)} cm</span>\n              </div>\n            </div>\n          </div>\n        </ControlPanel>\n\n        <div className=\"bg-[#1e293b] rounded-xl p-0 border border-cyan-900/50 overflow-hidden\">\n          <div className=\"bg-slate-800/50 p-3 border-b border-slate-700 flex items-center gap-2\">\n            <Activity className=\"w-4 h-4 text-green-400\" />\n            <h3 className=\"text-sm font-bold text-slate-200\">Đại lượng ({mode === \"compare\" ? (activeTab === \"system1\" ? \"Sys 1\" : \"Sys 2\") : \"Sys 1\"})</h3>\n          </div>\n          <div className=\"p-4 grid grid-cols-2 gap-4\">\n            <div>\n              <div className=\"text-[10px] text-gray-500 uppercase\">Chu kỳ (T)</div>\n              <div className=\"text-lg font-mono font-bold text-white\">\n                {activeSys.derived.period.toFixed(2)} <span className=\"text-xs font-normal text-gray-400\">s</span>\n              </div>\n            </div>\n            <div>\n              <div className=\"text-[10px] text-gray-500 uppercase\">Tần số (f)</div>\n              <div className=\"text-lg font-mono font-bold text-white\">\n                {activeSys.derived.frequency.toFixed(2)} <span className=\"text-xs font-normal text-gray-400\">Hz</span>\n              </div>\n            </div>\n            <div>\n              <div className=\"text-[10px] text-gray-500 uppercase\">Vận tốc Max</div>\n              <div className=\"text-lg font-mono font-bold text-green-400\">\n                {activeSys.derived.vmax.toFixed(1)} <span className=\"text-xs font-normal text-gray-400\">cm/s</span>\n              </div>\n            </div>\n            <div>\n              <div className=\"text-[10px] text-gray-500 uppercase\">Gia tốc Max</div>\n              <div className=\"text-lg font-mono font-bold text-red-400\">\n                {activeSys.derived.amax.toFixed(0)} <span className=\"text-xs font-normal text-gray-400\">cm/s²</span>\n              </div>\n            </div>\n            {layout === \"vertical\" && (\n              <div className=\"col-span-2 bg-slate-900 p-2 rounded border border-slate-700 flex items-center justify-between\">\n                <span className=\"text-xs text-yellow-500 flex items-center gap-1\">\n                  <Ruler size={12} /> Độ giãn lò xo (Δl₀)\n                </span>\n                <span className=\"font-mono font-bold text-yellow-400\">{(activeSys.derived.deltaL0 * 100).toFixed(1)} cm</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"bg-[#16213e] rounded-lg p-4 border border-cyan-900/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-2\">Công thức</h3>\n          <div className=\"text-sm text-gray-300 space-y-1 font-mono\">\n            <p>ω = √(k/m) = {activeSys.derived.omega.toFixed(2)} rad/s</p>\n            <p>T = 2π√(m/k) = {activeSys.derived.period.toFixed(2)} s</p>\n            <p>F = -kx (Định luật Hooke)</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2718, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/simple-pendulum.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport ControlPanel from \"../ui/control-panel\"\nimport { Activity, Zap, TrendingUp, RotateCcw, SkipBack, Pause, Play, SkipForward, Ruler, Anchor } from \"lucide-react\"\n\n// Force update check\nexport default function SimplePendulum() {\n    const canvasRef = useRef<HTMLCanvasElement>(null)\n    const energyCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [isPlaying, setIsPlaying] = useState(false)\n    const [time, setTime] = useState(0)\n\n    const [showGraph, setShowGraph] = useState({ x: true, v: false, a: false })\n\n    const [params, setParams] = useState({\n        length: 100,      // cm\n        gravity: 9.8,     // m/s²\n        initialAngle: 10, // degrees\n        mass: 1.0         // kg\n    })\n\n    // History for Energy Graph\n    const energyHistoryRef = useRef<{ t: number, wd: number, wt: number, w: number }[]>([])\n\n    const animationRef = useRef<number>()\n    const timeRef = useRef(0)\n\n    // Physics Calculations\n    const lengthM = params.length / 100\n    const omega = Math.sqrt(params.gravity / lengthM)\n    const period = (2 * Math.PI) / omega\n    const frequency = 1 / period\n    const thetaMax = (params.initialAngle * Math.PI) / 180\n    const dt = 0.016\n\n    const calculateState = useCallback(\n        (t: number) => {\n            const theta = thetaMax * Math.cos(omega * t)\n            const x = params.length * Math.sin(theta) // Horizontal displacement approx\n\n            // Calculate v using Energy Conservation to ensure W is constant for large angles\n            const l_m = params.length / 100\n            const h_current = l_m * (1 - Math.cos(theta))\n            const h_max = l_m * (1 - Math.cos(thetaMax))\n            const v_mag = Math.sqrt(2 * params.gravity * Math.max(0, h_max - h_current))\n\n            // Direction same as SHM approximation: -sin(omega*t)\n            const sign = -Math.sin(omega * t) >= 0 ? 1 : -1\n            const v = sign * v_mag * 100 // Convert to cm/s\n\n            // Acceleration (approx)\n            const a = -params.length * omega * omega * thetaMax * Math.cos(omega * t)\n\n            return { theta, x, v, a }\n        },\n        [thetaMax, omega, params.length, params.gravity],\n    )\n\n    const drawSim = useCallback(\n        (ctx: CanvasRenderingContext2D, t: number) => {\n            const width = ctx.canvas.width\n            const height = ctx.canvas.height\n\n            ctx.fillStyle = \"#0f172a\"\n            ctx.fillRect(0, 0, width, height)\n\n            // Grid\n            ctx.strokeStyle = \"#1e293b\"\n            ctx.lineWidth = 0.5\n            ctx.beginPath()\n            for (let i = 0; i < width; i += 40) { ctx.moveTo(i, 0); ctx.lineTo(i, height) }\n            for (let i = 0; i < height; i += 40) { ctx.moveTo(0, i); ctx.lineTo(width, i) }\n            ctx.stroke()\n\n            const state = calculateState(t)\n\n            const pivotX = width / 2\n            const pivotY = 40\n\n            const bobX = pivotX + params.length * Math.sin(state.theta)\n            const bobY = pivotY + params.length * Math.cos(state.theta)\n\n            // Support\n            ctx.fillStyle = \"#64748b\"\n            ctx.fillRect(pivotX - 40, pivotY - 10, 80, 10)\n\n            // Vertical dashed line\n            ctx.strokeStyle = \"#334155\"; ctx.setLineDash([5, 5])\n            ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(pivotX, pivotY + params.length + 40); ctx.stroke(); ctx.setLineDash([])\n\n            // String\n            ctx.strokeStyle = \"#cbd5e1\"; ctx.lineWidth = 2\n            ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(bobX, bobY); ctx.stroke()\n\n            // Bob\n            const gradient = ctx.createRadialGradient(bobX - 5, bobY - 5, 2, bobX, bobY, 20)\n            gradient.addColorStop(0, \"#fb923c\")\n            gradient.addColorStop(1, \"#ea580c\")\n            ctx.fillStyle = gradient\n            ctx.beginPath(); ctx.arc(bobX, bobY, 20, 0, 2 * Math.PI); ctx.fill()\n            ctx.strokeStyle = \"#fff7ed\"; ctx.lineWidth = 2; ctx.stroke()\n\n            // Angle indicator\n            ctx.fillStyle = \"#facc15\"; ctx.font = \"bold 14px monospace\"\n            ctx.fillText(`${state.theta > 0 ? '+' : ''}${((state.theta * 180) / Math.PI).toFixed(1)}°`, pivotX + 20, pivotY + 40)\n\n            // Info overlay (Top Left)\n            ctx.fillStyle = \"rgba(15, 23, 42, 0.8)\"; ctx.fillRect(10, 10, 140, 80)\n            ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"; ctx.strokeRect(10, 10, 140, 80)\n\n            ctx.font = \"12px monospace\"; ctx.textAlign = \"left\"\n            ctx.fillStyle = \"#e2e8f0\"; ctx.fillText(`t = ${t.toFixed(2)} s`, 20, 30)\n            ctx.fillStyle = \"#22d3ee\"; ctx.fillText(`α = ${((state.theta * 180) / Math.PI).toFixed(1)}°`, 20, 50)\n            ctx.fillStyle = \"#4ade80\"; ctx.fillText(`v = ${state.v.toFixed(1)} cm/s`, 20, 70)\n\n            // Signature\n            ctx.fillStyle = \"rgba(255, 255, 255, 0.15)\"; ctx.textAlign = \"right\"\n            ctx.fillText(\"Simple Pendulum\", width - 15, height - 15)\n            ctx.textAlign = \"left\" // Reset\n        },\n        [params.length, params.gravity, calculateState],\n    )\n\n    const drawEnergyGraph = useCallback((ctx: CanvasRenderingContext2D) => {\n        const w = ctx.canvas.width\n        const h = ctx.canvas.height\n        const history = energyHistoryRef.current\n\n        // Clear instead of fill to allow overlay\n        ctx.clearRect(0, 0, w, h)\n\n        // Optional: Semi-transparent background for readability\n        ctx.fillStyle = \"rgba(15, 23, 42, 0.4)\"\n        ctx.fillRect(0, 50, w, h - 50)\n\n        if (history.length < 2) return\n\n        const l_m = params.length / 100\n\n        // Auto-Scale based on CURRENT initialAngle (user preference)\n        // This makes the graph always fill the view regardless of how small the angle is.\n        const thetaMaxRad = (params.initialAngle * Math.PI) / 180\n        const maxRefPotential = params.mass * params.gravity * l_m * (1 - Math.cos(thetaMaxRad))\n\n        // Scale to fit available height (leaving 50px top for overlay, 10px bottom padding)\n        const graphHeight = h - 60\n        const yScale = maxRefPotential > 0 ? (graphHeight * 0.9) / maxRefPotential : 1\n\n        const drawLine = (key: 'wd' | 'wt' | 'w', color: string) => {\n            ctx.strokeStyle = color\n            ctx.lineWidth = 2\n            ctx.beginPath()\n            const dataToDraw = history.slice(-300)\n            const stepX = w / 300\n\n            dataToDraw.forEach((pt, i) => {\n                const x = i * stepX\n                const y = h - 10 - (pt[key] * yScale)\n                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y)\n            })\n            ctx.stroke()\n        }\n\n        drawLine('wt', '#3b82f6')\n        drawLine('wd', '#22c55e')\n        drawLine('w', '#eab308')\n\n        // Draw Leading Dots (Current Value Indicators)\n        if (history.length > 0) {\n            const lastPt = history[history.length - 1]\n            const stepX = w / 300\n            const x = (history.length - 1) * stepX // Should be roughly w if full\n\n            const drawDot = (key: 'wd' | 'wt' | 'w', color: string) => {\n                const y = h - 10 - (lastPt[key] * yScale)\n                ctx.fillStyle = color\n                ctx.beginPath()\n                ctx.arc(x, y, 4, 0, Math.PI * 2)\n                ctx.fill()\n                ctx.strokeStyle = \"#ffffff\"\n                ctx.lineWidth = 1.5\n                ctx.stroke()\n            }\n\n            drawDot('wt', '#3b82f6')\n            drawDot('wd', '#22c55e')\n            drawDot('w', '#eab308')\n        }\n\n        // Legend inside canvas\n        ctx.font = \"10px monospace\"\n        ctx.fillStyle = \"#eab308\"; ctx.fillText(\"Cơ năng\", 10, h - 35)\n        ctx.fillStyle = \"#22c55e\"; ctx.fillText(\"Động năng\", 70, h - 35)\n        ctx.fillStyle = \"#3b82f6\"; ctx.fillText(\"Thế năng\", 140, h - 35)\n\n    }, [params.length, params.mass, params.gravity, params.initialAngle])\n\n    const renderLogic = useCallback(() => {\n        if (!canvasRef.current) return\n        const ctx = canvasRef.current.getContext(\"2d\")\n        if (!ctx) return\n\n        if (isPlaying) {\n            timeRef.current += dt\n            setTime(timeRef.current)\n\n            const state = calculateState(timeRef.current)\n\n            // Energy Calculation (Enforced Conservation)\n            const l_m = params.length / 100\n            const thetaMaxRad = (params.initialAngle * Math.PI) / 180\n\n            // Total Energy is constant based on initial release angle (assuming v0=0)\n            const h_max = l_m * (1 - Math.cos(thetaMaxRad))\n            const W_total = params.mass * params.gravity * h_max\n\n            // Potential Energy\n            const h_current = l_m * (1 - Math.cos(state.theta))\n            const wt = params.mass * params.gravity * h_current\n\n            // Kinetic Energy (Derived to ensure sum is exactly W_total)\n            const wd = Math.max(0, W_total - wt)\n\n            energyHistoryRef.current.push({ t: timeRef.current, wd, wt, w: W_total })\n            if (energyHistoryRef.current.length > 300) energyHistoryRef.current.shift()\n        }\n\n        drawSim(ctx, timeRef.current)\n        if (energyCanvasRef.current) drawEnergyGraph(energyCanvasRef.current.getContext(\"2d\")!)\n\n    }, [isPlaying, drawSim, drawEnergyGraph, calculateState, params, dt])\n\n    const renderRef = useRef(renderLogic)\n    useEffect(() => {\n        renderRef.current = renderLogic\n    }, [renderLogic])\n\n    useEffect(() => {\n        const loop = () => {\n            if (renderRef.current) renderRef.current()\n            animationRef.current = requestAnimationFrame(loop)\n        }\n        animationRef.current = requestAnimationFrame(loop)\n        return () => { if (animationRef.current) cancelAnimationFrame(animationRef.current) }\n    }, [])\n\n    // Initial Draw\n    useEffect(() => {\n        if (!isPlaying && canvasRef.current && energyCanvasRef.current) {\n            drawSim(canvasRef.current.getContext(\"2d\")!, timeRef.current)\n            drawEnergyGraph(energyCanvasRef.current.getContext(\"2d\")!)\n        }\n    }, [params, drawSim, drawEnergyGraph, isPlaying])\n\n    const handleStep = (dir: number) => {\n        setIsPlaying(false)\n        timeRef.current = Math.max(0, timeRef.current + dir * 0.05)\n        setTime(timeRef.current)\n        // Draw will be updated by loop or effect\n    }\n\n    const handleReset = () => {\n        setIsPlaying(false)\n        timeRef.current = 0\n        setTime(0)\n        energyHistoryRef.current = []\n    }\n\n    // Current values for Stats Panel\n    const currState = calculateState(time)\n    const currH = lengthM * (1 - Math.cos(currState.theta))\n    const currWt = params.mass * params.gravity * currH\n    const currWd = 0.5 * params.mass * (currState.v / 100) ** 2\n    const currW = currWt + currWd\n\n    return (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            <div className=\"lg:col-span-2 space-y-4\">\n                {/* Canvas Area with Overlay Graph */}\n                <div className=\"relative bg-[#1e293b] rounded-xl overflow-hidden border border-slate-700/50 shadow-sm h-[500px]\">\n                    <canvas ref={canvasRef} width={800} height={500} className=\"w-full h-full block\" />\n\n                    {/* Energy Graph Overlay */}\n                    <canvas\n                        ref={energyCanvasRef}\n                        width={800}\n                        height={200}\n                        className=\"absolute bottom-0 left-0 w-full h-[200px] pointer-events-none z-10\"\n                    />\n                </div>\n\n                {/* UNIFIED CONTROLS */}\n                <div className=\"flex justify-center gap-3 py-2\">\n                    <button onClick={handleReset} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n                        <RotateCcw size={20} />\n                    </button>\n                    <button onClick={() => handleStep(-1)} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n                        <SkipBack size={20} />\n                    </button>\n                    <button\n                        onClick={() => setIsPlaying(!isPlaying)}\n                        className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg active:scale-95 border border-transparent ${isPlaying\n                            ? \"bg-amber-600 hover:bg-amber-500 shadow-amber-900/20\"\n                            : \"bg-cyan-600 hover:bg-cyan-500 shadow-cyan-500/30\"\n                            } text-white`}\n                    >\n                        {isPlaying ? <Pause size={28} fill=\"currentColor\" /> : <Play size={28} fill=\"currentColor\" className=\"ml-1\" />}\n                    </button>\n                    <button onClick={() => handleStep(1)} className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n                        <SkipForward size={20} />\n                    </button>\n                </div>\n            </div>\n            <div className=\"space-y-4\">\n                {/* CONFIGURATION */}\n                <ControlPanel title=\"Cấu hình hệ thống\">\n                    <div className=\"space-y-4\">\n                        <div>\n                            <label className=\"text-xs text-gray-400 mb-1 block\">Chiều dài l</label>\n                            <div className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"range\"\n                                    min=\"50\"\n                                    max=\"200\"\n                                    value={params.length}\n                                    onChange={(e) => {\n                                        setParams(p => ({ ...p, length: Number(e.target.value) }))\n                                        energyHistoryRef.current = []\n                                    }}\n                                    className=\"flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer accent-cyan-500\"\n                                />\n                                <span className=\"w-16 text-right font-mono text-sm text-cyan-400\">{params.length} cm</span>\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"text-xs text-gray-400 mb-1 block\">Gia tốc g</label>\n                            <div className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"range\"\n                                    min=\"1\"\n                                    max=\"20\"\n                                    step=\"0.1\"\n                                    value={params.gravity}\n                                    onChange={(e) => {\n                                        setParams(p => ({ ...p, gravity: Number(e.target.value) }))\n                                        energyHistoryRef.current = []\n                                    }}\n                                    className=\"flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer accent-cyan-500\"\n                                />\n                                <span className=\"w-16 text-right font-mono text-sm text-cyan-400\">{params.gravity} m/s²</span>\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"text-xs text-gray-400 mb-1 block\">Góc ban đầu θ₀ (Lưu ý: ≤ 10° để dao động điều hòa)</label>\n                            <div className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"range\"\n                                    min=\"1\"\n                                    max=\"60\"\n                                    value={params.initialAngle}\n                                    onChange={(e) => {\n                                        setParams(p => ({ ...p, initialAngle: Number(e.target.value) }))\n                                        energyHistoryRef.current = []\n                                    }}\n                                    className=\"flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer accent-cyan-500\"\n                                />\n                                <span className=\"w-16 text-right font-mono text-sm text-cyan-400\">{params.initialAngle}°</span>\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"text-xs text-gray-400 mb-1 block\">Khối lượng m</label>\n                            <div className=\"flex items-center gap-2\">\n                                <input\n                                    type=\"range\"\n                                    min=\"0.1\"\n                                    max=\"5\"\n                                    step=\"0.1\"\n                                    value={params.mass}\n                                    onChange={(e) => {\n                                        setParams(p => ({ ...p, mass: Number(e.target.value) }))\n                                        energyHistoryRef.current = []\n                                    }}\n                                    className=\"flex-1 h-2 bg-slate-700 rounded-lg cursor-pointer accent-cyan-500\"\n                                />\n                                <span className=\"w-16 text-right font-mono text-sm text-cyan-400\">{params.mass} kg</span>\n                            </div>\n                        </div>\n                    </div>\n                </ControlPanel>\n\n                {/* STATS */}\n                <div className=\"bg-[#1e293b] rounded-xl p-0 border border-cyan-900/50 overflow-hidden\">\n                    <div className=\"bg-slate-800/50 p-3 border-b border-slate-700 flex items-center gap-2\">\n                        <Activity className=\"w-4 h-4 text-green-400\" />\n                        <h3 className=\"text-sm font-bold text-slate-200\">Đại lượng đo đạc</h3>\n                    </div>\n                    <div className=\"p-4 grid grid-cols-2 gap-4\">\n                        <div>\n                            <div className=\"text-[10px] text-gray-500 uppercase\">Chu kỳ (T)</div>\n                            <div className=\"text-lg font-mono font-bold text-white\">\n                                {period.toFixed(2)} <span className=\"text-xs font-normal text-gray-400\">s</span>\n                            </div>\n                        </div>\n                        <div>\n                            <div className=\"text-[10px] text-gray-500 uppercase\">Tần số (f)</div>\n                            <div className=\"text-lg font-mono font-bold text-white\">\n                                {frequency.toFixed(2)} <span className=\"text-xs font-normal text-gray-400\">Hz</span>\n                            </div>\n                        </div>\n                        <div>\n                            <div className=\"text-[10px] text-gray-500 uppercase\">Vận tốc (v)</div>\n                            <div className=\"text-lg font-mono font-bold text-white\">\n                                {currState.v.toFixed(1)} <span className=\"text-xs font-normal text-gray-400\">cm/s</span>\n                            </div>\n                        </div>\n                        <div>\n                            <div className=\"text-[10px] text-gray-500 uppercase\">Gia tốc (a)</div>\n                            <div className=\"text-lg font-mono font-bold text-white\">\n                                {currState.a.toFixed(1)} <span className=\"text-xs font-normal text-gray-400\">cm/s²</span>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n                {/* ENERGY MONITOR */}\n                <div className=\"bg-[#1e293b] rounded-xl p-4 border border-cyan-900/50\">\n                    <h3 className=\"text-amber-400 font-semibold mb-3 text-sm flex items-center gap-2\">\n                        <Zap size={14} /> Năng lượng\n                    </h3>\n                    <div className=\"space-y-3\">\n                        <div>\n                            <div className=\"flex justify-between text-xs mb-1\">\n                                <span className=\"text-green-400\">Động năng Wđ</span>\n                                <span className=\"text-green-400 font-mono\">{currWd.toFixed(3)} J</span>\n                            </div>\n                            <div className=\"h-2 bg-slate-700 rounded-full overflow-hidden\">\n                                <div className=\"h-full bg-green-500 transition-all duration-100\" style={{ width: `${(currWd / (currW || 1)) * 100}%` }} />\n                            </div>\n                        </div>\n                        <div>\n                            <div className=\"flex justify-between text-xs mb-1\">\n                                <span className=\"text-blue-400\">Thế năng Wt</span>\n                                <span className=\"text-blue-400 font-mono\">{currWt.toFixed(3)} J</span>\n                            </div>\n                            <div className=\"h-2 bg-slate-700 rounded-full overflow-hidden\">\n                                <div className=\"h-full bg-blue-500 transition-all duration-100\" style={{ width: `${(currWt / (currW || 1)) * 100}%` }} />\n                            </div>\n                        </div>\n                        <div>\n                            <div className=\"flex justify-between text-xs mb-1\">\n                                <span className=\"text-yellow-400\">Cơ năng W</span>\n                                <span className=\"text-yellow-400 font-mono\">{currW.toFixed(3)} J</span>\n                            </div>\n                            <div className=\"h-2 bg-yellow-500/30 rounded-full\" />\n                        </div>\n                    </div>\n                </div>\n\n                {/* FORMULAS */}\n                <div className=\"bg-[#16213e] rounded-lg p-4 border border-cyan-900/50\">\n                    <h3 className=\"text-cyan-400 font-semibold mb-2 flex items-center gap-2 text-sm\"><Anchor size={14} /> Công thức</h3>\n                    <div className=\"text-xs text-gray-300 space-y-1 font-mono\">\n                        <p>l: Chiều dài từ điểm treo đến tâm vật</p>\n                        <p className=\"text-slate-500\">Điều kiện: α₀ ≤ 10°</p>\n                        <div className=\"w-full h-[1px] bg-slate-700 my-2\"></div>\n                        <p>ω = √(g/l) = {omega.toFixed(2)} rad/s</p>\n                        <p>T = 2π/ω = {period.toFixed(2)} s</p>\n                        <p>W = mgl(1-cos(α₀))</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3884, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/damped-oscillation.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport { Play, Pause, RotateCcw, SkipBack, SkipForward, Activity, Settings, TrendingDown, Wind, Zap, Droplets, Hexagon } from \"lucide-react\"\n\n// --- COMPONENT CON ---\nconst ControlPanel = ({ title, icon: Icon, children }: { title: string; icon?: any; children: React.ReactNode }) => (\n    <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 shadow-sm overflow-hidden flex flex-col h-full\">\n        <div className=\"bg-slate-800/50 px-4 py-3 border-b border-slate-700/50 flex items-center gap-2\">\n            {Icon && <Icon size={16} className=\"text-cyan-400\" />}\n            <h3 className=\"text-slate-300 font-bold text-xs uppercase tracking-wider\">{title}</h3>\n        </div>\n        <div className=\"p-4 space-y-4 flex-1\">{children}</div>\n    </div>\n)\n\n// --- GRID BACKGROUND COMPONENT ---\nconst GridBackground = () => (\n    <defs>\n        <pattern id=\"smallGrid\" width=\"20\" height=\"20\" patternUnits=\"userSpaceOnUse\">\n            <path d=\"M 20 0 L 0 0 0 20\" fill=\"none\" stroke=\"#334155\" strokeWidth=\"0.5\" opacity=\"0.3\" />\n        </pattern>\n        <pattern id=\"grid\" width=\"100\" height=\"100\" patternUnits=\"userSpaceOnUse\">\n            <rect width=\"100\" height=\"100\" fill=\"url(#smallGrid)\" />\n            <path d=\"M 100 0 L 0 0 0 100\" fill=\"none\" stroke=\"#475569\" strokeWidth=\"1\" opacity=\"0.5\" />\n        </pattern>\n    </defs>\n)\n\nconst ENVIRONMENTS: Record<string, { name: string; beta: number; color: string; icon: any }> = {\n    vacuum: { name: 'Chân không', beta: 0, color: '#94a3b8', icon: Zap },\n    air: { name: 'Không khí', beta: 0.05, color: '#38bdf8', icon: Wind },\n    water: { name: 'Nước', beta: 0.3, color: '#3b82f6', icon: Droplets },\n    oil: { name: 'Dầu nhớt', beta: 0.8, color: '#eab308', icon: Hexagon }\n};\n\nexport default function DampedOscillation() {\n    const energyCanvasRef = useRef<HTMLCanvasElement>(null)\n\n    const [isPlaying, setIsPlaying] = useState(false)\n    const [time, setTime] = useState(0)\n    const [env, setEnv] = useState('air')\n    const [graphMode, setGraphMode] = useState<'x' | 'v' | 'a'>('x') // Chế độ hiển thị đồ thị\n    const GRAPH_WINDOW = 20\n\n    const [params, setParams] = useState({\n        A: 80,   // px\n        f: 0.5,  // Hz\n        phi: 0,  // rad\n        m: 1.0,  // kg\n        k: 20    // N/m\n    })\n\n    const energyHistoryRef = useRef<{ t: number, w: number }[]>([])\n    const animationRef = useRef<number>()\n    const timeRef = useRef(0)\n    const dt = 0.02\n\n    // --- TÍNH TOÁN ---\n    const beta = ENVIRONMENTS[env].beta\n    const omega = 2 * Math.PI * params.f\n\n    // Tính trạng thái x, v, a tại thời điểm t\n    const calculateState = useCallback((t: number) => {\n        // Phase\n        const phase = omega * t + params.phi\n        const exp = Math.exp(-beta * t)\n\n        // Li độ x\n        const x = params.A * exp * Math.cos(phase)\n        const envelope = params.A * exp\n\n        // Vận tốc v = dx/dt\n        const v = -beta * x - params.A * exp * omega * Math.sin(phase)\n\n        // Gia tốc a = dv/dt\n        const a = -2 * beta * v - (beta * beta + omega * omega) * x\n\n        // Năng lượng (xấp xỉ)\n        const w0 = 0.5 * params.k * (params.A / 100) ** 2\n        const w = w0 * Math.exp(-2 * beta * t)\n\n        return { x, v, a, envelope, w }\n    }, [beta, omega, params.A, params.k, params.phi])\n\n    // --- GENERATE SVG PATHS ---\n    const width = 800\n    const height = 380\n    const centerY = height / 2\n    const shift = Math.max(0, time - GRAPH_WINDOW)\n    const timeScale = width / GRAPH_WINDOW\n\n    const generatePaths = useCallback(() => {\n        const points = []\n        const envTop = []\n        const envBot = []\n\n        const scaleV = omega > 0 ? 1 / omega : 1;\n        const scaleA = omega > 0 ? 1 / (omega * omega) : 1;\n\n        for (let i = 0; i <= width; i += 2) {\n            const t_plot = shift + i / timeScale\n            const state = calculateState(t_plot)\n\n            let val = 0;\n            if (graphMode === 'x') val = state.x;\n            else if (graphMode === 'v') val = state.v * scaleV;\n            else if (graphMode === 'a') val = state.a * scaleA;\n\n            points.push(`${i},${centerY - val}`)\n\n            if (graphMode === 'x') {\n                envTop.push(`${i},${centerY - state.envelope}`)\n                envBot.push(`${i},${centerY + state.envelope}`)\n            }\n        }\n\n        return {\n            wave: `M ${points.join(\" L \")}`,\n            envTop: graphMode === 'x' ? `M ${envTop.join(\" L \")}` : \"\",\n            envBot: graphMode === 'x' ? `M ${envBot.join(\" L \")}` : \"\",\n        }\n    }, [calculateState, graphMode, timeScale, centerY, omega, shift])\n\n    const paths = generatePaths()\n    const cx = (time - shift) * timeScale\n    const currState = calculateState(time)\n\n    // Value to display for the dot (normalized)\n    let currentDisplayVal = currState.x;\n    if (graphMode === 'v') currentDisplayVal = currState.v * (omega > 0 ? 1 / omega : 1);\n    if (graphMode === 'a') currentDisplayVal = currState.a * (omega > 0 ? 1 / (omega * omega) : 1);\n\n\n    // --- DRAW ENERGY GRAPH ---\n    const drawEnergy = useCallback((ctx: CanvasRenderingContext2D) => {\n        const w = ctx.canvas.width; const h = ctx.canvas.height;\n\n        ctx.fillStyle = \"#0f172a\"; ctx.fillRect(0, 0, w, h);\n        ctx.strokeStyle = \"#1e293b\"; ctx.lineWidth = 0.5; ctx.beginPath();\n        for (let x = 0; x < w; x += w / 10) { ctx.moveTo(x, 0); ctx.lineTo(x, h) }\n        ctx.stroke();\n\n        const history = energyHistoryRef.current;\n        if (history.length < 2) return;\n\n        const maxE = history[0].w || 1;\n        const yScale = (h - 20) / maxE;\n\n        ctx.strokeStyle = \"#eab308\"; ctx.lineWidth = 2; ctx.beginPath();\n        let started = false\n        history.forEach((pt) => {\n            if (pt.t < shift) return;\n            const x = (pt.t - shift) * (w / GRAPH_WINDOW);\n            const y = h - 10 - (pt.w * yScale);\n            if (!started) { ctx.moveTo(x, y); started = true; }\n            else ctx.lineTo(x, y);\n        });\n        ctx.stroke();\n\n        // Simplified Fill\n        ctx.fillStyle = \"rgba(234, 179, 8, 0.1)\";\n        // Need a closed path for fill, but simple stroke is enough for now or complex close\n\n    }, [shift])\n\n    // --- LOOP ---\n    const animate = useCallback(() => {\n        if (isPlaying) {\n            timeRef.current += dt;\n            setTime(timeRef.current);\n\n            const state = calculateState(timeRef.current);\n            if (timeRef.current % 0.1 < dt) {\n                energyHistoryRef.current.push({ t: timeRef.current, w: state.w });\n                if (energyHistoryRef.current.length > 5000) energyHistoryRef.current.shift();\n            }\n        }\n        if (energyCanvasRef.current) drawEnergy(energyCanvasRef.current.getContext('2d')!);\n        animationRef.current = requestAnimationFrame(animate);\n    }, [isPlaying, drawEnergy, calculateState]);\n\n    useEffect(() => {\n        animationRef.current = requestAnimationFrame(animate);\n        return () => { if (animationRef.current) cancelAnimationFrame(animationRef.current); }\n    }, [animate]);\n\n    useEffect(() => {\n        if (!isPlaying && energyCanvasRef.current) {\n            drawEnergy(energyCanvasRef.current.getContext('2d')!);\n        }\n    }, [params, env, drawEnergy, isPlaying])\n\n    const handleReset = () => { setIsPlaying(false); timeRef.current = 0; setTime(0); energyHistoryRef.current = []; }\n    const handleStep = (dir: number) => { setIsPlaying(false); timeRef.current = Math.max(0, timeRef.current + dir * 0.5); setTime(timeRef.current); }\n\n    // Màu sắc cho từng chế độ\n    const getGraphColor = () => {\n        if (graphMode === 'x') return ENVIRONMENTS[env].color;\n        if (graphMode === 'v') return '#22c55e'; // Green\n        if (graphMode === 'a') return '#ef4444'; // Red\n        return '#fff';\n    }\n\n    return (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            {/* CỘT TRÁI */}\n            <div className=\"lg:col-span-2 space-y-4\">\n\n                {/* Main Visual (SVG) */}\n                <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 shadow-lg relative overflow-hidden h-[380px]\">\n                    {/* Mode Selector (Tabs) */}\n                    <div className=\"absolute top-4 right-4 z-20 flex bg-slate-900/80 backdrop-blur rounded-lg p-1 border border-slate-700\">\n                        <button onClick={() => setGraphMode('x')} className={`px-3 py-1 rounded text-xs font-bold transition-colors ${graphMode === 'x' ? 'bg-cyan-600 text-white' : 'text-slate-400 hover:text-white'}`}>x(t)</button>\n                        <button onClick={() => setGraphMode('v')} className={`px-3 py-1 rounded text-xs font-bold transition-colors ${graphMode === 'v' ? 'bg-green-600 text-white' : 'text-slate-400 hover:text-white'}`}>v(t)</button>\n                        <button onClick={() => setGraphMode('a')} className={`px-3 py-1 rounded text-xs font-bold transition-colors ${graphMode === 'a' ? 'bg-red-500 text-white' : 'text-slate-400 hover:text-white'}`}>a(t)</button>\n                    </div>\n\n                    {/* SVG Layer */}\n                    <svg width=\"100%\" height=\"100%\" viewBox={`0 0 ${width} ${height}`} className=\"bg-[#0f172a] absolute inset-0\">\n                        <GridBackground />\n                        <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" opacity=\"0.5\" />\n\n                        {/* Trục tọa độ */}\n                        <line x1=\"0\" y1={centerY} x2={width} y2={centerY} stroke=\"#475569\" strokeWidth=\"1\" />\n                        <line x1=\"2\" y1=\"0\" x2=\"2\" y2={height} stroke=\"#475569\" strokeWidth=\"1\" />\n\n                        {/* Đường bao (Chỉ hiện khi xem x) */}\n                        {beta > 0 && graphMode === 'x' && (\n                            <>\n                                <path d={paths.envTop} fill=\"none\" stroke=\"#94a3b8\" strokeDasharray=\"4 4\" strokeWidth=\"1\" opacity=\"0.5\" />\n                                <path d={paths.envBot} fill=\"none\" stroke=\"#94a3b8\" strokeDasharray=\"4 4\" strokeWidth=\"1\" opacity=\"0.5\" />\n                            </>\n                        )}\n\n                        {/* Đường sóng (Wave) */}\n                        <path\n                            d={paths.wave}\n                            fill=\"none\"\n                            stroke={getGraphColor()}\n                            strokeWidth=\"3\"\n                            filter=\"drop-shadow(0 0 4px currentColor)\"\n                        />\n\n                        {/* Điểm chạy (Scan Line & Point) */}\n                        {cx < width && (\n                            <g>\n                                <line x1={cx} y1=\"0\" x2={cx} y2={height} stroke=\"#facc15\" strokeWidth=\"1\" opacity=\"0.3\" />\n                                <g transform={`translate(${cx}, ${centerY - currentDisplayVal})`}>\n                                    <circle r=\"6\" fill=\"#facc15\" stroke=\"white\" strokeWidth=\"2\" />\n                                    <line x1=\"0\" y1=\"0\" x2=\"0\" y2={currentDisplayVal} stroke=\"#facc15\" strokeDasharray=\"2 2\" opacity=\"0.5\" />\n                                </g>\n                            </g>\n                        )}\n                    </svg>\n\n                    {/* Labels Overlay */}\n                    <div className=\"absolute top-4 left-4 bg-slate-900/80 backdrop-blur px-3 py-2 rounded-lg border border-slate-700 text-xs font-mono flex gap-2\" style={{ color: getGraphColor() }}>\n                        <Activity size={14} />\n                        {graphMode === 'x' && \"Đồ thị Li độ x(t)\"}\n                        {graphMode === 'v' && \"Đồ thị Vận tốc v(t)\"}\n                        {graphMode === 'a' && \"Đồ thị Gia tốc a(t)\"}\n                    </div>\n\n                    {/* Info Panel Integrated into Canvas (Bottom Right - MOVED HERE) */}\n                    <div className=\"absolute bottom-4 right-4 bg-slate-900/80 backdrop-blur p-3 rounded-lg border border-slate-700/50 text-xs font-mono shadow-lg min-w-[180px] z-10\">\n                        <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-slate-400\">t:</span>\n                            <span className=\"text-white\">{time.toFixed(2)}s</span>\n                        </div>\n                        <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-slate-400\">x:</span>\n                            <span className=\"text-cyan-400\">{currState.x.toFixed(1)} px</span>\n                        </div>\n                        <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-slate-400\">v:</span>\n                            <span className=\"text-green-400\">{currState.v.toFixed(1)}</span>\n                        </div>\n                        <div className=\"flex justify-between mb-1\">\n                            <span className=\"text-slate-400\">a:</span>\n                            <span className=\"text-red-400\">{currState.a.toFixed(1)}</span>\n                        </div>\n                        {beta > 0 && (\n                            <div className=\"flex justify-between border-t border-slate-700 mt-1 pt-1\">\n                                <span className=\"text-slate-500\">Env:</span>\n                                <span className=\"text-slate-300\">{currState.envelope.toFixed(1)}</span>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Signature (Bottom Left - MOVED HERE) */}\n                    <div className=\"absolute bottom-4 left-4 text-[10px] font-mono text-slate-600\">\n                        Hô Hoàng Anh A1K50\n                    </div>\n                </div>\n\n                {/* Controls */}\n                <div className=\"bg-[#1e293b] rounded-xl p-3 border border-slate-700/50 shadow-md flex items-center gap-4\">\n                    <div className=\"flex items-center gap-2\">\n                        <button onClick={handleReset} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 flex items-center justify-center transition-all active:scale-95\"><RotateCcw size={18} /></button>\n                        <button onClick={() => handleStep(-1)} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 flex items-center justify-center transition-all active:scale-95\"><SkipBack size={18} /></button>\n                        <button onClick={() => setIsPlaying(!isPlaying)} className={`w-12 h-12 rounded-xl flex items-center justify-center transition-all shadow-lg active:scale-95 ${isPlaying ? 'bg-amber-500 hover:bg-amber-400 text-white' : 'bg-cyan-500 hover:bg-cyan-400 text-white'}`}>\n                            {isPlaying ? <Pause size={24} fill=\"currentColor\" /> : <Play size={24} fill=\"currentColor\" className=\"ml-1\" />}\n                        </button>\n                        <button onClick={() => handleStep(1)} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 flex items-center justify-center transition-all active:scale-95\"><SkipForward size={18} /></button>\n                    </div>\n                    <div className=\"flex-1\"></div>\n                </div>\n\n                {/* Energy Graph */}\n                <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50 shadow-md\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                        <h3 className=\"text-xs font-bold text-yellow-500 uppercase flex items-center gap-2\"><TrendingDown size={14} /> Sự hao hụt cơ năng</h3>\n                        <div className=\"text-[10px] font-mono text-yellow-400 font-bold\">\n                            Năng lượng (W) = {(currState.w * 1000).toFixed(2)} mJ\n                        </div>\n                    </div>\n                    <div className=\"relative w-full h-32 bg-[#0f172a] rounded-lg border border-slate-700 overflow-hidden\">\n                        <canvas ref={energyCanvasRef} width={800} height={128} className=\"w-full h-full\" />\n                    </div>\n                </div>\n            </div>\n\n            {/* CỘT PHẢI */}\n            <div className=\"lg:col-span-1 space-y-4 flex flex-col\">\n                {/* Environment Selector */}\n                <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 p-4 shadow-sm\">\n                    <h3 className=\"text-slate-300 font-bold text-xs uppercase mb-3 flex items-center gap-2\"><Settings size={14} /> Môi trường cản</h3>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                        {Object.entries(ENVIRONMENTS).map(([key, val]) => {\n                            const IconComp = val.icon;\n                            return (\n                                <button key={key} onClick={() => { setEnv(key); handleReset(); }} className={`p-2 rounded-lg border text-xs font-bold flex items-center gap-2 transition-all ${env === key ? 'bg-cyan-900/40 border-cyan-500 text-cyan-400' : 'bg-slate-800 border-transparent text-slate-400 hover:bg-slate-700'}`}>\n                                    <IconComp size={14} /> {val.name}\n                                </button>\n                            )\n                        })}\n                    </div>\n                </div>\n\n                {/* Config */}\n                <ControlPanel title=\"Cấu hình hệ thống\" icon={Settings}>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <div className=\"flex justify-between text-xs text-slate-400 mb-1\"><span>Tần số (f)</span> <span className=\"text-cyan-400 font-mono\">{params.f} Hz</span></div>\n                            <input type=\"range\" min=\"0.1\" max=\"2\" step=\"0.1\" value={params.f} onChange={(e) => { setParams({ ...params, f: Number(e.target.value) }); handleReset(); }} className=\"w-full accent-cyan-500 h-1.5 bg-slate-700 rounded-lg cursor-pointer\" />\n                        </div>\n                        <div>\n                            <div className=\"flex justify-between text-xs text-slate-400 mb-1\"><span>Biên độ đầu (A)</span> <span className=\"text-cyan-400 font-mono\">{params.A} px</span></div>\n                            <input type=\"range\" min=\"20\" max=\"150\" value={params.A} onChange={(e) => { setParams({ ...params, A: Number(e.target.value) }); handleReset(); }} className=\"w-full accent-cyan-500 h-1.5 bg-slate-700 rounded-lg cursor-pointer\" />\n                        </div>\n                        <div>\n                            <div className=\"flex justify-between text-xs text-slate-400 mb-1\"><span>Pha ban đầu (φ)</span> <span className=\"text-cyan-400 font-mono\">{params.phi.toFixed(2)}</span></div>\n                            <input type=\"range\" min=\"0\" max=\"6.28\" step=\"0.1\" value={params.phi} onChange={(e) => { setParams({ ...params, phi: Number(e.target.value) }); handleReset(); }} className=\"w-full accent-cyan-500 h-1.5 bg-slate-700 rounded-lg cursor-pointer\" />\n                        </div>\n                    </div>\n                    <div className=\"mt-4 pt-4 border-t border-slate-700/50 text-xs text-slate-400 font-mono space-y-1\">\n                        <p>x = A·e^(-βt)·cos(ωt + φ)</p>\n                        <p>β = {beta} (Hệ số tắt dần)</p>\n                    </div>\n                </ControlPanel>\n            </div>\n        </div >\n    )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5070, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/harmonic-oscillation.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport { Zap, RotateCcw, SkipBack, Pause, Play, SkipForward, ChevronLeft, ChevronRight } from \"lucide-react\"\n\nimport { useCanvasScale } from \"@/hooks/use-canvas-scale\"\n\n// Special angles in degrees within one circle (0 to 360)\nconst SPECIAL_ANGLES_DEG = [0, 30, 45, 60, 90, 120, 135, 150, 180, 210, 225, 240, 270, 300, 315, 330]\nconst SPECIAL_ANGLES_RAD = SPECIAL_ANGLES_DEG.map((d) => (d * Math.PI) / 180)\n\nexport default function HarmonicOscillation() {\n  const containerRef = useRef<HTMLDivElement>(null)\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const { width, height, pixelRatio } = useCanvasScale(containerRef)\n\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [time, setTime] = useState(0)\n\n  const [showGraph, setShowGraph] = useState({ x: true, v: true, a: true })\n\n  const [params, setParams] = useState({\n    amplitude: 50,    // cm - Start with reasonable mid-range\n    frequency: 0.5,   // Hz\n    phase: 0,         // rad\n  })\n\n  const animationRef = useRef<number>()\n  const timeRef = useRef(0)\n\n  const omega = 2 * Math.PI * params.frequency\n  const T = 1 / params.frequency\n  const dt = 0.016\n\n  const calculateState = useCallback(\n    (t: number) => {\n      const x = params.amplitude * Math.cos(omega * t + params.phase)\n      const v = -params.amplitude * omega * Math.sin(omega * t + params.phase)\n      const a = -params.amplitude * omega * omega * Math.cos(omega * t + params.phase)\n      return { x, v, a }\n    },\n    [params.amplitude, omega, params.phase],\n  )\n\n  const draw = useCallback(\n    (ctx: CanvasRenderingContext2D, t: number) => {\n      // Use dimensions from hook\n      const w = width\n      const h = height\n\n      if (w === 0 || h === 0) return\n\n      ctx.clearRect(0, 0, w, h)\n\n      // Background\n      ctx.fillStyle = \"#0f172a\"\n      ctx.fillRect(0, 0, w, h)\n\n      // --- SCALING LOGIC ---\n      // Goal: \n      // 1. Circle grows with amplitude.\n      // 2. Graph height matches circle radius visually.\n      // 3. Max amplitude (150cm) must fit in view.\n\n      // Define visual constraints\n      const PADDING = 40\n      const MAX_PHYSICAL_AMPLITUDE = 150 // Matches slider max\n      const safeHeight = h - PADDING * 2\n\n      // Calculate \"Pixels per Centimeter\" scale factor\n      // Ensure the max possible amplitude fits within half the canvas height\n      const pixelsPerCm = (safeHeight / 2) / MAX_PHYSICAL_AMPLITUDE\n\n      // Current visual radius based on physical amplitude\n      const visualRadius = params.amplitude * pixelsPerCm\n\n      // Layout Layout\n      const isSmallScreen = w < 800\n      // Ensure circle section is wide enough for the circle + margin\n      const minCircleSection = visualRadius * 2 + 80\n      const circleSectionWidth = isSmallScreen ? w : Math.max(300, minCircleSection)\n\n      const graphStartX = isSmallScreen ? 20 : circleSectionWidth + 20\n      const graphWidth = isSmallScreen ? w - 40 : w - graphStartX - 20\n\n      const centerX = isSmallScreen ? w / 2 : circleSectionWidth / 2\n      // If small screen, stack circle on top or just center? Let's keep side-by-side logic but condensed\n      // actually if w < 600, side-by-side is bad. But user asked for \"tall\" view.\n      // Let's stick to the requested layout, just adjusting centers.\n\n      const centerY = h / 2\n\n      // --- CIRCLE SECTION ---\n\n      const angle = omega * t + params.phase\n\n      // Circle Axes\n      ctx.strokeStyle = \"#1e293b\"\n      ctx.lineWidth = 1\n      ctx.beginPath()\n      ctx.moveTo(centerX, centerY - visualRadius - 20); ctx.lineTo(centerX, centerY + visualRadius + 20)\n      ctx.moveTo(centerX - visualRadius - 20, centerY); ctx.lineTo(centerX + visualRadius + 20, centerY)\n      ctx.stroke()\n\n      // Main Reference Circle\n      ctx.strokeStyle = \"#475569\"\n      ctx.lineWidth = 2\n      ctx.beginPath()\n      ctx.arc(centerX, centerY, visualRadius, 0, 2 * Math.PI)\n      ctx.stroke()\n\n      // Rotating Vector\n      const vectorX = centerX + visualRadius * Math.cos(angle)\n      const vectorY = centerY - visualRadius * Math.sin(angle)\n\n      ctx.strokeStyle = \"#f97316\"\n      ctx.lineWidth = 3\n      ctx.beginPath()\n      ctx.moveTo(centerX, centerY)\n      ctx.lineTo(vectorX, vectorY)\n      ctx.stroke()\n\n      // Vector Tip\n      ctx.fillStyle = \"#f97316\"\n      ctx.beginPath()\n      ctx.arc(vectorX, vectorY, 5, 0, 2 * Math.PI)\n      ctx.fill()\n\n      // Shadow projection to X-axis (to show relationship)\n      ctx.strokeStyle = \"rgba(249, 115, 22, 0.3)\"\n      ctx.setLineDash([4, 4])\n      ctx.beginPath()\n      ctx.moveTo(vectorX, vectorY)\n      ctx.lineTo(vectorX, centerY) // Project vertically to horizontal diameter? \n      // Wait, standard projection for x = A cos(wt) is usually onto the horizontal axis (x-axis)\n      ctx.stroke()\n      ctx.setLineDash([])\n\n      // --- GRAPH SECTION ---\n\n      const graphTop = 20\n      const graphBottom = h - 20\n      const graphAxisY = h / 2\n\n      // Axis Line\n      ctx.strokeStyle = \"#334155\"\n      ctx.lineWidth = 1\n      ctx.beginPath()\n      ctx.moveTo(graphStartX, graphAxisY)\n      ctx.lineTo(graphStartX + graphWidth, graphAxisY)\n      ctx.stroke()\n\n      // Time Window\n      const timeWindow = 2.5 * T\n      const tEnd = t\n      const tStart = t - timeWindow\n\n      const drawCurve = (\n        getValue: (wt: number) => number,\n        color: string,\n        scaleFactor: number // Multiplier for the base scale\n      ) => {\n        ctx.strokeStyle = color\n        ctx.lineWidth = 2\n        ctx.beginPath()\n\n        const step = 2\n        let started = false\n\n        for (let i = 0; i <= graphWidth; i += step) {\n          const waveT = tStart + (i / graphWidth) * timeWindow\n          if (waveT < 0) continue\n\n          const val = getValue(waveT)\n          // Y position: Center - (ValueInCm * PixelsPerCm * ScaleFactor)\n          // For x(t), ScaleFactor = 1. So it visually matches the circle radius.\n          const y = graphAxisY - (val * pixelsPerCm * scaleFactor)\n\n          if (!started) {\n            ctx.moveTo(graphStartX + i, y)\n            started = true\n          } else {\n            ctx.lineTo(graphStartX + i, y)\n          }\n        }\n        ctx.stroke()\n\n        // Current Value Dot\n        const currentVal = getValue(t)\n        const currentY = graphAxisY - (currentVal * pixelsPerCm * scaleFactor)\n\n        ctx.fillStyle = color\n        ctx.beginPath()\n        ctx.arc(graphStartX + graphWidth, currentY, 4, 0, 2 * Math.PI)\n        ctx.fill()\n\n        // Connect vector projection to graph if it's x(t)\n        if (color === \"#ef4444\" && !isSmallScreen) {\n          ctx.strokeStyle = \"rgba(239, 68, 68, 0.2)\"\n          ctx.setLineDash([2, 5])\n          ctx.beginPath()\n          // Connection line logic is tricky if circle and graph are side-by-side but time flows right.\n          // Usually we project from the circle y-value to graph y-value.\n          // But here circle is rotating for x = A cos...\n          // If we rotate exactly, x matches the horizontal position on circle.\n          // Graph plots x on Y axis vs t on X axis.\n          // So connection is meaningless unless we rotate circle 90 degrees.\n          // Let's just draw the dot.\n        }\n      }\n\n      // Draw Curves\n      // x(t) - Red\n      if (showGraph.x) {\n        drawCurve(\n          (wt) => params.amplitude * Math.cos(omega * wt + params.phase),\n          \"#ef4444\",\n          1 // 1:1 scale with circle\n        )\n      }\n\n      // v(t) - Green\n      // v_max = A * omega. This can be much larger than A.\n      // We need to scale it to fit visually or use a normalized scale.\n      // User request implies \"graph equals circle circle\". \n      // If we plot physical V, it might go off screen.\n      // Let's normalize v such that its visual Max equals the visual Radius?\n      // \"đồ thị sẽ bằng với vòng tròn lượng giác\" usually implies visual comparison of x.\n      // For v and a, we usually auto-scale them to fit roughly same height for comparison,\n      // OR we use the physical scale. \n      // Given the prompt \"adjust amplitude -> circle grows -> graph size matches\", strictly applies to x(t).\n      // For v(t) and a(t), let's auto-scale to roughly the 80% height of canvas to be readable, \n      // or scale them relative to A*omega.\n      // Let's stick to readable auto-scale for v and a relative to amplitude logic.\n      if (showGraph.v) {\n        // Scale v so that Vmax visually is roughly Amax visually?\n        // v_max = A * w.\n        // pixelY = v * (pixelsPerCm / w) -> cancels w units?\n        // Let's just scale it so Vmax looks like Amax on screen for easy phase comparison.\n        // factor = 1/omega\n        drawCurve(\n          (wt) => -params.amplitude * omega * Math.sin(omega * wt + params.phase),\n          \"#22c55e\",\n          1.0 / (omega || 1) // Normalized to amplitude visual height\n        )\n      }\n\n      if (showGraph.a) {\n        // a_max = A * w^2\n        // factor = 1/omega^2\n        drawCurve(\n          (wt) => -params.amplitude * omega * omega * Math.cos(omega * wt + params.phase),\n          \"#3b82f6\",\n          1.0 / ((omega * omega) || 1)\n        )\n      }\n\n      // Signature\n      ctx.fillStyle = \"rgba(255, 255, 255, 0.15)\"\n      ctx.font = \"12px monospace\"\n      ctx.textAlign = \"right\"\n      ctx.fillText(\"Hô Hoàng Anh A1K50\", w - 15, h - 15)\n\n      // Stats Info\n      const currentState = calculateState(t)\n      const infoWidth = 160\n      const infoHeight = 110\n      ctx.fillStyle = \"rgba(15, 23, 42, 0.9)\"\n      ctx.fillRect(10, 10, infoWidth, infoHeight)\n      ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"\n      ctx.strokeRect(10, 10, infoWidth, infoHeight)\n\n      ctx.font = \"13px monospace\"\n      ctx.textAlign = \"left\"\n      ctx.fillStyle = \"#e2e8f0\"; ctx.fillText(`t = ${t.toFixed(3)}s`, 20, 30)\n      ctx.fillStyle = \"#ef4444\"; ctx.fillText(`x = ${currentState.x.toFixed(2)} cm`, 20, 55)\n      ctx.fillStyle = \"#22c55e\"; ctx.fillText(`v = ${currentState.v.toFixed(2)} cm/s`, 20, 75)\n      ctx.fillStyle = \"#3b82f6\"; ctx.fillText(`a = ${currentState.a.toFixed(2)} cm/s²`, 20, 95)\n    },\n    [params.amplitude, params.phase, omega, calculateState, showGraph, T, width, height],\n  )\n\n  const animate = useCallback(() => {\n    if (!canvasRef.current || width === 0 || height === 0) return\n\n    const canvas = canvasRef.current\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n\n    if (canvas.width !== width * pixelRatio || canvas.height !== height * pixelRatio) {\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n    }\n\n    ctx.save()\n    ctx.scale(pixelRatio, pixelRatio)\n\n    if (isPlaying) {\n      timeRef.current += dt\n      setTime(timeRef.current)\n    }\n\n    draw(ctx, timeRef.current)\n    ctx.restore()\n\n    if (isPlaying) {\n      animationRef.current = requestAnimationFrame(animate)\n    }\n  }, [isPlaying, draw, width, height, pixelRatio])\n\n  useEffect(() => {\n    if (isPlaying) {\n      animationRef.current = requestAnimationFrame(animate)\n    }\n    return () => {\n      if (animationRef.current) cancelAnimationFrame(animationRef.current)\n    }\n  }, [isPlaying, animate])\n\n  // Resize / Redraw Effect\n  useEffect(() => {\n    if (!isPlaying && canvasRef.current && width > 0 && height > 0) {\n      const canvas = canvasRef.current\n      const ctx = canvas.getContext(\"2d\")\n      if (!ctx) return\n\n      if (canvas.width !== width * pixelRatio || canvas.height !== height * pixelRatio) {\n        canvas.width = width * pixelRatio\n        canvas.height = height * pixelRatio\n      }\n\n      ctx.save()\n      ctx.scale(pixelRatio, pixelRatio)\n      draw(ctx, timeRef.current)\n      ctx.restore()\n    }\n  }, [isPlaying, draw, width, height, pixelRatio])\n\n  const handleManualUpdate = (newTime: number) => {\n    // setIsPlaying(false) // Don't force pause, just jump? The UI suggests these are transport controls.\n    // Usually seek pauses playback or just jumps. Let's pause to be safe.\n    setIsPlaying(false)\n    timeRef.current = Math.max(0, newTime)\n    setTime(timeRef.current)\n    // Draw will happen via useEffect above because isPlaying became false\n  }\n\n  const handleSkip = (direction: number) => {\n    handleManualUpdate(timeRef.current + direction * 0.5)\n  }\n\n  const handleReset = () => {\n    handleManualUpdate(0)\n  }\n\n  const handleMicroStep = (direction: number) => {\n    // Logic as before\n    const stepTime = T / 80\n    const epsilon = 1e-4\n    const currentPhaseTotal = omega * timeRef.current + params.phase\n    const currentPhaseNorm = currentPhaseTotal % (2 * Math.PI)\n    const currentPhasePos = currentPhaseNorm < 0 ? currentPhaseNorm + 2 * Math.PI : currentPhaseNorm\n    let targetTime = timeRef.current + direction * stepTime\n    const stepPhase = (2 * Math.PI) / 80\n\n    if (direction > 0) {\n      let nextSpecial = SPECIAL_ANGLES_RAD.find(a => a > currentPhasePos + epsilon)\n      let distance = 0\n      if (nextSpecial !== undefined) distance = nextSpecial - currentPhasePos\n      else {\n        nextSpecial = SPECIAL_ANGLES_RAD[0] + 2 * Math.PI\n        distance = nextSpecial - currentPhasePos\n      }\n      if (distance <= stepPhase + epsilon) targetTime = timeRef.current + distance / omega\n    } else {\n      const reversed = [...SPECIAL_ANGLES_RAD].reverse()\n      let prevSpecial = reversed.find(a => a < currentPhasePos - epsilon)\n      let distance = 0\n      if (prevSpecial !== undefined) distance = currentPhasePos - prevSpecial\n      else {\n        prevSpecial = SPECIAL_ANGLES_RAD[SPECIAL_ANGLES_RAD.length - 1] - 2 * Math.PI\n        distance = currentPhasePos - prevSpecial\n      }\n      if (distance <= stepPhase + epsilon) targetTime = timeRef.current - distance / omega\n    }\n    handleManualUpdate(targetTime)\n  }\n\n  const state = calculateState(time)\n  const kineticEnergy = (0.5 * state.v * state.v) / 10000\n  const potentialEnergy = (0.5 * omega * omega * state.x * state.x) / 10000\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n      <div className=\"lg:col-span-2 space-y-4\">\n        {/* Main Canvas Container */}\n        <div\n          ref={containerRef}\n          className=\"bg-[#1e293b] rounded-xl overflow-hidden border border-slate-700/50 relative w-full h-[75vh] min-h-[550px]\"\n        >\n          {/* Controls Overlay */}\n          <div className=\"absolute top-4 right-4 flex gap-2 z-10 bg-[#0f172a]/80 p-1 rounded-lg backdrop-blur-sm border border-slate-700\">\n            <button\n              onClick={() => setShowGraph((p) => ({ ...p, x: !p.x }))}\n              className={`px-2 py-1 text-[10px] font-bold rounded transition-all ${showGraph.x ? \"bg-red-500 text-white\" : \"bg-slate-700 text-slate-400\"}`}\n            >\n              x(t)\n            </button>\n            <button\n              onClick={() => setShowGraph((p) => ({ ...p, v: !p.v }))}\n              className={`px-2 py-1 text-[10px] font-bold rounded transition-all ${showGraph.v ? \"bg-green-500 text-white\" : \"bg-slate-700 text-slate-400\"}`}\n            >\n              v(t)\n            </button>\n            <button\n              onClick={() => setShowGraph((p) => ({ ...p, a: !p.a }))}\n              className={`px-2 py-1 text-[10px] font-bold rounded transition-all ${showGraph.a ? \"bg-blue-500 text-white\" : \"bg-slate-700 text-slate-400\"}`}\n            >\n              a(t)\n            </button>\n          </div>\n\n          <canvas ref={canvasRef} className=\"w-full h-full block\" />\n        </div>\n\n        {/* Playback Controls */}\n        <div className=\"bg-[#1e293b] rounded-xl p-3 border border-slate-700/50 flex flex-wrap items-center justify-center gap-3\">\n          <button onClick={handleReset} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <RotateCcw size={16} />\n          </button>\n          <div className=\"w-[1px] h-8 bg-slate-700 mx-1\"></div>\n          <button onClick={() => handleSkip(-1)} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <SkipBack size={16} />\n          </button>\n          <button onClick={() => handleMicroStep(-1)} className=\"w-12 h-12 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-600 text-cyan-400 flex items-center justify-center transition-all shadow-md active:scale-95 ring-1 ring-slate-700/50\">\n            <ChevronLeft size={24} />\n          </button>\n          <button\n            onClick={() => setIsPlaying(!isPlaying)}\n            className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg active:scale-95 border border-transparent mx-2 ${isPlaying ? \"bg-amber-500 hover:bg-amber-400 shadow-amber-900/20\" : \"bg-cyan-500 hover:bg-cyan-400 shadow-cyan-500/30\"\n              } text-white`}\n          >\n            {isPlaying ? <Pause size={28} fill=\"currentColor\" /> : <Play size={28} fill=\"currentColor\" className=\"ml-1\" />}\n          </button>\n          <button onClick={() => handleMicroStep(1)} className=\"w-12 h-12 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-600 text-cyan-400 flex items-center justify-center transition-all shadow-md active:scale-95 ring-1 ring-slate-700/50\">\n            <ChevronRight size={24} />\n          </button>\n          <button onClick={() => handleSkip(1)} className=\"w-10 h-10 rounded-lg bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\">\n            <SkipForward size={16} />\n          </button>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {/* Parameters */}\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-4 text-sm\">Thông số dao động</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Biên độ A</label>\n                <span className=\"text-cyan-400 font-mono\">{params.amplitude} cm</span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"10\"\n                max=\"150\"\n                value={params.amplitude}\n                onChange={(e) => setParams({ ...params, amplitude: Number(e.target.value) })}\n                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\"\n              />\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Tần số f (Chu kỳ T = {(1 / params.frequency).toFixed(2)}s)</label>\n                <span className=\"text-cyan-400 font-mono\">{params.frequency} Hz</span>\n              </div>\n              <input type=\"range\" min=\"0.1\" max=\"2\" step=\"0.1\" value={params.frequency} onChange={(e) => setParams({ ...params, frequency: Number(e.target.value) })} className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\" />\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Pha ban đầu φ</label>\n                <span className=\"text-cyan-400 font-mono\">{params.phase.toFixed(2)} rad</span>\n              </div>\n              <input type=\"range\" min=\"0\" max={Math.PI * 2} step=\"0.1\" value={params.phase} onChange={(e) => setParams({ ...params, phase: Number(e.target.value) })} className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Energy */}\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-amber-400 font-semibold mb-3 text-sm flex items-center gap-2\">\n            <Zap size={14} /> Năng lượng\n          </h3>\n          <div className=\"space-y-3\">\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <span className=\"text-green-400\">Động năng Wđ</span>\n                <span className=\"text-green-400 font-mono\">{kineticEnergy.toFixed(3)} J</span>\n              </div>\n              <div className=\"h-2 bg-slate-700 rounded-full overflow-hidden\">\n                <div className=\"h-full bg-green-500 transition-all duration-100\" style={{ width: `${(kineticEnergy / (kineticEnergy + potentialEnergy || 1)) * 100}%` }} />\n              </div>\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <span className=\"text-blue-400\">Thế năng Wt</span>\n                <span className=\"text-blue-400 font-mono\">{potentialEnergy.toFixed(3)} J</span>\n              </div>\n              <div className=\"h-2 bg-slate-700 rounded-full overflow-hidden\">\n                <div className=\"h-full bg-blue-500 transition-all duration-100\" style={{ width: `${(potentialEnergy / (kineticEnergy + potentialEnergy || 1)) * 100}%` }} />\n              </div>\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <span className=\"text-yellow-400\">Cơ năng W</span>\n                <span className=\"text-yellow-400 font-mono\">{(kineticEnergy + potentialEnergy).toFixed(3)} J</span>\n              </div>\n              <div className=\"h-2 bg-yellow-500/30 rounded-full\" />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-2 text-sm\">Công thức</h3>\n          <div className=\"text-xs text-slate-300 space-y-1 font-mono\">\n            <p className=\"flex justify-between\"><span>x = A·cos(ωt + φ)</span> <span className=\"text-red-400\">Li độ</span></p>\n            <p className=\"flex justify-between\"><span>v = -Aω·sin(ωt + φ)</span> <span className=\"text-green-400\">Vận tốc</span></p>\n            <p className=\"flex justify-between\"><span>a = -Aω²·cos(ωt + φ)</span> <span className=\"text-blue-400\">Gia tốc</span></p>\n            <div className=\"w-full h-[1px] bg-slate-700 my-2\"></div>\n            <p>ω = 2πf = {omega.toFixed(2)} rad/s</p>\n            <p>T = 1/f = {(1 / params.frequency).toFixed(2)} s</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6206, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/mechanical-waves.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport { Play, Pause, RotateCcw, SkipForward, SkipBack } from \"lucide-react\"\n\n\n\nexport default function MechanicalWaves() {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [time, setTime] = useState(0)\n  const [waveType, setWaveType] = useState<\"transverse\" | \"longitudinal\">(\"transverse\")\n  const [params, setParams] = useState({\n    amplitude: 40,\n    wavelength: 150,\n    frequency: 0.5,\n  })\n\n  const animationRef = useRef<number>()\n  const timeRef = useRef(0)\n\n  const omega = 2 * Math.PI * params.frequency\n  const k = (2 * Math.PI) / params.wavelength\n  const velocity = params.frequency * params.wavelength\n  const dt = 0.016\n  const numParticles = 40\n\n  const draw = useCallback(\n    (ctx: CanvasRenderingContext2D, t: number) => {\n      const width = ctx.canvas.width\n      const height = ctx.canvas.height\n\n      ctx.fillStyle = \"#0f172a\"\n      ctx.fillRect(0, 0, width, height)\n\n      // Grid\n      ctx.strokeStyle = \"#1e293b\"\n      ctx.lineWidth = 0.5\n      for (let i = 0; i < width; i += 40) {\n        ctx.beginPath()\n        ctx.moveTo(i, 0)\n        ctx.lineTo(i, height)\n        ctx.stroke()\n      }\n      for (let i = 0; i < height; i += 40) {\n        ctx.beginPath()\n        ctx.moveTo(0, i)\n        ctx.lineTo(width, i)\n        ctx.stroke()\n      }\n\n      const centerY = height / 2\n      const startX = 50\n      const spacing = (width - 100) / numParticles\n\n      if (waveType === \"transverse\") {\n        ctx.strokeStyle = \"#4ade80\"\n        ctx.setLineDash([5, 5])\n        ctx.beginPath()\n        ctx.moveTo(startX, centerY)\n        ctx.lineTo(width - 50, centerY)\n        ctx.stroke()\n        ctx.setLineDash([])\n\n        ctx.strokeStyle = \"#22d3ee\"\n        ctx.lineWidth = 2\n        ctx.beginPath()\n        for (let x = startX; x < width - 50; x++) {\n          const y = centerY - params.amplitude * Math.sin(k * (x - startX) - omega * t)\n          if (x === startX) ctx.moveTo(x, y)\n          else ctx.lineTo(x, y)\n        }\n        ctx.stroke()\n\n        for (let i = 0; i < numParticles; i++) {\n          const x = startX + i * spacing\n          const displacement = params.amplitude * Math.sin(k * (x - startX) - omega * t)\n          const y = centerY - displacement\n          const vy = -params.amplitude * omega * Math.cos(k * (x - startX) - omega * t)\n\n          ctx.fillStyle = \"#3b82f6\"\n          ctx.beginPath()\n          ctx.arc(x, y, 6, 0, 2 * Math.PI)\n          ctx.fill()\n\n          if (Math.abs(vy) > 1) {\n            ctx.strokeStyle = \"#22c55e\"\n            ctx.lineWidth = 2\n            ctx.beginPath()\n            ctx.moveTo(x, y)\n            ctx.lineTo(x, y - vy * 0.3)\n            ctx.stroke()\n          }\n\n          ctx.fillStyle = \"rgba(74, 222, 128, 0.3)\"\n          ctx.beginPath()\n          ctx.arc(x, centerY, 3, 0, 2 * Math.PI)\n          ctx.fill()\n        }\n\n        ctx.fillStyle = \"#f97316\"\n        ctx.font = \"14px sans-serif\"\n        ctx.textAlign = \"center\"\n        ctx.fillText(\"↕ Hướng dao động\", width / 2, 40)\n        ctx.fillText(\"→ Hướng truyền sóng\", width / 2, 60)\n        ctx.textAlign = \"left\" // Reset alignment\n      } else {\n        ctx.strokeStyle = \"#4ade80\"\n        ctx.setLineDash([5, 5])\n        ctx.beginPath()\n        ctx.moveTo(startX, centerY)\n        ctx.lineTo(width - 50, centerY)\n        ctx.stroke()\n        ctx.setLineDash([])\n\n        for (let i = 0; i < numParticles; i++) {\n          const baseX = startX + i * spacing\n          const displacement = params.amplitude * 0.5 * Math.sin(k * (baseX - startX) - omega * t)\n          const x = baseX + displacement\n          const vx = params.amplitude * 0.5 * omega * Math.cos(k * (baseX - startX) - omega * t)\n\n          const density = Math.cos(k * (baseX - startX) - omega * t)\n          const alpha = 0.5 + 0.5 * Math.abs(density)\n          ctx.fillStyle = density > 0 ? `rgba(239, 68, 68, ${alpha})` : `rgba(59, 130, 246, ${alpha})`\n\n          ctx.beginPath()\n          ctx.arc(x, centerY, 8, 0, 2 * Math.PI)\n          ctx.fill()\n\n          if (Math.abs(vx) > 1) {\n            ctx.strokeStyle = \"#22c55e\"\n            ctx.lineWidth = 2\n            ctx.beginPath()\n            ctx.moveTo(x, centerY)\n            ctx.lineTo(x + vx * 0.3, centerY)\n            ctx.stroke()\n          }\n\n          ctx.fillStyle = \"rgba(74, 222, 128, 0.3)\"\n          ctx.beginPath()\n          ctx.arc(baseX, centerY + 40, 3, 0, 2 * Math.PI)\n          ctx.fill()\n        }\n\n        ctx.fillStyle = \"#ef4444\"\n        ctx.font = \"12px monospace\"\n        ctx.fillText(\"Nén\", width / 2 - 100, centerY - 50)\n        ctx.fillStyle = \"#3b82f6\"\n        ctx.fillText(\"Dãn\", width / 2 + 50, centerY - 50)\n\n        ctx.fillStyle = \"#f97316\"\n        ctx.font = \"14px sans-serif\"\n        ctx.textAlign = \"center\"\n        ctx.fillText(\"↔ Hướng dao động\", width / 2, 40)\n        ctx.fillText(\"→ Hướng truyền sóng\", width / 2, 60)\n        ctx.textAlign = \"left\" // Reset alignment\n      }\n\n      // Info panel\n      ctx.fillStyle = \"rgba(15, 23, 42, 0.8)\"\n      ctx.fillRect(10, height - 100, 180, 90)\n      ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"\n      ctx.strokeRect(10, height - 100, 180, 90)\n\n      ctx.fillStyle = \"#4ade80\"\n      ctx.font = \"13px monospace\"\n      ctx.fillText(`t = ${t.toFixed(2)} s`, 20, height - 80)\n      ctx.fillText(`λ = ${params.wavelength} px`, 20, height - 60)\n      ctx.fillText(`f = ${params.frequency} Hz`, 20, height - 40)\n      ctx.fillText(`v = ${velocity.toFixed(0)} px/s`, 20, height - 20)\n\n      ctx.fillStyle = \"rgba(255, 255, 255, 0.15)\"\n      ctx.font = \"12px monospace\"\n      ctx.textAlign = \"right\"\n      ctx.fillText(\"Hô Hoàng Anh A1K50\", width - 15, height - 15)\n      ctx.textAlign = \"left\"\n    },\n    [waveType, params.amplitude, params.wavelength, params.frequency, omega, k, velocity],\n  )\n\n  const animate = useCallback(() => {\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n\n    timeRef.current += dt\n    setTime(timeRef.current)\n    draw(ctx, timeRef.current)\n\n    if (isPlaying) {\n      animationRef.current = requestAnimationFrame(animate)\n    }\n  }, [isPlaying, draw])\n\n  useEffect(() => {\n    if (isPlaying) {\n      animationRef.current = requestAnimationFrame(animate)\n    }\n    return () => {\n      if (animationRef.current) cancelAnimationFrame(animationRef.current)\n    }\n  }, [isPlaying, animate])\n\n  useEffect(() => {\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n    draw(ctx, timeRef.current)\n  }, [params, waveType, draw])\n\n  const handleStep = (direction: number) => {\n    setIsPlaying(false)\n    timeRef.current = Math.max(0, timeRef.current + dt * direction * 10)\n    setTime(timeRef.current)\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n    draw(ctx, timeRef.current)\n  }\n\n  const handleReset = () => {\n    setIsPlaying(false)\n    timeRef.current = 0\n    setTime(0)\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n    draw(ctx, 0)\n  }\n\n  const handleTimelineChange = (newTime: number) => {\n    setIsPlaying(false)\n    timeRef.current = newTime\n    setTime(newTime)\n    const canvas = canvasRef.current\n    if (!canvas) return\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n    draw(ctx, newTime)\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n      <div className=\"lg:col-span-2 space-y-4\">\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <canvas ref={canvasRef} width={800} height={400} className=\"w-full rounded-lg bg-[#0f172a]\" />\n        </div>\n\n        <div className=\"bg-[#1e293b] rounded-xl p-3 border border-slate-700/50 flex items-center gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={handleReset}\n              className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\"\n              title=\"Reset\"\n            >\n              <RotateCcw size={20} />\n            </button>\n            <button\n              onClick={() => handleStep(-1)}\n              className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\"\n              title=\"Lùi\"\n            >\n              <SkipBack size={20} />\n            </button>\n            <button\n              onClick={() => setIsPlaying(!isPlaying)}\n              className={`w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg active:scale-95 border border-transparent ${isPlaying\n                ? \"bg-amber-500 hover:bg-amber-400 shadow-amber-900/20\"\n                : \"bg-cyan-500 hover:bg-cyan-400 shadow-cyan-500/30\"\n                } text-white`}\n              title={isPlaying ? \"Dừng\" : \"Chạy\"}\n            >\n              {isPlaying ? (\n                <Pause size={28} fill=\"currentColor\" />\n              ) : (\n                <Play size={28} fill=\"currentColor\" className=\"ml-1\" />\n              )}\n            </button>\n            <button\n              onClick={() => handleStep(1)}\n              className=\"w-12 h-12 rounded-xl bg-slate-700 hover:bg-slate-600 border border-slate-600 text-white flex items-center justify-center transition-all shadow-md active:scale-95\"\n              title=\"Tiến\"\n            >\n              <SkipForward size={20} />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-3 text-sm\">Loại sóng</h3>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => setWaveType(\"transverse\")}\n              className={`flex-1 py-3 px-4 rounded-lg text-sm font-semibold transition-all border ${waveType === \"transverse\"\n                ? \"bg-cyan-600 border-cyan-500 text-white shadow\"\n                : \"bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700\"\n                }`}\n            >\n              Sóng ngang\n            </button>\n            <button\n              onClick={() => setWaveType(\"longitudinal\")}\n              className={`flex-1 py-3 px-4 rounded-lg text-sm font-semibold transition-all border ${waveType === \"longitudinal\"\n                ? \"bg-cyan-600 border-cyan-500 text-white shadow\"\n                : \"bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700\"\n                }`}\n            >\n              Sóng dọc\n            </button>\n          </div>\n        </div>\n\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-4 text-sm\">Thông số sóng</h3>\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Biên độ A</label>\n                <span className=\"text-cyan-400 font-mono\">{params.amplitude} px</span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"10\"\n                max=\"80\"\n                value={params.amplitude}\n                onChange={(e) => setParams({ ...params, amplitude: Number(e.target.value) })}\n                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\"\n              />\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Bước sóng λ</label>\n                <span className=\"text-cyan-400 font-mono\">{params.wavelength} px</span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"50\"\n                max=\"300\"\n                value={params.wavelength}\n                onChange={(e) => setParams({ ...params, wavelength: Number(e.target.value) })}\n                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\"\n              />\n            </div>\n            <div>\n              <div className=\"flex justify-between text-xs mb-1\">\n                <label className=\"text-slate-400\">Tần số f</label>\n                <span className=\"text-cyan-400 font-mono\">{params.frequency} Hz</span>\n              </div>\n              <input\n                type=\"range\"\n                min=\"0.1\"\n                max=\"2\"\n                step=\"0.1\"\n                value={params.frequency}\n                onChange={(e) => setParams({ ...params, frequency: Number(e.target.value) })}\n                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg cursor-pointer\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50\">\n          <h3 className=\"text-cyan-400 font-semibold mb-2 text-sm\">Công thức</h3>\n          <div className=\"text-xs text-slate-300 space-y-1 font-mono\">\n            <p>y = A·sin(kx - ωt)</p>\n            <p>v = λf = {velocity.toFixed(0)} px/s</p>\n            <p>k = 2π/λ = {k.toFixed(3)} rad/px</p>\n            <p>ω = 2πf = {omega.toFixed(2)} rad/s</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6895, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/sound-waves.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Play, Pause, Mic, MicOff, Activity, Settings, RefreshCw, Volume2, Info, BookOpen, RotateCcw, SkipBack, SkipForward, BarChart3, Radio } from 'lucide-react';\n\n// --- COMPONENT CON ---\nconst ControlPanel = ({ title, icon: Icon, children }: { title: string; icon?: any; children: React.ReactNode }) => (\n  <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 shadow-sm overflow-hidden flex flex-col h-full\">\n    <div className=\"bg-slate-800/50 px-4 py-3 border-b border-slate-700/50 flex items-center gap-2\">\n      {Icon && <Icon size={16} className=\"text-cyan-400\"/>}\n      <h3 className=\"text-slate-300 font-bold text-xs uppercase tracking-wider\">{title}</h3>\n    </div>\n    <div className=\"p-4 space-y-4 flex-1\">{children}</div>\n  </div>\n)\n\nconst StatBox = ({ label, value, unit, color = \"text-slate-200\" }: { label: string, value: string | number, unit?: string, color?: string }) => (\n    <div className=\"bg-slate-900/50 rounded-lg p-2 border border-slate-700/50 flex flex-col items-center justify-center min-w-[80px]\">\n        <div className=\"text-[10px] text-slate-500 uppercase font-semibold mb-1\">{label}</div>\n        <div className={`text-lg font-mono font-bold ${color}`}>\n            {value} <span className=\"text-xs font-normal text-slate-500\">{unit}</span>\n        </div>\n    </div>\n)\n\nconst SoundWaveLab = () => {\n  // --- STATE ---\n  const [isListening, setIsListening] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isFrozen, setIsFrozen] = useState(false);\n  \n  // Physics & Measurement\n  const [frequency, setFrequency] = useState(0); // Measured freq\n  const [medium, setMedium] = useState('air'); \n  const [velocity, setVelocity] = useState(343); \n\n  // Generator\n  const [genFreq, setGenFreq] = useState(440); \n  const [genType, setGenType] = useState<OscillatorType>('sine');\n  const [genVolume, setGenVolume] = useState(0.5);\n\n  // --- REFS ---\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const microphoneRef = useRef<MediaStreamAudioSourceNode | null>(null);\n  const oscillatorRef = useRef<OscillatorNode | null>(null);\n  const gainNodeRef = useRef<GainNode | null>(null);\n  const requestRef = useRef<number | null>(null);\n  \n  const canvasTimeRef = useRef<HTMLCanvasElement>(null); // Oscilloscope\n  const canvasFreqRef = useRef<HTMLCanvasElement>(null); // Spectrum\n  \n  const timeDataRef = useRef(new Uint8Array(0));\n  const freqDataRef = useRef(new Uint8Array(0));\n\n  const MEDIUMS: Record<string, { name: string; v: number }> = {\n    air: { name: 'Không khí (20°C)', v: 343 },\n    water: { name: 'Nước (25°C)', v: 1493 },\n    soil: { name: 'Đất', v: 3000 },\n  };\n\n  const WAVEFORMS: Record<string, string> = {\n      sine: 'Hình Sin',\n      square: 'Hình Vuông',\n      sawtooth: 'Răng Cưa',\n      triangle: 'Tam Giác'\n  };\n\n  useEffect(() => {\n    setVelocity(MEDIUMS[medium].v);\n  }, [medium]);\n\n  // --- AUDIO LOGIC ---\n  const initAudio = async () => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    if (audioContextRef.current?.state === 'suspended') await audioContextRef.current.resume();\n  };\n\n  const startMicrophone = async () => {\n    try {\n      await initAudio();\n      if (!audioContextRef.current) return;\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      setupAnalyser();\n      microphoneRef.current = audioContextRef.current.createMediaStreamSource(stream);\n      microphoneRef.current.connect(analyserRef.current!);\n      setIsListening(true);\n      setIsGenerating(false);\n      setIsFrozen(false);\n    } catch (err) { alert(\"Cần cấp quyền Micro!\"); }\n  };\n\n  const startGenerator = async () => {\n    await initAudio();\n    if (!audioContextRef.current) return;\n    if (isListening) stopMicrophone();\n    \n    setupAnalyser();\n    oscillatorRef.current = audioContextRef.current.createOscillator();\n    gainNodeRef.current = audioContextRef.current.createGain();\n    \n    oscillatorRef.current.type = genType;\n    oscillatorRef.current.frequency.setValueAtTime(genFreq, audioContextRef.current.currentTime);\n    gainNodeRef.current!.gain.setValueAtTime(genVolume, audioContextRef.current.currentTime);\n    \n    oscillatorRef.current.connect(gainNodeRef.current!);\n    gainNodeRef.current!.connect(analyserRef.current!);\n    gainNodeRef.current!.connect(audioContextRef.current.destination);\n    \n    oscillatorRef.current.start();\n    setIsGenerating(true);\n    setIsListening(false);\n    setIsFrozen(false);\n  };\n\n  const setupAnalyser = () => {\n      if(!audioContextRef.current) return;\n      analyserRef.current = audioContextRef.current.createAnalyser();\n      analyserRef.current.fftSize = 2048;\n      analyserRef.current.smoothingTimeConstant = 0.8;\n  }\n\n  const stopMicrophone = () => {\n    microphoneRef.current?.disconnect();\n    microphoneRef.current = null;\n    setIsListening(false);\n  };\n\n  const stopGenerator = () => {\n    try { oscillatorRef.current?.stop(); } catch(e){}\n    oscillatorRef.current?.disconnect();\n    oscillatorRef.current = null;\n    setIsGenerating(false);\n  };\n\n  const updateGen = (freq: number, type: OscillatorType, vol: number) => {\n    if (audioContextRef.current && oscillatorRef.current && gainNodeRef.current) {\n      oscillatorRef.current.frequency.setValueAtTime(freq, audioContextRef.current.currentTime);\n      oscillatorRef.current.type = type;\n      gainNodeRef.current.gain.setValueAtTime(vol, audioContextRef.current.currentTime);\n    }\n    setGenFreq(freq); setGenType(type); setGenVolume(vol);\n  };\n\n  const getPitch = (buffer: Uint8Array, sampleRate: number) => {\n    let maxVal = -Infinity; let maxIndex = -1;\n    for (let i = 1; i < buffer.length / 2; i++) {\n      if (buffer[i] > maxVal) { maxVal = buffer[i]; maxIndex = i; }\n    }\n    if (maxVal < 100) return 0; // Noise gate\n    // Interpolation\n    const prev = buffer[maxIndex - 1]; const next = buffer[maxIndex + 1]; const curr = buffer[maxIndex];\n    const trueIndex = maxIndex + (next - prev) / (2 * (2 * curr - next - prev));\n    return trueIndex * sampleRate / (analyserRef.current?.fftSize || 2048);\n  };\n\n  // --- DRAW LOOP ---\n  const draw = useCallback(() => {\n    if (!analyserRef.current || !audioContextRef.current) return;\n    \n    if (!isFrozen) {\n      const bufferLength = analyserRef.current.frequencyBinCount;\n      if (timeDataRef.current.length !== bufferLength) {\n        timeDataRef.current = new Uint8Array(bufferLength);\n        freqDataRef.current = new Uint8Array(bufferLength);\n      }\n      analyserRef.current.getByteTimeDomainData(timeDataRef.current);\n      analyserRef.current.getByteFrequencyData(freqDataRef.current);\n      \n      // Update Freq Display\n      if (isGenerating) setFrequency(genFreq);\n      else {\n          const f = getPitch(freqDataRef.current, audioContextRef.current.sampleRate);\n          setFrequency(prev => (f > 0 && Math.abs(prev - f) > 5) ? f : prev); // Simple smoothing\n      }\n    }\n\n    // 1. Draw Time Domain (Oscilloscope)\n    const ctxTime = canvasTimeRef.current?.getContext('2d');\n    if (ctxTime && canvasTimeRef.current) {\n        const w = canvasTimeRef.current.width; const h = canvasTimeRef.current.height;\n        ctxTime.fillStyle = '#0f172a'; ctxTime.fillRect(0, 0, w, h);\n        \n        // Grid\n        ctxTime.strokeStyle = '#1e293b'; ctxTime.lineWidth = 1; ctxTime.beginPath();\n        for(let x=0; x<=w; x+=w/10) { ctxTime.moveTo(x,0); ctxTime.lineTo(x,h); }\n        ctxTime.stroke();\n        ctxTime.strokeStyle = '#334155'; ctxTime.beginPath(); ctxTime.moveTo(0, h/2); ctxTime.lineTo(w, h/2); ctxTime.stroke();\n\n        // Wave\n        ctxTime.lineWidth = 3; ctxTime.strokeStyle = '#38bdf8'; ctxTime.beginPath();\n        const sliceWidth = w * 1.0 / timeDataRef.current.length;\n        let x = 0;\n        for(let i=0; i<timeDataRef.current.length; i++) {\n            const v = timeDataRef.current[i] / 128.0;\n            const y = v * h/2;\n            if(i===0) ctxTime.moveTo(x, y); else ctxTime.lineTo(x, y);\n            x += sliceWidth;\n        }\n        ctxTime.stroke();\n        \n        // Author\n        ctxTime.fillStyle = \"rgba(255,255,255,0.1)\"; ctxTime.font = \"12px sans-serif\"; ctxTime.textAlign = \"right\";\n        ctxTime.fillText(\"Hô Hoàng Anh A1K50\", w - 10, h - 10);\n    }\n\n    // 2. Draw Frequency Domain (Spectrum)\n    const ctxFreq = canvasFreqRef.current?.getContext('2d');\n    if (ctxFreq && canvasFreqRef.current) {\n        const w = canvasFreqRef.current.width; const h = canvasFreqRef.current.height;\n        ctxFreq.fillStyle = '#0f172a'; ctxFreq.fillRect(0, 0, w, h);\n        \n        const barWidth = (w / freqDataRef.current.length) * 2.5;\n        let x = 0;\n        for(let i=0; i<freqDataRef.current.length; i++) {\n            const barHeight = freqDataRef.current[i] / 255 * h;\n            ctxFreq.fillStyle = `rgb(${barHeight + 100},50,200)`;\n            ctxFreq.fillRect(x, h - barHeight, barWidth, barHeight);\n            x += barWidth + 1;\n        }\n    }\n\n    requestRef.current = requestAnimationFrame(draw);\n  }, [isFrozen, isGenerating, genFreq]);\n\n  useEffect(() => {\n    requestRef.current = requestAnimationFrame(draw);\n    return () => { if(requestRef.current) cancelAnimationFrame(requestRef.current); }\n  }, [draw]);\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n      {/* CỘT TRÁI */}\n      <div className=\"lg:col-span-2 space-y-4\">\n        {/* Visualizer Main */}\n        <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 shadow-lg relative overflow-hidden group\">\n            <canvas ref={canvasTimeRef} width={800} height={380} className=\"w-full h-[380px] bg-[#0f172a]\" />\n            <div className=\"absolute top-4 left-4 bg-slate-900/80 backdrop-blur px-3 py-2 rounded-lg border border-slate-700 text-xs font-mono text-cyan-400 flex gap-2 items-center\">\n                <Activity size={14}/> Dao động ký điện tử\n            </div>\n        </div>\n\n        {/* Controls */}\n        <div className=\"bg-[#1e293b] rounded-xl p-3 border border-slate-700/50 shadow-md flex items-center gap-4 justify-between\">\n            <div className=\"flex gap-2\">\n                <button \n                    onClick={() => { if(isGenerating) stopGenerator(); else startGenerator(); }}\n                    disabled={isListening}\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${isGenerating ? 'bg-green-600 text-white shadow-lg' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'} ${isListening ? 'opacity-30' : ''}`}\n                >\n                    <Radio size={18}/> {isGenerating ? \"Tắt Máy Phát\" : \"Bật Máy Phát\"}\n                </button>\n                <button \n                    onClick={() => { if(isListening) stopMicrophone(); else startMicrophone(); }}\n                    disabled={isGenerating}\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${isListening ? 'bg-red-500 text-white shadow-lg' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'} ${isGenerating ? 'opacity-30' : ''}`}\n                >\n                    {isListening ? <MicOff size={18}/> : <Mic size={18}/>} {isListening ? \"Tắt Mic\" : \"Bật Mic\"}\n                </button>\n            </div>\n            \n            <button \n                onClick={() => setIsFrozen(!isFrozen)}\n                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${isFrozen ? 'bg-amber-500 text-white' : 'bg-cyan-600 text-white'}`}\n            >\n                {isFrozen ? <Play size={18} fill=\"currentColor\"/> : <Pause size={18} fill=\"currentColor\"/>} {isFrozen ? \"Tiếp tục\" : \"Dừng hình\"}\n            </button>\n        </div>\n\n        {/* Spectrum Graph */}\n        <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50 shadow-md\">\n            <div className=\"flex justify-between items-center mb-2\">\n                <h3 className=\"text-xs font-bold text-purple-400 uppercase flex items-center gap-2\"><BarChart3 size={14}/> Phổ Tần Số (FFT)</h3>\n            </div>\n            <div className=\"relative w-full h-32 bg-[#0f172a] rounded-lg border border-slate-700 overflow-hidden\">\n                <canvas ref={canvasFreqRef} width={800} height={128} className=\"w-full h-full\"/>\n            </div>\n        </div>\n      </div>\n\n      {/* CỘT PHẢI */}\n      <div className=\"lg:col-span-1 space-y-4 flex flex-col\">\n        {/* Frequency Display */}\n        <div className=\"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 border border-slate-700 shadow-2xl text-center relative\">\n               <div className=\"absolute top-4 right-4 animate-pulse\">\n                  <div className={`w-3 h-3 rounded-full ${frequency > 20 ? (isGenerating ? 'bg-green-500' : 'bg-red-500') : 'bg-slate-600'}`}></div>\n               </div>\n               <h2 className=\"text-slate-400 text-sm uppercase tracking-wider mb-2\">\n                 {isGenerating ? \"Tần số đang phát\" : \"Tần số đo được\"}\n               </h2>\n               <div className={`text-6xl font-mono font-bold tracking-tighter tabular-nums ${isGenerating ? 'text-green-400' : 'text-cyan-400'}`}>\n                 {frequency > 0 ? frequency.toFixed(1) : \"--\"}\n                 <span className=\"text-2xl text-slate-500 ml-2\">Hz</span>\n               </div>\n        </div>\n\n        {/* Generator Settings */}\n        <ControlPanel title=\"Cấu hình nguồn phát\" icon={Settings}>\n            <div className=\"space-y-4\">\n                <div>\n                   <div className=\"flex justify-between text-xs text-slate-400 mb-1\">\n                        <span>Tần số phát (Hz)</span> <span className=\"text-green-400 font-mono font-bold\">{genFreq.toFixed(0)}</span>\n                   </div>\n                   <input type=\"range\" min=\"20\" max=\"5000\" step=\"1\" value={genFreq} onChange={(e) => updateGen(Number(e.target.value), genType, genVolume)} className=\"w-full accent-green-500 h-1.5 bg-slate-700 rounded-lg cursor-pointer\" />\n                </div>\n                <div>\n                   <div className=\"flex justify-between text-xs text-slate-400 mb-1\">\n                        <span>Biên độ (Volume)</span> <span className=\"text-green-400 font-mono font-bold\">{(genVolume*100).toFixed(0)}%</span>\n                   </div>\n                   <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={genVolume} onChange={(e) => updateGen(genFreq, genType, Number(e.target.value))} className=\"w-full accent-green-500 h-1.5 bg-slate-700 rounded-lg cursor-pointer\" />\n                </div>\n                <div>\n                   <label className=\"text-xs text-slate-400 mb-2 block\">Dạng sóng</label>\n                   <div className=\"grid grid-cols-2 gap-2\">\n                      {Object.entries(WAVEFORMS).map(([key, label]) => (\n                        <button key={key} onClick={() => updateGen(genFreq, key as OscillatorType, genVolume)} className={`text-[10px] py-2 rounded border transition-all ${genType === key ? 'bg-green-600 border-green-500 text-white' : 'bg-slate-800 border-slate-600 text-slate-400 hover:text-white'}`}>{label}</button>\n                      ))}\n                   </div>\n                </div>\n            </div>\n        </ControlPanel>\n\n        {/* Physics Info */}\n        <ControlPanel title=\"Thông số vật lý\" icon={BookOpen}>\n            <div className=\"space-y-3 text-xs\">\n                <div>\n                    <label className=\"text-slate-400 mb-1 block\">Môi trường</label>\n                    <select value={medium} onChange={(e) => setMedium(e.target.value)} className=\"w-full bg-slate-900 border border-slate-600 rounded px-2 py-1.5 text-slate-200 outline-none focus:border-cyan-500\">\n                      {Object.entries(MEDIUMS).map(([key, val]) => (\n                        <option key={key} value={key}>{val.name} (v={val.v}m/s)</option>\n                      ))}\n                    </select>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                    <StatBox label=\"Bước sóng (λ)\" value={frequency > 0 ? (velocity/frequency).toFixed(3) : \"--\"} unit=\"m\" color=\"text-yellow-400\"/>\n                    <StatBox label=\"Chu kỳ (T)\" value={frequency > 0 ? (1000/frequency).toFixed(2) : \"--\"} unit=\"ms\" color=\"text-orange-400\"/>\n                </div>\n                <div className=\"mt-4 pt-4 border-t border-slate-700\">\n                    <h4 className=\"text-xs font-bold text-slate-300 mb-2 flex items-center gap-1\">\n                        <BookOpen size={14} /> CÔNG THỨC & CHÚ THÍCH\n                    </h4>\n                    <div className=\"bg-slate-900/50 p-3 rounded text-xs space-y-2 border border-slate-700/50 font-mono text-slate-400\">\n                        <div className=\"flex justify-between\">\n                            <span>x = A·cos(ωt + φ)</span>\n                            <span className=\"text-slate-600\">// PT Dao động</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                            <span>ω = 2πf</span>\n                            <span className=\"text-slate-600\">// Tần số góc</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                            <span>T = 1/f</span>\n                            <span className=\"text-slate-600\">// Chu kỳ</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                            <span>λ = v/f = v·T</span>\n                            <span className=\"text-slate-600\">// Bước sóng</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                            <span>k = 2π/λ</span>\n                            <span className=\"text-slate-600\">// Số sóng</span>\n                        </div>\n                        <div className=\"flex justify-between text-yellow-500/80 pt-1 border-t border-slate-800\">\n                            <span>u = A·cos(ωt - kx)</span>\n                            <span>// PT Sóng</span>\n                        </div>\n                    </div>\n                  </div>\n            </div>\n        </ControlPanel>\n      </div>\n    </div>\n  );\n};\n\nexport default SoundWaveLab;"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAHA;;;AAKA,wBAAwB;AACxB,MAAM,eAAe,CAAC,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,QAAQ,EAA4D,iBAC7G,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;oBACZ,sBAAQ,6LAAC;wBAAK,MAAM;wBAAI,WAAU;;;;;;kCACnC,6LAAC;wBAAG,WAAU;kCAA6D;;;;;;;;;;;;0BAE7E,6LAAC;gBAAI,WAAU;0BAAwB;;;;;;;;;;;;KANrC;AAUN,MAAM,UAAU,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,gBAAgB,EAA4E,iBACvI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;0BAA2D;;;;;;0BAC1E,6LAAC;gBAAI,WAAW,CAAC,4BAA4B,EAAE,OAAO;;oBACjD;oBAAM;kCAAC,6LAAC;wBAAK,WAAU;kCAAsC;;;;;;;;;;;;;;;;;;MAJpE;AASN,MAAM,eAAe;;IACnB,gBAAgB;IAChB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,wBAAwB;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC,IAAI,gBAAgB;IAC/D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,YAAY;IACZ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAiB;IACvD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,eAAe;IACf,MAAM,kBAAkB,IAAA,uKAAM,EAAsB;IACpD,MAAM,cAAc,IAAA,uKAAM,EAAsB;IAChD,MAAM,gBAAgB,IAAA,uKAAM,EAAoC;IAChE,MAAM,gBAAgB,IAAA,uKAAM,EAAwB;IACpD,MAAM,cAAc,IAAA,uKAAM,EAAkB;IAC5C,MAAM,aAAa,IAAA,uKAAM,EAAgB;IAEzC,MAAM,gBAAgB,IAAA,uKAAM,EAAoB,OAAO,eAAe;IACtE,MAAM,gBAAgB,IAAA,uKAAM,EAAoB,OAAO,WAAW;IAElE,MAAM,cAAc,IAAA,uKAAM,EAAC,IAAI,WAAW;IAC1C,MAAM,cAAc,IAAA,uKAAM,EAAC,IAAI,WAAW;IAE1C,MAAM,UAAuD;QAC3D,KAAK;YAAE,MAAM;YAAoB,GAAG;QAAI;QACxC,OAAO;YAAE,MAAM;YAAe,GAAG;QAAK;QACtC,MAAM;YAAE,MAAM;YAAO,GAAG;QAAK;IAC/B;IAEA,MAAM,YAAoC;QACtC,MAAM;QACN,QAAQ;QACR,UAAU;QACV,UAAU;IACd;IAEA,IAAA,0KAAS;kCAAC;YACR,YAAY,OAAO,CAAC,OAAO,CAAC,CAAC;QAC/B;iCAAG;QAAC;KAAO;IAEX,sBAAsB;IACtB,MAAM,YAAY;QAChB,IAAI,CAAC,gBAAgB,OAAO,EAAE;YAC5B,gBAAgB,OAAO,GAAG,IAAI,CAAC,OAAO,YAAY,IAAI,AAAC,OAAe,kBAAkB;QAC1F;QACA,IAAI,gBAAgB,OAAO,EAAE,UAAU,aAAa,MAAM,gBAAgB,OAAO,CAAC,MAAM;IAC1F;IAEA,MAAM,kBAAkB;QACtB,IAAI;YACF,MAAM;YACN,IAAI,CAAC,gBAAgB,OAAO,EAAE;YAC9B,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;YACvE;YACA,cAAc,OAAO,GAAG,gBAAgB,OAAO,CAAC,uBAAuB,CAAC;YACxE,cAAc,OAAO,CAAC,OAAO,CAAC,YAAY,OAAO;YACjD,eAAe;YACf,gBAAgB;YAChB,YAAY;QACd,EAAE,OAAO,KAAK;YAAE,MAAM;QAAyB;IACjD;IAEA,MAAM,iBAAiB;QACrB,MAAM;QACN,IAAI,CAAC,gBAAgB,OAAO,EAAE;QAC9B,IAAI,aAAa;QAEjB;QACA,cAAc,OAAO,GAAG,gBAAgB,OAAO,CAAC,gBAAgB;QAChE,YAAY,OAAO,GAAG,gBAAgB,OAAO,CAAC,UAAU;QAExD,cAAc,OAAO,CAAC,IAAI,GAAG;QAC7B,cAAc,OAAO,CAAC,SAAS,CAAC,cAAc,CAAC,SAAS,gBAAgB,OAAO,CAAC,WAAW;QAC3F,YAAY,OAAO,CAAE,IAAI,CAAC,cAAc,CAAC,WAAW,gBAAgB,OAAO,CAAC,WAAW;QAEvF,cAAc,OAAO,CAAC,OAAO,CAAC,YAAY,OAAO;QACjD,YAAY,OAAO,CAAE,OAAO,CAAC,YAAY,OAAO;QAChD,YAAY,OAAO,CAAE,OAAO,CAAC,gBAAgB,OAAO,CAAC,WAAW;QAEhE,cAAc,OAAO,CAAC,KAAK;QAC3B,gBAAgB;QAChB,eAAe;QACf,YAAY;IACd;IAEA,MAAM,gBAAgB;QAClB,IAAG,CAAC,gBAAgB,OAAO,EAAE;QAC7B,YAAY,OAAO,GAAG,gBAAgB,OAAO,CAAC,cAAc;QAC5D,YAAY,OAAO,CAAC,OAAO,GAAG;QAC9B,YAAY,OAAO,CAAC,qBAAqB,GAAG;IAChD;IAEA,MAAM,iBAAiB;QACrB,cAAc,OAAO,EAAE;QACvB,cAAc,OAAO,GAAG;QACxB,eAAe;IACjB;IAEA,MAAM,gBAAgB;QACpB,IAAI;YAAE,cAAc,OAAO,EAAE;QAAQ,EAAE,OAAM,GAAE,CAAC;QAChD,cAAc,OAAO,EAAE;QACvB,cAAc,OAAO,GAAG;QACxB,gBAAgB;IAClB;IAEA,MAAM,YAAY,CAAC,MAAc,MAAsB;QACrD,IAAI,gBAAgB,OAAO,IAAI,cAAc,OAAO,IAAI,YAAY,OAAO,EAAE;YAC3E,cAAc,OAAO,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,gBAAgB,OAAO,CAAC,WAAW;YACxF,cAAc,OAAO,CAAC,IAAI,GAAG;YAC7B,YAAY,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,gBAAgB,OAAO,CAAC,WAAW;QAClF;QACA,WAAW;QAAO,WAAW;QAAO,aAAa;IACnD;IAEA,MAAM,WAAW,CAAC,QAAoB;QACpC,IAAI,SAAS,CAAC;QAAU,IAAI,WAAW,CAAC;QACxC,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,MAAM,GAAG,GAAG,IAAK;YAC1C,IAAI,MAAM,CAAC,EAAE,GAAG,QAAQ;gBAAE,SAAS,MAAM,CAAC,EAAE;gBAAE,WAAW;YAAG;QAC9D;QACA,IAAI,SAAS,KAAK,OAAO,GAAG,aAAa;QACzC,gBAAgB;QAChB,MAAM,OAAO,MAAM,CAAC,WAAW,EAAE;QAAE,MAAM,OAAO,MAAM,CAAC,WAAW,EAAE;QAAE,MAAM,OAAO,MAAM,CAAC,SAAS;QACnG,MAAM,YAAY,WAAW,CAAC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,OAAO,OAAO,IAAI,CAAC;QAC1E,OAAO,YAAY,aAAa,CAAC,YAAY,OAAO,EAAE,WAAW,IAAI;IACvE;IAEA,oBAAoB;IACpB,MAAM,OAAO,IAAA,4KAAW;0CAAC;YACvB,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,gBAAgB,OAAO,EAAE;YAEtD,IAAI,CAAC,UAAU;gBACb,MAAM,eAAe,YAAY,OAAO,CAAC,iBAAiB;gBAC1D,IAAI,YAAY,OAAO,CAAC,MAAM,KAAK,cAAc;oBAC/C,YAAY,OAAO,GAAG,IAAI,WAAW;oBACrC,YAAY,OAAO,GAAG,IAAI,WAAW;gBACvC;gBACA,YAAY,OAAO,CAAC,qBAAqB,CAAC,YAAY,OAAO;gBAC7D,YAAY,OAAO,CAAC,oBAAoB,CAAC,YAAY,OAAO;gBAE5D,sBAAsB;gBACtB,IAAI,cAAc,aAAa;qBAC1B;oBACD,MAAM,IAAI,SAAS,YAAY,OAAO,EAAE,gBAAgB,OAAO,CAAC,UAAU;oBAC1E;0DAAa,CAAA,OAAQ,AAAC,IAAI,KAAK,KAAK,GAAG,CAAC,OAAO,KAAK,IAAK,IAAI;0DAAO,mBAAmB;gBAC3F;YACF;YAEA,qCAAqC;YACrC,MAAM,UAAU,cAAc,OAAO,EAAE,WAAW;YAClD,IAAI,WAAW,cAAc,OAAO,EAAE;gBAClC,MAAM,IAAI,cAAc,OAAO,CAAC,KAAK;gBAAE,MAAM,IAAI,cAAc,OAAO,CAAC,MAAM;gBAC7E,QAAQ,SAAS,GAAG;gBAAW,QAAQ,QAAQ,CAAC,GAAG,GAAG,GAAG;gBAEzD,OAAO;gBACP,QAAQ,WAAW,GAAG;gBAAW,QAAQ,SAAS,GAAG;gBAAG,QAAQ,SAAS;gBACzE,IAAI,IAAI,IAAE,GAAG,KAAG,GAAG,KAAG,IAAE,GAAI;oBAAE,QAAQ,MAAM,CAAC,GAAE;oBAAI,QAAQ,MAAM,CAAC,GAAE;gBAAI;gBACxE,QAAQ,MAAM;gBACd,QAAQ,WAAW,GAAG;gBAAW,QAAQ,SAAS;gBAAI,QAAQ,MAAM,CAAC,GAAG,IAAE;gBAAI,QAAQ,MAAM,CAAC,GAAG,IAAE;gBAAI,QAAQ,MAAM;gBAEpH,OAAO;gBACP,QAAQ,SAAS,GAAG;gBAAG,QAAQ,WAAW,GAAG;gBAAW,QAAQ,SAAS;gBACzE,MAAM,aAAa,IAAI,MAAM,YAAY,OAAO,CAAC,MAAM;gBACvD,IAAI,IAAI;gBACR,IAAI,IAAI,IAAE,GAAG,IAAE,YAAY,OAAO,CAAC,MAAM,EAAE,IAAK;oBAC5C,MAAM,IAAI,YAAY,OAAO,CAAC,EAAE,GAAG;oBACnC,MAAM,IAAI,IAAI,IAAE;oBAChB,IAAG,MAAI,GAAG,QAAQ,MAAM,CAAC,GAAG;yBAAS,QAAQ,MAAM,CAAC,GAAG;oBACvD,KAAK;gBACT;gBACA,QAAQ,MAAM;gBAEd,SAAS;gBACT,QAAQ,SAAS,GAAG;gBAAyB,QAAQ,IAAI,GAAG;gBAAmB,QAAQ,SAAS,GAAG;gBACnG,QAAQ,QAAQ,CAAC,sBAAsB,IAAI,IAAI,IAAI;YACvD;YAEA,sCAAsC;YACtC,MAAM,UAAU,cAAc,OAAO,EAAE,WAAW;YAClD,IAAI,WAAW,cAAc,OAAO,EAAE;gBAClC,MAAM,IAAI,cAAc,OAAO,CAAC,KAAK;gBAAE,MAAM,IAAI,cAAc,OAAO,CAAC,MAAM;gBAC7E,QAAQ,SAAS,GAAG;gBAAW,QAAQ,QAAQ,CAAC,GAAG,GAAG,GAAG;gBAEzD,MAAM,WAAW,AAAC,IAAI,YAAY,OAAO,CAAC,MAAM,GAAI;gBACpD,IAAI,IAAI;gBACR,IAAI,IAAI,IAAE,GAAG,IAAE,YAAY,OAAO,CAAC,MAAM,EAAE,IAAK;oBAC5C,MAAM,YAAY,YAAY,OAAO,CAAC,EAAE,GAAG,MAAM;oBACjD,QAAQ,SAAS,GAAG,CAAC,IAAI,EAAE,YAAY,IAAI,QAAQ,CAAC;oBACpD,QAAQ,QAAQ,CAAC,GAAG,IAAI,WAAW,UAAU;oBAC7C,KAAK,WAAW;gBACpB;YACJ;YAEA,WAAW,OAAO,GAAG,sBAAsB;QAC7C;yCAAG;QAAC;QAAU;QAAc;KAAQ;IAEpC,IAAA,0KAAS;kCAAC;YACR,WAAW,OAAO,GAAG,sBAAsB;YAC3C;0CAAO;oBAAQ,IAAG,WAAW,OAAO,EAAE,qBAAqB,WAAW,OAAO;gBAAG;;QAClF;iCAAG;QAAC;KAAK;IAET,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAO,KAAK;gCAAe,OAAO;gCAAK,QAAQ;gCAAK,WAAU;;;;;;0CAC/D,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,yNAAQ;wCAAC,MAAM;;;;;;oCAAK;;;;;;;;;;;;;kCAK7B,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCACG,SAAS;4CAAQ,IAAG,cAAc;iDAAsB;wCAAkB;wCAC1E,UAAU;wCACV,WAAW,CAAC,8EAA8E,EAAE,eAAe,sCAAsC,iDAAiD,CAAC,EAAE,cAAc,eAAe,IAAI;;0DAEtO,6LAAC,gNAAK;gDAAC,MAAM;;;;;;4CAAK;4CAAE,eAAe,iBAAiB;;;;;;;kDAExD,6LAAC;wCACG,SAAS;4CAAQ,IAAG,aAAa;iDAAuB;wCAAmB;wCAC3E,UAAU;wCACV,WAAW,CAAC,8EAA8E,EAAE,cAAc,oCAAoC,iDAAiD,CAAC,EAAE,eAAe,eAAe,IAAI;;4CAEnO,4BAAc,6LAAC,uNAAM;gDAAC,MAAM;;;;;yGAAQ,6LAAC,0MAAG;gDAAC,MAAM;;;;;;4CAAM;4CAAE,cAAc,YAAY;;;;;;;;;;;;;0CAI1F,6LAAC;gCACG,SAAS,IAAM,YAAY,CAAC;gCAC5B,WAAW,CAAC,8EAA8E,EAAE,WAAW,4BAA4B,0BAA0B;;oCAE5J,yBAAW,6LAAC,6MAAI;wCAAC,MAAM;wCAAI,MAAK;;;;;iGAAmB,6LAAC,gNAAK;wCAAC,MAAM;wCAAI,MAAK;;;;;;oCAAiB;oCAAE,WAAW,aAAa;;;;;;;;;;;;;kCAK7H,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCAAG,WAAU;;sDAAsE,6LAAC,kOAAS;4CAAC,MAAM;;;;;;wCAAK;;;;;;;;;;;;0CAE9G,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCAAO,KAAK;oCAAe,OAAO;oCAAK,QAAQ;oCAAK,WAAU;;;;;;;;;;;;;;;;;;;;;;;0BAMzE,6LAAC;gBAAI,WAAU;;kCAEb,6LAAC;wBAAI,WAAU;;0CACR,6LAAC;gCAAI,WAAU;0CACZ,cAAA,6LAAC;oCAAI,WAAW,CAAC,qBAAqB,EAAE,YAAY,KAAM,eAAe,iBAAiB,eAAgB,gBAAgB;;;;;;;;;;;0CAE7H,6LAAC;gCAAG,WAAU;0CACX,eAAe,qBAAqB;;;;;;0CAEvC,6LAAC;gCAAI,WAAW,CAAC,2DAA2D,EAAE,eAAe,mBAAmB,iBAAiB;;oCAC9H,YAAY,IAAI,UAAU,OAAO,CAAC,KAAK;kDACxC,6LAAC;wCAAK,WAAU;kDAA+B;;;;;;;;;;;;;;;;;;kCAKxD,6LAAC;wBAAa,OAAM;wBAAsB,MAAM,yNAAQ;kCACpD,cAAA,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;;sDACE,6LAAC;4CAAI,WAAU;;8DACV,6LAAC;8DAAK;;;;;;gDAAuB;8DAAC,6LAAC;oDAAK,WAAU;8DAAsC,QAAQ,OAAO,CAAC;;;;;;;;;;;;sDAEzG,6LAAC;4CAAM,MAAK;4CAAQ,KAAI;4CAAK,KAAI;4CAAO,MAAK;4CAAI,OAAO;4CAAS,UAAU,CAAC,IAAM,UAAU,OAAO,EAAE,MAAM,CAAC,KAAK,GAAG,SAAS;4CAAY,WAAU;;;;;;;;;;;;8CAEtJ,6LAAC;;sDACE,6LAAC;4CAAI,WAAU;;8DACV,6LAAC;8DAAK;;;;;;gDAAuB;8DAAC,6LAAC;oDAAK,WAAU;;wDAAsC,CAAC,YAAU,GAAG,EAAE,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAEpH,6LAAC;4CAAM,MAAK;4CAAQ,KAAI;4CAAI,KAAI;4CAAI,MAAK;4CAAO,OAAO;4CAAW,UAAU,CAAC,IAAM,UAAU,SAAS,SAAS,OAAO,EAAE,MAAM,CAAC,KAAK;4CAAI,WAAU;;;;;;;;;;;;8CAErJ,6LAAC;;sDACE,6LAAC;4CAAM,WAAU;sDAAoC;;;;;;sDACrD,6LAAC;4CAAI,WAAU;sDACX,OAAO,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,KAAK,MAAM,iBAC1C,6LAAC;oDAAiB,SAAS,IAAM,UAAU,SAAS,KAAuB;oDAAY,WAAW,CAAC,+CAA+C,EAAE,YAAY,MAAM,6CAA6C,iEAAiE;8DAAG;mDAA1Q;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAQ7B,6LAAC;wBAAa,OAAM;wBAAkB,MAAM,6NAAQ;kCAChD,cAAA,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAA4B;;;;;;sDAC7C,6LAAC;4CAAO,OAAO;4CAAQ,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;4CAAG,WAAU;sDAC1E,OAAO,OAAO,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,iBACtC,6LAAC;oDAAiB,OAAO;;wDAAM,IAAI,IAAI;wDAAC;wDAAK,IAAI,CAAC;wDAAC;;mDAAtC;;;;;;;;;;;;;;;;8CAIrB,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAQ,OAAM;4CAAgB,OAAO,YAAY,IAAI,CAAC,WAAS,SAAS,EAAE,OAAO,CAAC,KAAK;4CAAM,MAAK;4CAAI,OAAM;;;;;;sDAC7G,6LAAC;4CAAQ,OAAM;4CAAa,OAAO,YAAY,IAAI,CAAC,OAAK,SAAS,EAAE,OAAO,CAAC,KAAK;4CAAM,MAAK;4CAAK,OAAM;;;;;;;;;;;;8CAE3G,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAG,WAAU;;8DACV,6LAAC,6NAAQ;oDAAC,MAAM;;;;;;gDAAM;;;;;;;sDAE1B,6LAAC;4CAAI,WAAU;;8DACX,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;8DAErC,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;8DAErC,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;8DAErC,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;8DAErC,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;8DAErC,6LAAC;oDAAI,WAAU;;sEACX,6LAAC;sEAAK;;;;;;sEACN,6LAAC;sEAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASlC;GA9VM;MAAA;uCAgWS"}},
    {"offset": {"line": 7913, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/wave-interference.tsx"],"sourcesContent":["\"use client\"\n\nimport { useRef, useEffect, useState, useCallback } from \"react\"\nimport { Play, Pause, RotateCcw, Eye, EyeOff, Waves, SkipBack, SkipForward, Sun, Zap, Disc, Maximize2, Rainbow } from \"lucide-react\"\n\n\n\n// --- CÁC HÀM BỔ TRỢ ---\n\n// Polyfill cho hàm sinc\nif (!(Math as any).sinc) {\n  (Math as any).sinc = function (x: number) {\n    return x === 0 ? 1 : Math.sin(x) / x\n  }\n}\n\n// Hàm chuyển đổi bước sóng (nm) sang màu RGB\nconst wavelengthToRGB = (wavelength: number) => {\n  let r, g, b, alpha\n  if (wavelength >= 380 && wavelength < 440) {\n    r = -(wavelength - 440) / (440 - 380); g = 0; b = 1\n  } else if (wavelength >= 440 && wavelength < 490) {\n    r = 0; g = (wavelength - 440) / (490 - 440); b = 1\n  } else if (wavelength >= 490 && wavelength < 510) {\n    r = 0; g = 1; b = -(wavelength - 510) / (510 - 490)\n  } else if (wavelength >= 510 && wavelength < 580) {\n    r = (wavelength - 510) / (580 - 510); g = 1; b = 0\n  } else if (wavelength >= 580 && wavelength < 645) {\n    r = 1; g = -(wavelength - 645) / (645 - 580); b = 0\n  } else if (wavelength >= 645 && wavelength < 781) {\n    r = 1; g = 0; b = 0\n  } else {\n    r = 0; g = 0; b = 0\n  }\n\n  if (wavelength >= 380 && wavelength < 420) {\n    alpha = 0.3 + (0.7 * (wavelength - 380)) / (420 - 380)\n  } else if (wavelength >= 420 && wavelength < 701) {\n    alpha = 1.0\n  } else if (wavelength >= 701 && wavelength < 781) {\n    alpha = 0.3 + (0.7 * (781 - wavelength)) / (781 - 701)\n  } else {\n    alpha = 0\n  }\n\n  return {\n    r: Math.round(r * 255 * alpha),\n    g: Math.round(g * 255 * alpha),\n    b: Math.round(b * 255 * alpha),\n    colorString: `rgb(${Math.round(r * 255 * alpha)}, ${Math.round(g * 255 * alpha)}, ${Math.round(b * 255 * alpha)})`\n  }\n}\n\n// --- COMPONENT CHÍNH ---\nexport default function WaveInterference() {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n\n  // State chung\n  const [mode, setMode] = useState<'mechanical' | 'light'>('mechanical')\n\n  // State Sóng cơ\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [time, setTime] = useState(0)\n  const [showNodalLines, setShowNodalLines] = useState(false)\n  const [view3D, setView3D] = useState(false)\n  const [mechParams, setMechParams] = useState({\n    frequency: 0.8,\n    amplitude: 1.0,\n    sourceDistance: 120,\n    wavelength: 40,\n  })\n\n  // State Sóng ánh sáng\n  const [lightMode, setLightMode] = useState<'mono' | 'dual' | 'white'>('mono')\n  const [lightParams, setLightParams] = useState({\n    wavelength1: 500, // Lambda 1 (nm)\n    wavelength2: 650, // Lambda 2 (nm)\n    slitDistance: 1.0, // a (mm)\n    screenDistance: 2.0, // D (m)\n  })\n\n  const animationRef = useRef<number>()\n  const timeRef = useRef(0)\n\n  // --- LOGIC SÓNG CƠ ---\n  const omega = 2 * Math.PI * mechParams.frequency\n  const k_mech = (2 * Math.PI) / mechParams.wavelength\n  const dt = 1 / 60\n\n  const calculateWaveHeight = useCallback(\n    (x: number, y: number, s1x: number, s1y: number, s2x: number, s2y: number, t: number) => {\n      const d1 = Math.sqrt((x - s1x) ** 2 + (y - s1y) ** 2)\n      const d2 = Math.sqrt((x - s2x) ** 2 + (y - s2y) ** 2)\n      const amp1 = mechParams.amplitude / Math.sqrt(1 + d1 * 0.01)\n      const amp2 = mechParams.amplitude / Math.sqrt(1 + d2 * 0.01)\n\n      const wave1 = amp1 * Math.sin(k_mech * d1 - omega * t)\n      const wave2 = amp2 * Math.sin(k_mech * d2 - omega * t)\n      return wave1 + wave2\n    },\n    [k_mech, omega, mechParams.amplitude],\n  )\n\n  const getNodalLinePoints = useCallback(\n    (width: number, height: number, s1x: number, s1y: number, s2x: number, s2y: number, order: number) => {\n      const points: { x: number; y: number }[] = []\n      const pathDiff = (order + 0.5) * mechParams.wavelength\n      for (let x = 0; x < width; x += 2) {\n        for (let y = 0; y < height; y += 2) {\n          const d1 = Math.sqrt((x - s1x) ** 2 + (y - s1y) ** 2)\n          const d2 = Math.sqrt((x - s2x) ** 2 + (y - s2y) ** 2)\n          if (Math.abs(Math.abs(d1 - d2) - pathDiff) < 2.5) points.push({ x, y })\n        }\n      }\n      return points\n    },\n    [mechParams.wavelength],\n  )\n\n  const drawMechanical = useCallback(\n    (ctx: CanvasRenderingContext2D, t: number) => {\n      const width = ctx.canvas.width\n      const height = ctx.canvas.height\n      const centerY = height / 2\n      const source1 = { x: 80, y: centerY - mechParams.sourceDistance / 2 }\n      const source2 = { x: 80, y: centerY + mechParams.sourceDistance / 2 }\n\n      const imageData = ctx.createImageData(width, height)\n      const data = imageData.data\n      const resolution = view3D ? 3 : 2\n\n      if (view3D) {\n        // Gradient Background\n        const bgGrad = ctx.createLinearGradient(0, 0, 0, height);\n        bgGrad.addColorStop(0, \"#0f172a\");\n        bgGrad.addColorStop(1, \"#1e293b\");\n        ctx.fillStyle = bgGrad;\n        ctx.fillRect(0, 0, width, height);\n\n        const perspectiveScale = 0.6;\n        const horizonY = height * 0.2;\n        const gridSpacing = 4; // High fidelity\n        const zStart = 0;\n        const zEnd = height * 1.5;\n\n        // Render from Far (z=0) to Near (z=max)\n        for (let z = zStart; z <= zEnd; z += gridSpacing) {\n          const perspY = horizonY + z * perspectiveScale;\n          // Skip if off screen\n          if (perspY > height) break;\n\n          const scale = 0.2 + (z / (height * 1.2)) * 0.8;\n\n          // Generate points for this Z-slice\n          const points = [];\n          for (let x = 0; x <= width; x += gridSpacing) {\n            const worldX = (x - width / 2) / scale + width / 2;\n            const worldZ = z;\n\n            // Calculate Wave Height\n            const waveHeight = calculateWaveHeight(worldX, worldZ, source1.x, source1.y, source2.x, source2.y, t);\n\n            const screenX = width / 2 + (x - width / 2); // Spread X based on perspective?\n            // Actually `x` loop is screen space X?\n            // In previous code: `worldX` was derived from `x`.\n            // `const screenX = width / 2 + (x - width / 2) * scale` ???\n            // Usually: x is projected.\n            // Let's stick to iterating screen X and unprojecting for sample is easier for filling screen.\n            // But simpler: Iterate Screen X.\n            // `const worldX = (x - width/2)/scale + width/2`.\n            // This assumes linear mapping.\n\n            // Display Logic\n            // Perspective Y shift based on height\n            const screenY = perspY - waveHeight * 12 * scale;\n            points.push({ x, y: screenY });\n          }\n\n          if (points.length < 2) continue;\n\n          // Draw Filled Polygon (Occlusion)\n          ctx.beginPath();\n          ctx.moveTo(points[0].x, points[0].y);\n          for (let i = 1; i < points.length; i++) {\n            // Smooth curves\n            // ctx.lineTo(points[i].x, points[i].y);\n            // Quadratic for smoother look? \n            // Simple lineTo is fast and fine for dense grid.\n            ctx.lineTo(points[i].x, points[i].y);\n          }\n          // Close shape downwards\n          ctx.lineTo(width, height);\n          ctx.lineTo(0, height);\n          ctx.closePath();\n\n          ctx.fillStyle = \"#0f172a\"; // Opaque dark fill\n          ctx.fill();\n\n          // Draw Stroke (The Water Surface Line)\n          ctx.beginPath();\n          ctx.moveTo(points[0].x, points[0].y);\n          for (let i = 1; i < points.length; i++) {\n            ctx.lineTo(points[i].x, points[i].y);\n          }\n\n          // Distance based color fading\n          const distanceAlpha = 0.3 + 0.7 * (z / zEnd);\n          ctx.strokeStyle = `rgba(34, 211, 238, ${distanceAlpha})`; // Cyan-400\n          ctx.lineWidth = 1 + scale; // Lines thicker when near\n          ctx.stroke();\n        }\n\n      } else {\n        // REALISTIC RIPPLE TANK SHADER (2D)\n        for (let y = 0; y < height; y += resolution) {\n          for (let x = 0; x < width; x += resolution) {\n            const waveHeight = calculateWaveHeight(x, y, source1.x, source1.y, source2.x, source2.y, t)\n\n            // Ripple Tank Physics:\n            // Crests (Positive) act as convex lenses -> Focus light -> Bright Strips\n            // Troughs (Negative) act as concave lenses -> Diverge light -> Dark Strips\n            // Flat water -> Average Brightness\n\n            const maxAmp = 2 * mechParams.amplitude\n            const val = Math.max(-1, Math.min(1, waveHeight / maxAmp)) // Clamp -1..1\n\n            let r, g, b\n            // Base Water Color (Deep Blue-Grey)\n            const baseR = 15, baseG = 113, baseB = 115\n\n            if (val > 0) {\n              // Highlight (Crests) - Cyan/White\n              const intensity = Math.pow(val, 0.7); // Non-linear for sharper crests\n              r = 15 + (220 - 15) * intensity\n              g = 113 + (255 - 113) * intensity\n              b = 115 + (255 - 115) * intensity\n            } else {\n              // Shadow (Troughs) - Darker\n              const intensity = Math.pow(Math.abs(val), 0.7)\n              r = 15 * (1 - intensity * 0.8) // Don't go pitch black\n              g = 113 * (1 - intensity * 0.8)\n              b = 115 * (1 - intensity * 0.8)\n            }\n\n            // Render Pixel (or Block)\n            for (let dy = 0; dy < resolution && y + dy < height; dy++) {\n              for (let dx = 0; dx < resolution && x + dx < width; dx++) {\n                const idx = ((y + dy) * width + (x + dx)) * 4\n                data[idx] = r; data[idx + 1] = g; data[idx + 2] = b; data[idx + 3] = 255\n              }\n            }\n          }\n        }\n        ctx.putImageData(imageData, 0, 0)\n      }\n\n      if (showNodalLines && !view3D) {\n        ctx.strokeStyle = \"rgba(255, 100, 100, 0.8)\"; ctx.lineWidth = 2; ctx.setLineDash([5, 5])\n        const maxOrder = Math.floor(mechParams.sourceDistance / mechParams.wavelength) + 2\n        for (let order = 0; order <= maxOrder; order++) {\n          const points = getNodalLinePoints(width, height, source1.x, source1.y, source2.x, source2.y, order)\n          if (points.length > 0) {\n            const upperPoints = points.filter((p) => p.y < centerY).sort((a, b) => a.x - b.x)\n            const lowerPoints = points.filter((p) => p.y >= centerY).sort((a, b) => a.x - b.x)\n            if (upperPoints.length > 5) { ctx.beginPath(); ctx.moveTo(upperPoints[0].x, upperPoints[0].y); for (let i = 1; i < upperPoints.length; i++) ctx.lineTo(upperPoints[i].x, upperPoints[i].y); ctx.stroke(); }\n            if (lowerPoints.length > 5) { ctx.beginPath(); ctx.moveTo(lowerPoints[0].x, lowerPoints[0].y); for (let i = 1; i < lowerPoints.length; i++) ctx.lineTo(lowerPoints[i].x, lowerPoints[i].y); ctx.stroke(); }\n          }\n        }\n        ctx.strokeStyle = \"rgba(100, 255, 100, 0.5)\"; ctx.setLineDash([8, 4]); ctx.beginPath(); ctx.moveTo(source1.x, centerY); ctx.lineTo(width, centerY); ctx.stroke(); ctx.setLineDash([])\n      }\n\n      if (!view3D) {\n        const drawSource = (x: number, y: number, label: string) => {\n          const gradient = ctx.createRadialGradient(x, y, 0, x, y, 20)\n          gradient.addColorStop(0, \"rgba(255, 50, 50, 1)\"); gradient.addColorStop(1, \"rgba(255, 50, 50, 0)\")\n          ctx.fillStyle = gradient; ctx.beginPath(); ctx.arc(x, y, 20, 0, 2 * Math.PI); ctx.fill()\n          ctx.fillStyle = \"#fff\"; ctx.beginPath(); ctx.arc(x, y, 4, 0, 2 * Math.PI); ctx.fill()\n          ctx.fillStyle = \"#fff\"; ctx.font = \"bold 14px monospace\"; ctx.fillText(label, x - 25, y + 5)\n        }\n        drawSource(source1.x, source1.y, \"S₁\"); drawSource(source2.x, source2.y, \"S₂\")\n      }\n    },\n    [mechParams, view3D, showNodalLines, calculateWaveHeight, getNodalLinePoints]\n  )\n\n  // --- HÀM VẼ GIAO THOA ÁNH SÁNG ---\n  const drawLight = useCallback((ctx: CanvasRenderingContext2D) => {\n    const width = ctx.canvas.width\n    const height = ctx.canvas.height\n    const centerX = width / 2\n\n    // Nền tối\n    ctx.fillStyle = \"#020617\"\n    ctx.fillRect(0, 0, width, height)\n\n    const a = lightParams.slitDistance * 1e-3\n    const D = lightParams.screenDistance\n    const physicalScreenWidth = 0.04\n    const pixelsPerMeter = width / physicalScreenWidth\n\n    let wavelengths: { wl: number, intensityScale: number }[] = []\n\n    if (lightMode === 'mono') {\n      wavelengths.push({ wl: lightParams.wavelength1, intensityScale: 1.0 })\n    } else if (lightMode === 'dual') {\n      wavelengths.push({ wl: lightParams.wavelength1, intensityScale: 0.8 })\n      wavelengths.push({ wl: lightParams.wavelength2, intensityScale: 0.8 })\n    } else if (lightMode === 'white') {\n      for (let w = 380; w <= 750; w += 10) {\n        let scale = 0.5\n        if (w > 450 && w < 650) scale = 0.8\n        wavelengths.push({ wl: w, intensityScale: scale * 0.15 })\n      }\n    }\n\n    const imageData = ctx.createImageData(width, height)\n    const data = imageData.data\n\n    for (let x = 0; x < width; x++) {\n      const xPhysical = (x - centerX) / pixelsPerMeter\n      let rTotal = 0, gTotal = 0, bTotal = 0\n\n      for (const src of wavelengths) {\n        const lambda = src.wl * 1e-9\n        const phaseDifference = (2 * Math.PI * a * xPhysical) / (lambda * D)\n        let intensity = Math.cos(phaseDifference / 2) ** 2\n\n        // SỬA LỖI: Đổi tên biến 'b' thành 'slitWidth' để không trùng với 'b' trong RGB\n        const slitWidth = a / 10\n        const diffractionPhase = (Math.PI * slitWidth * xPhysical) / (lambda * D)\n        const diffractionFactor = (Math as any).sinc(diffractionPhase) ** 2\n        intensity = intensity * diffractionFactor * src.intensityScale\n\n        const rgb = wavelengthToRGB(src.wl)\n        rTotal += rgb.r * intensity\n        gTotal += rgb.g * intensity\n        bTotal += rgb.b * intensity\n      }\n\n      rTotal = Math.min(255, rTotal)\n      gTotal = Math.min(255, gTotal)\n      bTotal = Math.min(255, bTotal)\n\n      // Môi phỏng Chùm tia Laser (Gaussian Beam)\n      const beamRadius = height * 0.35;\n\n      for (let y = 0; y < height; y++) {\n        const idx = (y * width + x) * 4\n\n        // Vertical Falloff (Beam Shape)\n        const distY = y - height / 2;\n        const beamFactor = Math.exp(-(distY * distY) / (2 * beamRadius * beamRadius));\n\n        // Apply Beam Profile\n        let r = rTotal * beamFactor;\n        let g = gTotal * beamFactor;\n        let b = bTotal * beamFactor;\n\n        // \"Hot Spot\" Bloom effect (Overexposure)\n        // Khi cường độ quá lớn, cảm biến/mắt bị bão hòa -> Trắng\n        const maxVal = Math.max(r, g, b);\n        if (maxVal > 220) {\n          const bloom = (maxVal - 220) * 0.8;\n          r += bloom; g += bloom; b += bloom;\n        }\n\n        // Laser Speckle Noise (Đốm ngẫu nhiên đặc trưng của laser)\n        // Noise tác động mạnh hơn ở vùng sáng\n        if (maxVal > 10) {\n          const speckle = (Math.random() - 0.5) * 30 * (maxVal / 255);\n          r += speckle; g += speckle; b += speckle;\n        }\n\n        data[idx] = Math.max(0, Math.min(255, r))\n        data[idx + 1] = Math.max(0, Math.min(255, g))\n        data[idx + 2] = Math.max(0, Math.min(255, b))\n        data[idx + 3] = 255\n      }\n    }\n    ctx.putImageData(imageData, 0, 0)\n\n    // --- VẼ KÍ HIỆU VÂN TRUNG TÂM (k=0) ---\n    ctx.save()\n    // Kẻ đường đứt nét sáng rõ\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0.9)\"\n    ctx.setLineDash([4, 4])\n    ctx.lineWidth = 1.5\n    ctx.beginPath()\n    ctx.moveTo(centerX, 0)\n    ctx.lineTo(centerX, height)\n    ctx.stroke()\n\n    ctx.textAlign = \"center\"\n    const label = \"Vân trung tâm (k=0)\"\n    ctx.font = \"bold 13px monospace\"\n    const textWidth = ctx.measureText(label).width\n\n    // Hộp nhãn nổi bật\n    const boxX = centerX - textWidth / 2 - 8;\n    const boxY = 10;\n    const boxW = textWidth + 16;\n    const boxH = 26;\n\n    ctx.fillStyle = \"rgba(15, 23, 42, 0.9)\" // Slate-900 transparent\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = \"rgba(255, 255, 255, 0.4)\";\n    ctx.fillRect(boxX, boxY, boxW, boxH)\n    ctx.strokeRect(boxX, boxY, boxW, boxH)\n\n    ctx.fillStyle = \"#ffffff\"\n    ctx.fillText(label, centerX, boxY + 17)\n    ctx.restore()\n\n    // --- VẼ THƯỚC ĐO ---\n    if (lightMode !== 'white') {\n      const i1_meter = (lightParams.wavelength1 * 1e-9 * D) / a\n      const i1_pixel = i1_meter * pixelsPerMeter\n\n      ctx.textAlign = \"center\"\n      const markerY = height / 2\n\n      if (i1_pixel > 15 && i1_pixel < width / 2) {\n        const firstBrightX = centerX + i1_pixel\n        const color1 = wavelengthToRGB(lightParams.wavelength1).colorString\n\n        ctx.strokeStyle = \"rgba(255,255,255,0.9)\"; ctx.fillStyle = \"rgba(255,255,255,0.9)\"; ctx.lineWidth = 1.5\n\n        ctx.beginPath(); ctx.moveTo(centerX, markerY); ctx.lineTo(firstBrightX, markerY); ctx.stroke()\n        ctx.beginPath(); ctx.moveTo(centerX + 5, markerY - 4); ctx.lineTo(centerX, markerY); ctx.lineTo(centerX + 5, markerY + 4); ctx.fill()\n        ctx.beginPath(); ctx.moveTo(firstBrightX - 5, markerY - 4); ctx.lineTo(firstBrightX, markerY); ctx.lineTo(firstBrightX - 5, markerY + 4); ctx.fill()\n\n        ctx.font = \"bold 14px monospace\"\n        const text = `i₁ = ${(i1_meter * 1000).toFixed(2)}mm`\n        const textWidth = ctx.measureText(text).width\n        ctx.fillStyle = \"rgba(0,0,0,0.8)\"; ctx.fillRect(centerX + i1_pixel / 2 - textWidth / 2 - 4, markerY - 24, textWidth + 8, 20)\n        ctx.fillStyle = color1; ctx.fillText(text, centerX + i1_pixel / 2, markerY - 10)\n      }\n    }\n    ctx.textAlign = \"left\"\n  }, [lightParams, lightMode])\n\n\n  // --- ANIMATION LOOP ---\n  const animate = useCallback(() => {\n    const ctx = canvasRef.current?.getContext(\"2d\")\n    if (!ctx) return\n\n    if (mode === 'mechanical') {\n      timeRef.current += dt\n      setTime(timeRef.current)\n      drawMechanical(ctx, timeRef.current)\n      if (isPlaying) {\n        animationRef.current = requestAnimationFrame(animate)\n      }\n    } else {\n      drawLight(ctx)\n    }\n  }, [isPlaying, drawMechanical, drawLight, mode, dt])\n\n  useEffect(() => {\n    if (isPlaying && mode === 'mechanical') {\n      animationRef.current = requestAnimationFrame(animate)\n    }\n    return () => { if (animationRef.current) cancelAnimationFrame(animationRef.current) }\n  }, [isPlaying, animate, mode])\n\n  useEffect(() => {\n    const ctx = canvasRef.current?.getContext(\"2d\")\n    if (!ctx) return\n    if (mode === 'mechanical') {\n      drawMechanical(ctx, timeRef.current)\n    } else {\n      drawLight(ctx)\n    }\n  }, [mechParams, view3D, showNodalLines, lightParams, lightMode, mode, drawMechanical, drawLight])\n\n  const handleReset = () => {\n    if (mode !== 'mechanical') return\n    setIsPlaying(false); timeRef.current = 0; setTime(0)\n    canvasRef.current?.getContext(\"2d\") && drawMechanical(canvasRef.current.getContext(\"2d\")!, 0)\n  }\n  const handleStep = (direction: number) => {\n    if (mode !== 'mechanical') return\n    setIsPlaying(false)\n    timeRef.current = Math.max(0, timeRef.current + dt * direction * 5)\n    setTime(timeRef.current)\n    canvasRef.current?.getContext(\"2d\") && drawMechanical(canvasRef.current.getContext(\"2d\")!, timeRef.current)\n  }\n\n  const calculateI = (wl: number) => (wl * 1e-9 * lightParams.screenDistance) / (lightParams.slitDistance * 1e-3) * 1000\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-4 font-sans items-start\">\n      <div className=\"lg:col-span-3 space-y-4\">\n        {/* Nút chuyển chế độ */}\n        <div className=\"flex gap-3 mb-2 p-1 bg-slate-800/50 rounded-xl w-fit backdrop-blur-sm border border-slate-700/50\">\n          <button\n            onClick={() => { setMode('mechanical'); setIsPlaying(false); }}\n            className={`px-5 py-2 rounded-lg font-bold flex items-center gap-2 transition-all text-sm ${mode === 'mechanical' ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/25 scale-[1.02]' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`}\n          >\n            <Waves size={18} className={mode === 'mechanical' ? 'animate-pulse' : ''} /> mặt nước\n          </button>\n          <button\n            onClick={() => { setMode('light'); setIsPlaying(false); }}\n            className={`px-5 py-2 rounded-lg font-bold flex items-center gap-2 transition-all text-sm ${mode === 'light' ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/25 scale-[1.02]' : 'text-slate-400 hover:text-white hover:bg-slate-700/50'}`}\n          >\n            <Sun size={18} className={mode === 'light' ? 'animate-spin-slow' : ''} /> Ánh Sáng\n          </button>\n        </div>\n\n        {/* Khung mô phỏng - Full height */}\n        <div className=\"bg-[#1e293b] rounded-xl border border-slate-700/50 shadow-xl overflow-hidden group\">\n          {/* Header của Canvas */}\n          <div className=\"px-4 py-2 border-b border-slate-700/50 bg-slate-800/50 flex items-center justify-between\">\n            <h3 className=\"text-sm font-bold text-slate-200 flex items-center gap-2\">\n              {mode === 'mechanical' ? <Waves className=\"w-4 h-4 text-cyan-400\" /> : <Rainbow className=\"w-4 h-4 text-amber-400\" />}\n              {mode === 'mechanical' ? 'Mô phỏng giao thoa mặt nước' : 'Mô phỏng giao thoa ánh sáng'}\n            </h3>\n            <div className=\"flex gap-2\">\n              <span className=\"w-2 h-2 rounded-full bg-red-500\"></span>\n              <span className=\"w-2 h-2 rounded-full bg-yellow-500\"></span>\n              <span className=\"w-2 h-2 rounded-full bg-green-500\"></span>\n            </div>\n          </div>\n\n          <div className=\"p-1 bg-[#0f172a] relative\">\n            <canvas ref={canvasRef} width={800} height={340} className=\"w-full rounded-b-lg block\" />\n            <div className=\"absolute bottom-2 right-4 text-[10px] text-slate-600 font-mono pointer-events-none group-hover:text-slate-500 transition-colors\">\n              Hô Hoàng Anh A1K50\n            </div>\n          </div>\n        </div>\n\n        {/* Controls Sóng cơ (Chỉ hiện khi ở chế độ sóng cơ) */}\n        {mode === 'mechanical' && (\n          <div className=\"bg-[#1e293b]/80 backdrop-blur rounded-xl p-3 border border-slate-700/50 flex items-center gap-4 animate-in fade-in slide-in-from-top-2\">\n            <div className=\"flex items-center gap-2\">\n              <button onClick={handleReset} className=\"w-9 h-9 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white flex items-center justify-center transition-all active:scale-95\">\n                <RotateCcw size={16} />\n              </button>\n              <button onClick={() => handleStep(-1)} className=\"w-9 h-9 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white flex items-center justify-center transition-all active:scale-95\">\n                <SkipBack size={16} />\n              </button>\n              <button\n                onClick={() => setIsPlaying(!isPlaying)}\n                className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all shadow-lg active:scale-95 ${isPlaying ? \"bg-amber-500 hover:bg-amber-400 shadow-amber-900/20\" : \"bg-cyan-500 hover:bg-cyan-400 shadow-cyan-500/30\"\n                  } text-white`}\n              >\n                {isPlaying ? <Pause size={20} fill=\"currentColor\" /> : <Play size={20} fill=\"currentColor\" className=\"ml-1\" />}\n              </button>\n              <button onClick={() => handleStep(1)} className=\"w-9 h-9 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white flex items-center justify-center transition-all active:scale-95\">\n                <SkipForward size={16} />\n              </button>\n            </div>\n            <div className=\"flex-1\"></div>\n          </div>\n        )}\n      </div>\n\n      {/* CỘT PHẢI: BẢNG THAM SỐ */}\n      <div className=\"space-y-4\">\n        {mode === 'mechanical' ? (\n          <>\n            <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50 animate-in fade-in slide-in-from-right-4 shadow-lg\">\n              <h3 className=\"text-cyan-400 font-bold mb-4 flex items-center gap-2 text-sm uppercase tracking-wider border-b border-slate-700/50 pb-2\">\n                <Waves className=\"w-4 h-4\" /> Thông số nguồn\n              </h3>\n              <div className=\"space-y-4\">\n                <div className=\"group\">\n                  <div className=\"flex justify-between text-xs mb-1\">\n                    <label className=\"text-slate-300\">Tần số (f)</label>\n                    <span className=\"text-cyan-400 font-mono\">{mechParams.frequency.toFixed(1)} Hz</span>\n                  </div>\n                  <input type=\"range\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value={mechParams.frequency} onChange={(e) => setMechParams({ ...mechParams, frequency: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\n                </div>\n                <div className=\"group\">\n                  <div className=\"flex justify-between text-xs mb-1\">\n                    <label className=\"text-slate-300\">Bước sóng (λ)</label>\n                    <span className=\"text-cyan-400 font-mono\">{mechParams.wavelength} px</span>\n                  </div>\n                  <input type=\"range\" min=\"20\" max=\"80\" step=\"5\" value={mechParams.wavelength} onChange={(e) => setMechParams({ ...mechParams, wavelength: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\n                </div>\n                <div className=\"group\">\n                  <div className=\"flex justify-between text-xs mb-1\">\n                    <label className=\"text-slate-300\">Khoảng cách nguồn</label>\n                    <span className=\"text-cyan-400 font-mono\">{mechParams.sourceDistance} px</span>\n                  </div>\n                  <input type=\"range\" min=\"40\" max=\"250\" step=\"10\" value={mechParams.sourceDistance} onChange={(e) => setMechParams({ ...mechParams, sourceDistance: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\n                </div>\n                <div className=\"group\">\n                  <div className=\"flex justify-between text-xs mb-1\">\n                    <label className=\"text-slate-300\">Biên độ nguồn</label>\n                    <span className=\"text-cyan-400 font-mono\">{mechParams.amplitude.toFixed(1)}</span>\n                  </div>\n                  <input type=\"range\" min=\"0.5\" max=\"2.5\" step=\"0.1\" value={mechParams.amplitude} onChange={(e) => setMechParams({ ...mechParams, amplitude: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-[#1e293b] rounded-xl p-4 border border-slate-700/50 shadow-lg\">\n              <h3 className=\"text-cyan-400 font-bold mb-3 text-sm uppercase tracking-wider border-b border-slate-700/50 pb-2\">Hiển thị</h3>\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center justify-between cursor-pointer group hover:bg-slate-800/50 p-2 rounded transition-colors\">\n                  <span className=\"text-slate-300 text-xs flex items-center gap-2\">\n                    {showNodalLines ? <Eye className=\"w-3 h-3 text-cyan-400\" /> : <EyeOff className=\"w-3 h-3 text-slate-500\" />}\n                    Đường cực tiểu (Nodal)\n                  </span>\n                  <div onClick={() => setShowNodalLines(!showNodalLines)} className={`w-8 h-4 rounded-full transition-all cursor-pointer flex items-center px-0.5 border ${showNodalLines ? \"bg-cyan-600 border-cyan-500\" : \"bg-slate-700 border-slate-600\"}`}>\n                    <div className={`w-3 h-3 bg-white rounded-full shadow-sm transform transition-transform ${showNodalLines ? \"translate-x-4\" : \"translate-x-0\"}`} />\n                  </div>\n                </label>\n                <label className=\"flex items-center justify-between cursor-pointer group hover:bg-slate-800/50 p-2 rounded transition-colors\">\n                  <span className=\"text-slate-300 text-xs flex items-center gap-2\">\n                    <Maximize2 className=\"w-3 h-3 text-slate-400\" />\n                    Chế độ 3D Surface\n                  </span>\n                  {/* SỬA LỖI SVG: Xóa xmlns bị lỗi */}\n                  <div onClick={() => setView3D(!view3D)} className={`w-8 h-4 rounded-full transition-all cursor-pointer flex items-center px-0.5 border ${view3D ? \"bg-cyan-600 border-cyan-500\" : \"bg-slate-700 border-slate-600\"}`}>\n                    <div className={`w-3 h-3 bg-white rounded-full shadow-sm transform transition-transform ${view3D ? \"translate-x-4\" : \"translate-x-0\"}`} />\n                  </div>\n                </label>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700 animate-in fade-in slide-in-from-right-4 shadow-lg\">\n              <h3 className=\"text-emerald-400 font-bold mb-4 flex items-center gap-2 text-sm uppercase tracking-wider border-b border-slate-700 pb-2\">\n                <Zap className=\"w-4 h-4\" /> Điều Khiển\n              </h3>\n\n              <div className=\"bg-slate-800/50 p-3 rounded-lg mb-4 space-y-1\">\n                <p className=\"text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-wide\">Chế độ</p>\n                <label className=\"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-slate-700/50 transition-colors\">\n                  <input type=\"radio\" name=\"lightMode\" checked={lightMode === 'mono'} onChange={() => setLightMode('mono')} className=\"accent-emerald-500 w-3 h-3\" />\n                  <span className={`text-xs ${lightMode === 'mono' ? 'text-white' : 'text-slate-400'}`}>Đơn sắc (<span className=\"font-serif italic\">λ₁</span>)</span>\n                </label>\n                <label className=\"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-slate-700/50 transition-colors\">\n                  <input type=\"radio\" name=\"lightMode\" checked={lightMode === 'dual'} onChange={() => setLightMode('dual')} className=\"accent-emerald-500 w-3 h-3\" />\n                  <span className={`text-xs ${lightMode === 'dual' ? 'text-white' : 'text-slate-400'}`}>Hai màu (<span className=\"font-serif italic\">λ₁, λ₂</span>)</span>\n                </label>\n                <label className=\"flex items-center gap-2 cursor-pointer p-1.5 rounded hover:bg-slate-700/50 transition-colors\">\n                  <input type=\"radio\" name=\"lightMode\" checked={lightMode === 'white'} onChange={() => setLightMode('white')} className=\"accent-emerald-500 w-3 h-3\" />\n                  <span className={`text-xs ${lightMode === 'white' ? 'text-white' : 'text-slate-400'}`}>Ánh sáng Trắng</span>\n                </label>\n              </div>\n\n              <div className=\"space-y-4\">\n                {(lightMode === 'mono' || lightMode === 'dual') && (\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <label className=\"text-slate-300\">Bước sóng 1 (λ₁)</label>\n                      <span style={{ color: wavelengthToRGB(lightParams.wavelength1).colorString }} className=\"font-mono font-bold text-xs bg-slate-800 px-1.5 rounded\">\n                        {lightParams.wavelength1} nm\n                      </span>\n                    </div>\n                    <input type=\"range\" min=\"380\" max=\"750\" step=\"5\" value={lightParams.wavelength1} onChange={(e) => setLightParams({ ...lightParams, wavelength1: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\n                  </div>\n                )}\n\n                {lightMode === 'dual' && (\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <label className=\"text-slate-300\">Bước sóng 2 (λ₂)</label>\n                      <span style={{ color: wavelengthToRGB(lightParams.wavelength2).colorString }} className=\"font-mono font-bold text-xs bg-slate-800 px-1.5 rounded\">\n                        {lightParams.wavelength2} nm\n                      </span>\n                    </div>\n                    <input type=\"range\" min=\"380\" max=\"750\" step=\"5\" value={lightParams.wavelength2} onChange={(e) => setLightParams({ ...lightParams, wavelength2: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\n                  </div>\n                )}\n\n                <div className=\"pt-2 border-t border-slate-700/50 space-y-3\">\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <label className=\"text-slate-300\">Khoảng cách a</label>\n                      <span className=\"text-emerald-400 font-mono text-xs\">{lightParams.slitDistance.toFixed(2)} mm</span>\n                    </div>\n                    <input type=\"range\" min=\"0.2\" max=\"2.0\" step=\"0.05\" value={lightParams.slitDistance} onChange={(e) => setLightParams({ ...lightParams, slitDistance: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\n                  </div>\n\n                  <div className=\"group\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <label className=\"text-slate-300\">Khoảng cách D</label>\n                      <span className=\"text-emerald-400 font-mono text-xs\">{lightParams.screenDistance.toFixed(1)} m</span>\n                    </div>\n                    <input type=\"range\" min=\"1.0\" max=\"4.0\" step=\"0.1\" value={lightParams.screenDistance} onChange={(e) => setLightParams({ ...lightParams, screenDistance: Number(e.target.value) })} className=\"w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-emerald-600 rounded-xl p-3 border border-emerald-500 shadow-lg text-white\">\n              <h3 className=\"font-bold mb-2 text-xs flex items-center gap-2 uppercase tracking-wide opacity-90\">\n                <Disc className=\"w-3 h-3\" /> Kết Quả\n              </h3>\n\n              {lightMode === 'white' ? (\n                <div className=\"text-xs space-y-1 opacity-90\">\n                  <p>Dải màu cầu vồng.</p>\n                  <p>Vân trung tâm màu trắng.</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between items-end border-b border-emerald-500/50 pb-1\">\n                    <span className=\"text-xs text-emerald-100 opacity-80\">i₁:</span>\n                    <span className=\"font-mono text-lg font-bold leading-none\">{calculateI(lightParams.wavelength1).toFixed(2)} <span className=\"text-[10px] font-normal opacity-70\">mm</span></span>\n                  </div>\n                  {lightMode === 'dual' && (\n                    <div className=\"flex justify-between items-end border-b border-emerald-500/50 pb-1\">\n                      <span className=\"text-xs text-emerald-100 opacity-80\">i₂:</span>\n                      <span className=\"font-mono text-lg font-bold leading-none\">{calculateI(lightParams.wavelength2).toFixed(2)} <span className=\"text-[10px] font-normal opacity-70\">mm</span></span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9662, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/standing-waves.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Play, Pause, RefreshCw, Info, Settings, Zap, Type, ChevronRight, Circle } from 'lucide-react';\n\ntype BoundaryMode = 'fixed-fixed' | 'fixed-free';\n\nconst StandingWaveSim = () => {\n  // --- State Configuration ---\n  const [mode, setMode] = useState<BoundaryMode>('fixed-fixed');\n\n  // Physical parameters\n  const [length, setLength] = useState(1.5); // Length (m)\n  const [amplitude, setAmplitude] = useState(0.5); // Amplitude (relative units)\n  const [tension, setTension] = useState(50); // Tension (N)\n  const [linearDensity, setLinearDensity] = useState(0.01); // kg/m\n  const [frequency, setFrequency] = useState(40); // Frequency (Hz) - NEW INPUT\n\n  // Simulation state\n  const [isPlaying, setIsPlaying] = useState(true);\n  const [time, setTime] = useState(0);\n\n  // Canvas Refs\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const animationRef = useRef<number>();\n\n  // --- Physics Calculations ---\n  // v = sqrt(T / mu)\n  const waveSpeed = Math.sqrt(tension / linearDensity);\n\n  // lambda = v / f\n  const wavelength = waveSpeed / frequency;\n\n  // k_wave (angular wavenumber) = 2pi / lambda\n  const kWave = (2 * Math.PI) / wavelength;\n  const omega = 2 * Math.PI * frequency;\n\n  // Calculated Number of Antinodes (Real-time visual count) for the given Length\n  // k_visible = 2L / lambda\n  // If integer -> Resonance\n  const currentK = (2 * length) / wavelength;\n\n  // Energy rough estimation\n  const energy = 0.5 * linearDensity * length * Math.pow(omega * amplitude * 0.05, 2);\n\n  // --- Animation Loop ---\n  const animate = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const centerY = height / 2;\n\n    // Dark Theme Colors\n    const colorBg = '#0f172a'; // slate-900\n    const colorGrid = '#1e293b'; // slate-800\n    const colorAxis = '#334155'; // slate-700\n    const colorWave = '#22d3ee'; // cyan-400 (Neon)\n    const colorNode = '#f472b6'; // pink-400\n    const colorText = '#94a3b8'; // slate-400\n\n    const padding = 60;\n    const drawWidth = width - 2 * padding;\n    const pxPerMeter = drawWidth / length;\n\n    // Clear canvas\n    ctx.fillStyle = colorBg;\n    ctx.fillRect(0, 0, width, height);\n\n    // 1. Draw Grid\n    ctx.strokeStyle = colorGrid;\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    for (let i = 0; i <= height; i += 40) { ctx.moveTo(0, i); ctx.lineTo(width, i); }\n    for (let i = 0; i <= width; i += 40) { ctx.moveTo(i, 0); ctx.lineTo(i, height); }\n    ctx.stroke();\n\n    // 2. Draw Axes\n    ctx.strokeStyle = colorAxis;\n    ctx.setLineDash([5, 5]);\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(padding, centerY);\n    ctx.lineTo(width - padding, centerY);\n    ctx.stroke();\n\n    // Vertical Ref Lines\n    ctx.setLineDash([]);\n    ctx.strokeStyle = colorAxis;\n    ctx.beginPath();\n    ctx.moveTo(padding, 40); ctx.lineTo(padding, height - 40); // Sound Source\n    ctx.moveTo(width - padding, 40); ctx.lineTo(width - padding, height - 40); // End Post\n    ctx.stroke();\n\n    // 3. Draw The Wave\n    ctx.beginPath();\n    ctx.moveTo(padding, centerY);\n\n    let endPointY = centerY;\n\n    // Simulate \"Standing Wave\" Pattern with Correct Boundary Conditions (Driven System)\n    // We model the string driven at x=0 with amplitude A, and fixed/free at x=L.\n\n    // Calculate Resonance Gain Factor (Denominator)\n    // To avoid infinity, we add a small \"damping\" term imaginary or just clamp the denominator.\n    // Simple approach: min(Limit, 1/sin(kL))\n\n    let denominator = 0;\n    if (mode === 'fixed-fixed') {\n      // Condition: sin(kL)\n      denominator = Math.sin(kWave * length);\n    } else {\n      // Condition: cos(kL) for Fixed-Free (Node at 0, Slope 0 at L... wait)\n      // Driver at 0 is Displacment Source.\n      // Fixed-Free means x=L is Free (Antinode of displacement, Node of Slope).\n      // Form: y(x) ~ cos(k(L-x)) -> y'(L)=0 (Slope 0, Max Amp). \n      // y(0) = cos(kL).\n      denominator = Math.cos(kWave * length);\n    }\n\n    // \"Soft\" resonance limit (Simulating Damping)\n    const damping = 0.15; // Minimum value of denominator\n    // If denominator is close to 0, wave blows up.\n    // Effective Gain = 1 / sqrt(den^2 + damp^2)\n    const gain = 1 / Math.sqrt(denominator * denominator + damping * damping);\n\n    // Phase shift? At resonance, phase flips. \n    // cos(wt) term is fine. We just multiply by (1/den). \n    // If den < 0, it flips phase naturally.\n\n    const maxVisualScale = 150;\n\n    for (let px = 0; px <= drawWidth; px++) {\n      const xPhysical = px / pxPerMeter;\n      let shape = 0;\n\n      if (mode === 'fixed-fixed') {\n        // Wave function satisfying y(L)=0\n        // y(x) = sin(k(L-x))\n        // Amplitude scaled to match y(0) = A_source\n        shape = Math.sin(kWave * (length - xPhysical));\n      } else {\n        // Wave function satisfying y'(L)=0 (Free End)\n        // y(x) = cos(k(L-x))\n        shape = Math.cos(kWave * (length - xPhysical));\n      }\n\n      // Resulting Wave\n      const envelope = amplitude * gain * shape;\n      const yPhysical = envelope * Math.cos(omega * time);\n\n      // Actually, just scale by fixed constant, let it grow.\n      // But limit screen space.\n\n      const yDrawFinal = centerY - yPhysical * 60; // 60 is view scale\n\n      ctx.lineTo(padding + px, yDrawFinal);\n      if (px === drawWidth) endPointY = yDrawFinal;\n    }\n\n    // Helper to draw fixed end correctly visually\n    // With sin(k(L-x)), at x_phys = length, sin(0) = 0. So yDraw = centerY.\n    // So B is Fixed. Correct.\n\n    // Neon Style Wave\n    ctx.strokeStyle = colorWave;\n    ctx.lineWidth = 3;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n    ctx.shadowBlur = 15;\n    ctx.shadowColor = colorWave;\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // 4. Draw Nodes/Ends\n    // Point A (Source)\n    ctx.fillStyle = colorNode;\n    ctx.beginPath();\n    ctx.arc(padding, centerY, 6, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.fillStyle = colorText;\n    ctx.font = '600 14px \"Courier New\", monospace';\n    ctx.fillText('A (Nguồn)', padding - 30, centerY - 20);\n\n    // Point B (End)\n    // If Fixed: Clamp. If Free: Ring.\n    // We draw the clamp at the PHYSICAL location L. \n    // If the wave node doesn't match, it visually \"passes through\" or looks disconnected?\n    // Let's draw the clamp rigidly.\n\n    if (mode === 'fixed-fixed') {\n      ctx.fillStyle = colorNode;\n      ctx.beginPath();\n      ctx.arc(width - padding, centerY, 6, 0, Math.PI * 2); // Clamp is always at 0 displacement\n      ctx.fill();\n      ctx.fillStyle = colorText;\n      ctx.fillText('B (Cố định)', width - padding - 40, centerY - 20);\n\n      // Visual feedback: If EndPointY is far from CenterY -> \"Vibration at Clamp\" (Bad)\n      if (Math.abs(endPointY - centerY) > 5) {\n        ctx.strokeStyle = \"red\";\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        ctx.moveTo(width - padding, centerY);\n        ctx.lineTo(width - padding, endPointY);\n        ctx.stroke();\n      }\n\n    } else {\n      // Fixed-Free: B is a ring on a pole\n      ctx.strokeStyle = colorNode;\n      ctx.lineWidth = 3;\n      ctx.fillStyle = '#0f172a';\n      ctx.beginPath();\n      ctx.arc(width - padding, endPointY, 6, 0, Math.PI * 2); // Ring moves with wave\n      ctx.fill();\n      ctx.stroke();\n\n      // Pole\n      ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n      ctx.lineWidth = 4;\n      ctx.beginPath();\n      ctx.moveTo(width - padding, centerY - 100);\n      ctx.lineTo(width - padding, centerY + 100);\n      ctx.stroke();\n\n      ctx.fillStyle = colorText;\n      ctx.fillText('B (Tự do)', width - padding - 40, endPointY - 30);\n    }\n\n    // Draw Time\n    ctx.fillStyle = '#fff';\n    ctx.font = '16px \"Courier New\", monospace';\n    ctx.fillText(`t = ${time.toFixed(3)}s`, 20, 30);\n\n    // Update time\n    const timeStep = 0.005;\n    if (isPlaying) {\n      setTime(prev => prev + timeStep);\n    }\n\n    animationRef.current = requestAnimationFrame(animate);\n  }, [length, amplitude, kWave, omega, time, isPlaying, mode]);\n\n  useEffect(() => {\n    animationRef.current = requestAnimationFrame(animate);\n    return () => {\n      if (animationRef.current) cancelAnimationFrame(animationRef.current);\n    };\n  }, [animate]);\n\n  const handleReset = () => {\n    setTime(0);\n    setIsPlaying(true);\n  };\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-[#020617] font-sans text-slate-200 selection:bg-cyan-500/30\">\n\n      <main className=\"flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8\">\n\n        {/* LEFT COLUMN: VISUALIZATION (8 cols) */}\n        <div className=\"lg:col-span-8 flex flex-col gap-6\">\n\n          {/* Canvas Card */}\n          <div className=\"bg-[#0f172a] rounded-2xl shadow-2xl border border-slate-800 overflow-hidden relative group\">\n            <div className=\"absolute top-4 right-4 z-10 flex gap-2\">\n              <div className={`px-3 py-1 rounded-full text-xs font-bold border ${mode === 'fixed-fixed' ? 'border-cyan-500/50 text-cyan-400 bg-cyan-950/30' : 'border-slate-700 text-slate-400 bg-slate-900/50'}`}>\n                2 ĐẦU CỐ ĐỊNH\n              </div>\n              <div className={`px-3 py-1 rounded-full text-xs font-bold border ${mode === 'fixed-free' ? 'border-pink-500/50 text-pink-400 bg-pink-950/30' : 'border-slate-700 text-slate-400 bg-slate-900/50'}`}>\n                1 ĐẦU TỰ DO\n              </div>\n            </div>\n\n            <canvas\n              ref={canvasRef}\n              width={900}\n              height={500}\n              className=\"w-full h-auto bg-[#0f172a]\"\n            />\n          </div>\n\n          {/* Playback Control Bar */}\n          <div className=\"bg-[#0f172a] rounded-2xl border border-slate-800 p-4 flex items-center justify-between shadow-lg\">\n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={handleReset}\n                className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 transition-colors\"\n                title=\"Reset\"\n              >\n                <RefreshCw size={18} />\n              </button>\n              <div className=\"h-8 w-[1px] bg-slate-700 mx-2\"></div>\n              <button\n                onClick={() => setIsPlaying(!isPlaying)}\n                className={`w-14 h-14 flex items-center justify-center rounded-full shadow-lg transition-all active:scale-95 ${isPlaying ? 'bg-cyan-500/20 text-cyan-400 ring-2 ring-cyan-500/50' : 'bg-cyan-500 text-slate-900 hover:bg-cyan-400'}`}\n              >\n                {isPlaying ? <Pause size={28} fill=\"currentColor\" /> : <Play size={28} fill=\"currentColor\" className=\"ml-1\" />}\n              </button>\n            </div>\n\n            {/* Live Data Display (Mini) */}\n            <div className=\"hidden sm:flex gap-8 text-right font-mono text-sm\">\n              <div title=\"Số bó sóng thực tế (k)\">\n                <div className=\"text-slate-500 text-xs uppercase mb-1\">Harmonics (k)</div>\n                <div className={`font-bold text-lg ${Math.abs(currentK - Math.round(currentK)) < 0.1 ? 'text-green-400' : 'text-slate-400'}`}>\n                  {currentK.toFixed(2)}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-slate-500 text-xs uppercase mb-1\">Wavelength</div>\n                <div className=\"text-pink-400 font-bold text-lg\">{wavelength.toFixed(2)} <span className=\"text-xs text-slate-500\">m</span></div>\n              </div>\n            </div>\n          </div>\n\n          {/* Theory / Formulas Card */}\n          <div className=\"bg-[#0f172a] rounded-2xl border border-slate-800 p-6 shadow-lg\">\n            <h3 className=\"text-cyan-400 font-bold mb-4 flex items-center gap-2\">\n              <Type size={18} /> Công thức Sóng Dừng\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-slate-300 font-mono leading-relaxed\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between border-b border-slate-800 pb-2\">\n                  <span>Vận tốc (v):</span>\n                  <span className=\"text-emerald-400\">√(T/μ) = {waveSpeed.toFixed(1)} m/s</span>\n                </div>\n                <div className=\"flex justify-between border-b border-slate-800 pb-2\">\n                  <span>Bước sóng (λ):</span>\n                  <span className=\"text-emerald-400\">v/f = {wavelength.toFixed(2)} m</span>\n                </div>\n                <div className=\"flex justify-between border-b border-slate-800 pb-2\">\n                  <span>Số bó sóng (k):</span>\n                  <span className=\"text-emerald-400\">2L/λ = {currentK.toFixed(2)}</span>\n                </div>\n              </div>\n              <div className=\"bg-slate-900/50 p-4 rounded-lg border border-slate-800\">\n                <p className=\"text-slate-400 text-xs mb-2 uppercase tracking-wider\">Điều kiện biên ({mode === 'fixed-fixed' ? '2 Đầu Cố Định' : '1 Đầu Tự Do'})</p>\n                <div className=\"text-lg text-pink-300\">\n                  {mode === 'fixed-fixed' ? 'L = k(λ/2)' : 'L = (2k-1)(λ/4)'}\n                </div>\n                <p className={`mt-2 text-xs italic ${Math.abs(currentK - Math.round(currentK)) < 0.1 ? 'text-green-400' : 'text-slate-500'}`}>\n                  {Math.abs(currentK - Math.round(currentK)) < 0.1 ? '✓ Đang cộng hưởng!' : '• Chưa cộng hưởng'}\n                </p>\n              </div>\n            </div>\n          </div>\n\n        </div>\n\n        {/* RIGHT COLUMN: CONTROLS (4 cols) */}\n        <div className=\"lg:col-span-4 flex flex-col gap-6\">\n\n          {/* Main Parameters Panel */}\n          <div className=\"bg-[#0f172a] rounded-2xl border border-slate-800 p-6 shadow-lg\">\n            <h2 className=\"text-lg font-bold mb-6 text-white flex items-center gap-2\">\n              <Settings size={20} className=\"text-cyan-400\" /> Thông số dao động\n            </h2>\n\n            {/* Mode Toggle */}\n            <div className=\"mb-8 p-1 bg-slate-900 rounded-lg flex border border-slate-800\">\n              <button\n                onClick={() => setMode('fixed-fixed')}\n                className={`flex-1 py-2 text-xs font-bold rounded-md transition-all uppercase tracking-wide ${mode === 'fixed-fixed'\n                  ? 'bg-cyan-500 text-slate-900 shadow-lg shadow-cyan-500/20'\n                  : 'text-slate-500 hover:text-slate-300'\n                  }`}\n              >\n                2 Đầu Cố Định\n              </button>\n              <button\n                onClick={() => setMode('fixed-free')}\n                className={`flex-1 py-2 text-xs font-bold rounded-md transition-all uppercase tracking-wide ${mode === 'fixed-free'\n                  ? 'bg-pink-500 text-slate-900 shadow-lg shadow-pink-500/20'\n                  : 'text-slate-500 hover:text-slate-300'\n                  }`}\n              >\n                1 Đầu Tự Do\n              </button>\n            </div>\n\n            {/* Sliders */}\n            <div className=\"space-y-8\">\n\n              {/* Frequency (Replaced K) */}\n              <div className=\"group\">\n                <div className=\"flex justify-between text-sm mb-2 font-medium\">\n                  <span className=\"text-slate-400 group-hover:text-cyan-400 transition-colors\">Tần số (Hz)</span>\n                  <span className=\"text-cyan-400 font-mono\">{frequency} Hz</span>\n                </div>\n                <input\n                  type=\"range\" min=\"10\" max=\"100\" step=\"1\"\n                  value={frequency}\n                  onChange={(e) => setFrequency(parseInt(e.target.value))}\n                  className=\"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400\"\n                />\n              </div>\n\n              {/* Length */}\n              <div className=\"group\">\n                <div className=\"flex justify-between text-sm mb-2 font-medium\">\n                  <span className=\"text-slate-400 group-hover:text-cyan-400 transition-colors\">Chiều dài dây (L)</span>\n                  <span className=\"text-cyan-400 font-mono\">{length.toFixed(1)} m</span>\n                </div>\n                <input\n                  type=\"range\" min=\"0.5\" max=\"5.0\" step=\"0.1\"\n                  value={length}\n                  onChange={(e) => setLength(Number(e.target.value))}\n                  className=\"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400\"\n                />\n              </div>\n\n              {/* Tension */}\n              <div className=\"group\">\n                <div className=\"flex justify-between text-sm mb-2 font-medium\">\n                  <span className=\"text-slate-400 group-hover:text-cyan-400 transition-colors\">Lực căng (T)</span>\n                  <span className=\"text-cyan-400 font-mono\">{tension} N</span>\n                </div>\n                <input\n                  type=\"range\" min=\"10\" max=\"200\" step=\"1\"\n                  value={tension}\n                  onChange={(e) => setTension(Number(e.target.value))}\n                  className=\"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400\"\n                />\n              </div>\n\n              {/* Amplitude */}\n              <div className=\"group\">\n                <div className=\"flex justify-between text-sm mb-2 font-medium\">\n                  <span className=\"text-slate-400 group-hover:text-cyan-400 transition-colors\">Biên độ nguồn (A)</span>\n                  <span className=\"text-cyan-400 font-mono\">{(amplitude * 2).toFixed(1)} cm</span>\n                </div>\n                <input\n                  type=\"range\" min=\"0.1\" max=\"1.0\" step=\"0.1\"\n                  value={amplitude}\n                  onChange={(e) => setAmplitude(Number(e.target.value))}\n                  className=\"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400\"\n                />\n              </div>\n\n              {/* Density */}\n              <div className=\"group\">\n                <div className=\"flex justify-between text-sm mb-2 font-medium\">\n                  <span className=\"text-slate-400 group-hover:text-cyan-400 transition-colors\">Mật độ dây (μ)</span>\n                  <span className=\"text-cyan-400 font-mono\">{linearDensity.toFixed(3)} kg/m</span>\n                </div>\n                <input\n                  type=\"range\" min=\"0.001\" max=\"0.05\" step=\"0.001\"\n                  value={linearDensity}\n                  onChange={(e) => setLinearDensity(Number(e.target.value))}\n                  className=\"w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 hover:accent-cyan-400\"\n                />\n              </div>\n\n            </div>\n          </div>\n\n          {/* Energy / Stats Panel */}\n          <div className=\"bg-[#0f172a] rounded-2xl border border-slate-800 p-6 shadow-lg\">\n            <h3 className=\"text-yellow-400 font-bold mb-4 flex items-center gap-2\">\n              <Zap size={18} /> Năng lượng sóng\n            </h3>\n\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex justify-between text-xs text-slate-400 mb-1\">\n                  <span>Tốc độ truyền sóng (v)</span>\n                  <span className=\"text-emerald-400 font-mono\">{waveSpeed.toFixed(1)} m/s</span>\n                </div>\n                <div className=\"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-emerald-500 rounded-full transition-all duration-300\"\n                    style={{ width: `${Math.min((waveSpeed / 200) * 100, 100)}%` }}\n                  ></div>\n                </div>\n              </div>\n\n              <div>\n                <div className=\"flex justify-between text-xs text-slate-400 mb-1\">\n                  <span>Ước lượng năng lượng (E)</span>\n                  <span className=\"text-yellow-400 font-mono\">{energy.toFixed(3)} J</span>\n                </div>\n                <div className=\"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-yellow-500 rounded-full transition-all duration-300\"\n                    style={{ width: `${Math.min((energy * 50), 100)}%` }}\n                  ></div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"mt-6 pt-4 border-t border-slate-800\">\n              <div className=\"flex items-start gap-2 text-xs text-slate-500\">\n                <Circle size={12} className=\"mt-0.5 text-cyan-400 fill-cyan-400 animate-pulse\" />\n                <span>Điều chỉnh Tần số, Chiều dài, hoặc Lực căng để tìm điểm cộng hưởng (k nguyên).</span>\n              </div>\n            </div>\n          </div>\n\n        </div>\n      </main>\n    </div>\n  );\n};\nexport default StandingWaveSim;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10788, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/sound-speed.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Play, Pause, RefreshCw, Volume2, Mic, Settings, Info, Zap } from 'lucide-react';\r\n\r\nconst SoundSpeedExperiment = () => {\r\n    // --- State ---\r\n    // Length of air column L (m)\r\n    // We control the Water Level. Tube Length is fixed (say 1.2m).\r\n    // waterLevel is distance from bottom. L = TubeHeight - waterLevel.\r\n    // Actually simpler: Input is \"Air Column Length L\" directly (simulating moving reservoir).\r\n    const [airLength, setAirLength] = useState(0.5); // meters\r\n    const [frequency, setFrequency] = useState(440); // Hz\r\n    const [temperature, setTemperature] = useState(20); // Celsius (affects V)\r\n    const [isPlaying, setIsPlaying] = useState(true);\r\n    const [volume, setVolume] = useState(0.5); // Simulation Volume\r\n\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const animationRef = useRef<number>();\r\n    const timeRef = useRef(0);\r\n\r\n    // --- Physics ---\r\n    // v = 331.5 + 0.6 * T\r\n    const speedOfSound = 331.5 + 0.6 * temperature;\r\n    const wavelength = speedOfSound / frequency;\r\n\r\n    // Resonance condition for Closed Tube (water closed one end):\r\n    // Resonance starts at L = lambda/4, 3lambda/4, 5lambda/4 ...\r\n    // L_resonance = (2k + 1) * lambda / 4\r\n\r\n    // Calculate resonance \"intensity\" (0 to 1) based on how close L is to resonance\r\n    // A simple Lorentzian or Gaussian peak around resonance points.\r\n    const calculateResonanceIntensity = (L: number, lambda: number) => {\r\n        // Find closest resonance mode\r\n        // L = n * lambda/4 where n is odd integer\r\n        const n_float = (4 * L) / lambda;\r\n        // We want n close to 1, 3, 5, 7...\r\n        // Distance to closest odd integer:\r\n        const n_round = Math.round(n_float);\r\n        const isOdd = n_round % 2 !== 0;\r\n\r\n        // If rounded is even, we are far from odd resonance? Be careful.\r\n        // e.g. 2.0 -> Resonances at 1.0, 3.0.  2.0 is anti-resonance.\r\n        // Distance to closest ODD integer:\r\n        // math trick: distance(x, odd) = abs( (x-1)/2 - round((x-1)/2) ) * 2 ?? No.\r\n        // Simpler: find closest k for (2k+1). \r\n        // Target = (2k+1). Closest match.\r\n\r\n        // Scan typical modes (1, 3, 5, 7, 9)\r\n        let minDiff = 1000;\r\n        for (let k = 0; k < 10; k++) {\r\n            const targetN = 2 * k + 1;\r\n            const diff = Math.abs(n_float - targetN);\r\n            if (diff < minDiff) minDiff = diff;\r\n        }\r\n\r\n        // Width of resonance peak (Q factor simulation)\r\n        const width = 0.15; // Tuning sharpness\r\n        // Resonance shape: 1 / (1 + (diff/width)^2)\r\n        return 1 / (1 + (minDiff / width) ** 2);\r\n    };\r\n\r\n    const resonanceIntensity = calculateResonanceIntensity(airLength, wavelength);\r\n\r\n    // --- Audio Engine ---\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const audioContextRef = useRef<AudioContext | null>(null);\r\n    const oscillatorRef = useRef<OscillatorNode | null>(null);\r\n    const gainNodeRef = useRef<GainNode | null>(null);\r\n\r\n    // Initialize Audio Context on first play interact (or effect, but suspended)\r\n    useEffect(() => {\r\n        if (!audioContextRef.current) {\r\n            const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\r\n            audioContextRef.current = new AudioContextClass();\r\n\r\n            // Master Gain\r\n            const gainNode = audioContextRef.current.createGain();\r\n            gainNode.connect(audioContextRef.current.destination);\r\n            gainNodeRef.current = gainNode;\r\n        }\r\n        return () => {\r\n            if (audioContextRef.current) {\r\n                audioContextRef.current.close();\r\n                audioContextRef.current = null;\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Handle Oscillator & Playback\r\n    useEffect(() => {\r\n        const ctx = audioContextRef.current;\r\n        if (!ctx) return;\r\n\r\n        if (isPlaying && !isMuted) {\r\n            // Resume if suspended (browser policy)\r\n            if (ctx.state === 'suspended') ctx.resume();\r\n\r\n            // Create Osc if needed\r\n            if (!oscillatorRef.current) {\r\n                const osc = ctx.createOscillator();\r\n                osc.type = 'sine';\r\n                osc.frequency.setValueAtTime(frequency, ctx.currentTime);\r\n                osc.connect(gainNodeRef.current!);\r\n                osc.start();\r\n                oscillatorRef.current = osc;\r\n            } else {\r\n                // Update freq smoothly\r\n                oscillatorRef.current.frequency.setTargetAtTime(frequency, ctx.currentTime, 0.1);\r\n            }\r\n        } else {\r\n            // Stop\r\n            if (oscillatorRef.current) {\r\n                oscillatorRef.current.stop();\r\n                oscillatorRef.current.disconnect();\r\n                oscillatorRef.current = null;\r\n            }\r\n        }\r\n    }, [isPlaying, isMuted, frequency]);\r\n\r\n    // Handle Volume / Resonance\r\n    useEffect(() => {\r\n        const ctx = audioContextRef.current;\r\n        const gainNode = gainNodeRef.current;\r\n\r\n        if (ctx && gainNode) {\r\n            if (!isPlaying || isMuted) {\r\n                gainNode.gain.setTargetAtTime(0, ctx.currentTime, 0.1);\r\n            } else {\r\n                // Base volume (0.01) + Resonance Boost (up to 0.3)\r\n                // When resonant -> Loud. When not -> Quiet hum.\r\n                const targetGain = 0.01 + (resonanceIntensity * 0.4);\r\n                gainNode.gain.setTargetAtTime(targetGain, ctx.currentTime, 0.1);\r\n            }\r\n        }\r\n    }, [resonanceIntensity, isPlaying, isMuted]);\r\n\r\n    // --- Animation ---\r\n    const animate = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n        const centerX = width / 2;\r\n\r\n        // Time update\r\n        if (isPlaying) {\r\n            timeRef.current += 0.01; // dt\r\n        }\r\n        const t = timeRef.current;\r\n\r\n        // --- Draw ---\r\n        ctx.clearRect(0, 0, width, height);\r\n\r\n        // Background\r\n        ctx.fillStyle = \"#0f172a\";\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // 1. Draw Tube system\r\n        const tubeWidth = 60;\r\n        const tubeHeight = 400; // pixels\r\n        const tubeBottomY = height - 50;\r\n        const tubeTopY = tubeBottomY - tubeHeight;\r\n        const tubeX = centerX;\r\n\r\n        // Scale: 1.2m = tubeHeight (400px) => 1m = 333px\r\n        const pxPerM = tubeHeight / 1.2;\r\n        const airHeightPx = airLength * pxPerM;\r\n        const waterLevelY = tubeTopY + airHeightPx;\r\n\r\n        // Draw Water (Blue)\r\n        ctx.fillStyle = \"rgba(6, 182, 212, 0.6)\"; // Cyan-500\r\n        ctx.fillRect(tubeX - tubeWidth / 2, waterLevelY, tubeWidth, tubeBottomY - waterLevelY);\r\n\r\n        // Draw Glass Tube Walls\r\n        ctx.strokeStyle = \"rgba(255, 255, 255, 0.4)\";\r\n        ctx.lineWidth = 4;\r\n        ctx.beginPath();\r\n        ctx.moveTo(tubeX - tubeWidth / 2, tubeTopY - 20); // Top flare\r\n        ctx.lineTo(tubeX - tubeWidth / 2, tubeBottomY);\r\n        ctx.lineTo(tubeX + tubeWidth / 2, tubeBottomY);\r\n        ctx.lineTo(tubeX + tubeWidth / 2, tubeTopY - 20);\r\n        ctx.stroke();\r\n\r\n        // 2. Tuning Fork (Above Tube)\r\n        const forkY = tubeTopY - 40;\r\n        const forkAmp = isPlaying ? 3 : 0;\r\n        const vib = Math.sin(t * frequency * 0.5) * forkAmp; // Fake visual freq\r\n\r\n        // Stem\r\n        ctx.strokeStyle = \"#94a3b8\"; // Slate-400\r\n        ctx.lineWidth = 6;\r\n        ctx.beginPath();\r\n        ctx.moveTo(centerX, forkY);\r\n        ctx.lineTo(centerX, forkY - 40);\r\n        ctx.stroke();\r\n\r\n        // Prongs (Vibrating)\r\n        ctx.lineWidth = 4;\r\n        ctx.beginPath();\r\n        // Left Prong\r\n        ctx.moveTo(centerX, forkY);\r\n        ctx.quadraticCurveTo(centerX - 15 + vib, forkY + 30, centerX - 15 + vib, forkY + 60);\r\n        // Right Prong\r\n        ctx.moveTo(centerX, forkY);\r\n        ctx.quadraticCurveTo(centerX + 15 - vib, forkY + 30, centerX + 15 - vib, forkY + 60);\r\n        ctx.stroke();\r\n\r\n        // 3. Sound Waves (Visualizing Resonance)\r\n        // Standing Wave inside air column\r\n        // Node at water (Closed end), Antinode at open top (approx).\r\n        if (isPlaying) {\r\n            ctx.strokeStyle = `rgba(244, 114, 182, ${0.3 + resonanceIntensity * 0.7})`; // Pink, brighter if resonant\r\n            ctx.lineWidth = 2;\r\n            ctx.beginPath();\r\n\r\n            // Draw sine wave envelope vertical\r\n            // y from tubeTopY to waterLevelY (0 to L)\r\n            // Amplitude = Envelope\r\n            const steps = 50;\r\n            for (let i = 0; i <= steps; i++) {\r\n                const yRel = (i / steps) * airHeightPx; // 0 (top) to H (bottom)\r\n                const yDraw = tubeTopY + yRel;\r\n\r\n                // Physics: Closed End at Bottom (Node), Open at Top (Antinode)\r\n                // WAIT! Standing wave shape:\r\n                // Bottom (Water): Displacement Node -> Amp = 0.\r\n                // Top (Open): Displacement Antinode -> Amp = Max.\r\n                // Function: sin(k * distance_from_bottom)\r\n                // distance_from_bottom = airHeightPx - yRel\r\n\r\n                const xPhys = airLength - (yRel / pxPerM); // x=0 at bottom\r\n                // k * xPhys\r\n                // k = 2pi / lambda\r\n                const k = (2 * Math.PI) / wavelength;\r\n                // Standing wave term: sin(kx) * cos(wt)\r\n                // Scale amplitude by resonanceIntensity!\r\n                const standingAmp = 15 * resonanceIntensity * Math.sin(k * xPhys);\r\n\r\n                // Visualize instantaneous\r\n                const displace = standingAmp * Math.cos(t * frequency * 0.2); // Slow visual freq\r\n\r\n                if (i === 0) ctx.moveTo(centerX + displace, yDraw);\r\n                else ctx.lineTo(centerX + displace, yDraw);\r\n            }\r\n            ctx.stroke();\r\n\r\n            // Emit Sound Waves OUTSIDE (Arcs)\r\n            // Intensity depends on Resonance\r\n            if (resonanceIntensity > 0.1) {\r\n                ctx.strokeStyle = `rgba(255, 255, 255, ${resonanceIntensity - (t % 1)})`;\r\n                ctx.lineWidth = 2;\r\n                const rBase = (t * 50) % 100;\r\n                for (let r = rBase; r < 200; r += 40) {\r\n                    const alpha = Math.max(0, 1 - r / 200) * resonanceIntensity;\r\n                    ctx.strokeStyle = `rgba(255,255,255,${alpha})`;\r\n                    ctx.beginPath();\r\n                    ctx.arc(centerX, forkY, r, Math.PI, 0); // Top semi-circles\r\n                    ctx.stroke();\r\n                }\r\n            }\r\n        }\r\n\r\n        // 4. Ruler / Measurement\r\n        ctx.fillStyle = \"#64748b\";\r\n        ctx.font = \"12px monospace\";\r\n        ctx.textAlign = \"right\";\r\n        for (let m = 0; m <= 1.2; m += 0.1) {\r\n            const yMark = tubeTopY + (m * pxPerM);\r\n            if (yMark > tubeBottomY) break;\r\n            ctx.fillRect(tubeX - tubeWidth / 2 - 10, yMark, 8, 1);\r\n            ctx.fillText(`${m.toFixed(1)}m`, tubeX - tubeWidth / 2 - 14, yMark + 4);\r\n        }\r\n\r\n        // Current Level Indicator\r\n        ctx.strokeStyle = \"#ef4444\"; // Red\r\n        ctx.setLineDash([4, 4]);\r\n        ctx.beginPath();\r\n        ctx.moveTo(tubeX - tubeWidth - 20, waterLevelY);\r\n        ctx.lineTo(tubeX + tubeWidth + 20, waterLevelY);\r\n        ctx.stroke();\r\n        ctx.setLineDash([]);\r\n        ctx.fillStyle = \"#ef4444\";\r\n        ctx.fillText(`L = ${airLength.toFixed(3)}m`, tubeX - tubeWidth - 25, waterLevelY + 4);\r\n\r\n\r\n        animationRef.current = requestAnimationFrame(animate);\r\n    }, [airLength, frequency, isPlaying, resonanceIntensity, wavelength]);\r\n\r\n    useEffect(() => {\r\n        animationRef.current = requestAnimationFrame(animate);\r\n        return () => {\r\n            if (animationRef.current) cancelAnimationFrame(animationRef.current);\r\n        };\r\n    }, [animate]);\r\n\r\n    return (\r\n        <div className=\"flex flex-col min-h-screen bg-[#020617] font-sans text-slate-200\">\r\n            <main className=\"flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8\">\r\n\r\n                {/* Sim Canvas */}\r\n                <div className=\"lg:col-span-7 bg-[#0f172a] rounded-2xl border border-slate-800 shadow-xl overflow-hidden relative\">\r\n                    <canvas ref={canvasRef} width={600} height={600} className=\"w-full h-full object-contain\" />\r\n\r\n                    {/* Loudness Meter Overlay */}\r\n                    <div className=\"absolute top-4 left-4 bg-slate-900/80 p-3 rounded-lg border border-slate-700 backdrop-blur-sm\">\r\n                        <div className=\"flex items-center gap-2 mb-2 text-pink-400 font-bold text-sm\">\r\n                            <Mic size={16} /> Cường độ âm (dB)\r\n                        </div>\r\n                        <div className=\"w-4 h-32 bg-slate-800 rounded-full overflow-hidden flex flex-col justify-end border border-slate-700 mx-auto\">\r\n                            <div\r\n                                className=\"w-full bg-gradient-to-t from-green-500 via-yellow-500 to-red-500 transition-all duration-100\"\r\n                                style={{ height: `${resonanceIntensity * 100}%` }}\r\n                            ></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className=\"lg:col-span-5 flex flex-col gap-6\">\r\n                    <div className=\"bg-[#1e293b] rounded-2xl p-6 border border-slate-700 shadow-lg\">\r\n                        <h2 className=\"text-xl font-bold text-cyan-400 mb-6 flex items-center gap-2\">\r\n                            <Settings size={20} /> Thiết lập thí nghiệm\r\n                        </h2>\r\n\r\n                        {/* Frequency Slider */}\r\n                        <div className=\"mb-6\">\r\n                            <div className=\"flex justify-between items-center mb-2\">\r\n                                <span className=\"text-slate-400 text-sm\">Tần số âm thoa (f)</span>\r\n                                <button \r\n                                    onClick={() => setIsMuted(!isMuted)}\r\n                                    className={`p-2 rounded-full transition-colors flex items-center gap-2 text-xs font-bold ${!isMuted ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/50' : 'bg-slate-800 text-slate-400 border border-slate-700'}`}\r\n                                >\r\n                                    {!isMuted ? <Volume2 size={16} /> : <Volume2 size={16} className=\"opacity-50\" />}\r\n                                    {!isMuted ? \"ON\" : \"OFF\"}\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm mb-2\">\r\n                                <span className=\"text-cyan-400 font-mono\">{frequency} Hz</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\" min=\"200\" max=\"1000\" step=\"10\"\r\n                                value={frequency}\r\n                                onChange={(e) => setFrequency(Number(e.target.value))}\r\n                                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer\"\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Length Slider */}\r\n                        <div className=\"mb-6\">\r\n                            <div className=\"flex justify-between text-sm mb-2\">\r\n                                <span className=\"text-slate-400\">Chiều dài cột khí (L)</span>\r\n                                <span className=\"text-cyan-400 font-mono\">{(airLength * 100).toFixed(1)} cm</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\" min=\"0.1\" max=\"1.0\" step=\"0.001\"\r\n                                value={airLength}\r\n                                onChange={(e) => setAirLength(Number(e.target.value))}\r\n                                className=\"w-full accent-cyan-500 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer\"\r\n                            />\r\n                            <div className=\"text-xs text-slate-500 mt-1 flex justify-between\">\r\n                                <button className=\"text-cyan-600 hover:text-cyan-400\" onClick={() => setAirLength(Math.max(0.1, airLength - 0.005))}>- Fine</button>\r\n                                <button className=\"text-cyan-600 hover:text-cyan-400\" onClick={() => setAirLength(Math.min(1.0, airLength + 0.005))}>+ Fine</button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Readout */}\r\n                        <div className=\"bg-slate-900/50 p-4 rounded-lg border border-slate-800 space-y-2\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-400\">Tốc độ âm (lý thuyết):</span>\r\n                                <span className=\"text-emerald-400 font-mono\">{speedOfSound.toFixed(1)} m/s</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-slate-400\">Bước sóng (λ):</span>\r\n                                <span className=\"text-pink-400 font-mono\">{wavelength.toFixed(3)} m</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm font-bold pt-2 border-t border-slate-800\">\r\n                                <span className=\"text-slate-300\">Cộng hưởng?</span>\r\n                                <span className={resonanceIntensity > 0.8 ? \"text-green-400 animate-pulse\" : \"text-slate-600\"}>\r\n                                    {resonanceIntensity > 0.8 ? \"MAX (Nghe to nhất)\" : \"---\"}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Guide */}\r\n                    <div className=\"bg-[#1e293b] rounded-2xl p-6 border border-slate-700 shadow-lg flex-grow\">\r\n                        <h3 className=\"text-lg font-bold text-yellow-400 mb-4 flex items-center gap-2\">\r\n                            <Info size={18} /> Hướng dẫn\r\n                        </h3>\r\n                        <ul className=\"text-sm text-slate-300 space-y-2 list-disc pl-4\">\r\n                            <li>Điều chỉnh độ cao cột khí (mực nước) bằng thanh trượt L.</li>\r\n                            <li>Lắng nghe hoặc quan sát thanh đo cường độ âm.</li>\r\n                            <li>Khi cột khí có độ dài thích hợp ($L = (2k+1)\\lambda/4$), hiện tượng <strong>cộng hưởng</strong> xảy ra, âm thanh sẽ nghe to nhất.</li>\r\n                            <li>Sử dụng các giá trị L cộng hưởng liên tiếp để tính bước sóng và tốc độ âm.</li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n\r\n            </main>\r\n        </div>\r\n    );\r\n};\r\nexport default SoundSpeedExperiment;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11537, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/hand-gesture/hand-tracker.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\"\r\nimport { HandLandmarker, FilesetResolver } from \"@mediapipe/tasks-vision\"\r\nimport { Loader2, Camera, CameraOff } from \"lucide-react\"\r\n\r\nexport interface HandData {\r\n    landmarks: any[] // Normalized landmarks\r\n    worldLandmarks: any[]\r\n    handedness: any[]\r\n    gesture: \"IDLE\" | \"PINCH\" | \"OPEN\"\r\n    cursor: { x: number, y: number } // Normalized 0-1\r\n}\r\n\r\ninterface HandTrackerProps {\r\n    onHandUpdate: (data: HandData | null) => void\r\n    showCamera?: boolean\r\n}\r\n\r\nexport default function HandTracker({ onHandUpdate, showCamera = true }: HandTrackerProps) {\r\n    const videoRef = useRef<HTMLVideoElement>(null)\r\n    const [isLoaded, setIsLoaded] = useState(false)\r\n    const [cameraError, setCameraError] = useState<string | null>(null)\r\n    const handLandmarkerRef = useRef<HandLandmarker | null>(null)\r\n    const requestRef = useRef<number>()\r\n\r\n    useEffect(() => {\r\n        let mounted = true\r\n\r\n        const init = async () => {\r\n            try {\r\n                const vision = await FilesetResolver.forVisionTasks(\r\n                    \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm\"\r\n                )\r\n\r\n                if (!mounted) return\r\n\r\n                const handLandmarker = await HandLandmarker.createFromOptions(vision, {\r\n                    baseOptions: {\r\n                        modelAssetPath: `https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task`,\r\n                        delegate: \"GPU\"\r\n                    },\r\n                    runningMode: \"VIDEO\",\r\n                    numHands: 1\r\n                })\r\n\r\n                if (!mounted) return\r\n                handLandmarkerRef.current = handLandmarker\r\n                setIsLoaded(true)\r\n                startCamera()\r\n            } catch (err: any) {\r\n                console.error(err)\r\n                setCameraError(\"Failed to load AI model: \" + err.message)\r\n            }\r\n        }\r\n\r\n        init()\r\n\r\n        return () => {\r\n            mounted = false\r\n            if (handLandmarkerRef.current) {\r\n                handLandmarkerRef.current.close()\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const startCamera = async () => {\r\n        if (!videoRef.current) return\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: {\r\n                    width: 640,\r\n                    height: 480\r\n                }\r\n            })\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream\r\n                videoRef.current.addEventListener(\"loadeddata\", predictWebcam)\r\n            }\r\n        } catch (err: any) {\r\n            setCameraError(\"Camera access denied or unavailable.\")\r\n        }\r\n    }\r\n\r\n    const predictWebcam = () => {\r\n        if (!handLandmarkerRef.current || !videoRef.current) return\r\n\r\n        const nowInMs = Date.now()\r\n        const result = handLandmarkerRef.current.detectForVideo(videoRef.current, nowInMs)\r\n\r\n        if (result.landmarks && result.landmarks.length > 0) {\r\n            const landmarks = result.landmarks[0]\r\n            // Detect Pinch\r\n            // Thumb tip: 4, Index tip: 8\r\n            const thumb = landmarks[4]\r\n            const index = landmarks[8]\r\n            const dist = Math.sqrt(\r\n                Math.pow(thumb.x - index.x, 2) +\r\n                Math.pow(thumb.y - index.y, 2)\r\n            )\r\n\r\n            const isPinch = dist < 0.05\r\n\r\n            // Cursor is midpoint of pinch or index tip\r\n            const cursorX = isPinch ? (thumb.x + index.x) / 2 : index.x\r\n            const cursorY = isPinch ? (thumb.y + index.y) / 2 : index.y\r\n\r\n            // Mirror X because webcam is mirrored\r\n            const mirroredCursorX = 1 - cursorX\r\n\r\n            onHandUpdate({\r\n                landmarks,\r\n                worldLandmarks: result.worldLandmarks[0],\r\n                handedness: result.handedness[0],\r\n                gesture: isPinch ? \"PINCH\" : \"OPEN\",\r\n                cursor: { x: mirroredCursorX, y: cursorY }\r\n            })\r\n        } else {\r\n            onHandUpdate(null)\r\n        }\r\n\r\n        requestRef.current = requestAnimationFrame(predictWebcam)\r\n    }\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            if (requestRef.current) cancelAnimationFrame(requestRef.current)\r\n        }\r\n    }, [])\r\n\r\n    return (\r\n        <div className=\"relative rounded-xl overflow-hidden bg-black border border-slate-800 w-[320px] shadow-lg\">\r\n            <div className=\"absolute top-2 left-2 z-10 flex items-center gap-2\">\r\n                {isLoaded ? <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" /> : <Loader2 className=\"animate-spin text-cyan-500\" size={16} />}\r\n                <span className=\"text-[10px] text-white font-mono uppercase tracking-widest\">\r\n                    {isLoaded ? \"Tracking Active\" : \"Initializing AI...\"}\r\n                </span>\r\n            </div>\r\n\r\n            {cameraError && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-red-900/80 p-4 text-center\">\r\n                    <p className=\"text-white text-xs\">{cameraError}</p>\r\n                </div>\r\n            )}\r\n\r\n            <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                playsInline\r\n                muted\r\n                className={`w-full h-auto transform -scale-x-100 ${!showCamera ? 'opacity-0' : ''}`} // Mirror output\r\n            />\r\n\r\n            {!showCamera && (\r\n                <div className=\"absolute inset-0 flex items-center justify-center bg-slate-900\">\r\n                    <CameraOff className=\"text-slate-600\" />\r\n                    <p className=\"text-xs text-slate-500 mt-2\">Camera hidden</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11756, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/hand-spring-oscillator.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useRef, useEffect, useState, useCallback } from \"react\"\r\nimport { useSpringPhysics } from \"@/hooks/use-spring-physics\"\r\nimport { useCanvasScale } from \"@/hooks/use-canvas-scale\"\r\nimport { drawSpring, drawArrow } from \"@/lib/canvas-utils\"\r\nimport HandTracker, { HandData } from \"../hand-gesture/hand-tracker\"\r\nimport { Play, Pause, RotateCcw, Hand, Camera } from \"lucide-react\"\r\n\r\nexport default function HandSpringOscillator() {\r\n    const containerRef = useRef<HTMLDivElement>(null)\r\n    const canvasRef = useRef<HTMLCanvasElement>(null)\r\n\r\n    // Physics System\r\n    const sys = useSpringPhysics({ mass: 0.5, k: 50, amplitude: 50, phase: 0 })\r\n    const animationRef = useRef<number>()\r\n\r\n    // Hand State\r\n    const [handData, setHandData] = useState<HandData | null>(null)\r\n    const [isHandDragging, setIsHandDragging] = useState(false)\r\n    const [dragOffset, setDragOffset] = useState(0)\r\n\r\n    // Canvas Scale\r\n    const { width, height, pixelRatio } = useCanvasScale(containerRef)\r\n\r\n    // Hand Update Handler\r\n    const handleHandUpdate = useCallback((data: HandData | null) => {\r\n        setHandData(data)\r\n    }, [])\r\n\r\n    // Animation Loop\r\n    const loop = useCallback(() => {\r\n        if (sys.isPlaying && !isHandDragging) {\r\n            sys.step(0.016)\r\n        }\r\n    }, [sys, isHandDragging])\r\n\r\n    // Ref-based loop for stability\r\n    const renderRef = useRef(loop)\r\n    useEffect(() => { renderRef.current = loop }, [loop])\r\n\r\n    useEffect(() => {\r\n        const animate = () => {\r\n            renderRef.current()\r\n            animationRef.current = requestAnimationFrame(animate)\r\n        }\r\n        animationRef.current = requestAnimationFrame(animate)\r\n        return () => {\r\n            if (animationRef.current) cancelAnimationFrame(animationRef.current)\r\n        }\r\n    }, [])\r\n\r\n    // Interaction Logic (Effect based on Hand Data)\r\n    const { setIsPlaying, setParams, reset, calculateState, timeRef } = sys\r\n\r\n    useEffect(() => {\r\n        if (!handData || !width || !height) return\r\n\r\n        // Map Cursor (0-1) to Canvas (px)\r\n        const cursorX = handData.cursor.x * width\r\n        const cursorY = handData.cursor.y * height\r\n\r\n        // Calculate Mass Position\r\n        const centerY = height / 2\r\n        const centerX = width / 2\r\n\r\n        // Check hit test\r\n        // Use instantaneous position from physics\r\n        const currentPhysicsX = calculateState(timeRef.current).x\r\n\r\n        // Mass visual center\r\n        const massVisualY = centerY + (isHandDragging ? dragOffset : currentPhysicsX)\r\n        const massVisualX = centerX\r\n\r\n        const dist = Math.sqrt(Math.pow(cursorX - massVisualX, 2) + Math.pow(cursorY - massVisualY, 2))\r\n        const isHover = dist < 60 // 60px radius forgiveness\r\n\r\n        // Avoid state updates if nothing changed\r\n        if (handData.gesture === \"PINCH\") {\r\n            if (isHover && !isHandDragging) {\r\n                // Start Drag\r\n                setIsHandDragging(true)\r\n                setIsPlaying(false)\r\n            }\r\n\r\n            if (isHandDragging) {\r\n                // Continue Drag\r\n                let newDisplacement = cursorY - centerY\r\n                const maxAmp = height / 2 - 50\r\n                if (Math.abs(newDisplacement) > maxAmp) {\r\n                    newDisplacement = Math.sign(newDisplacement) * maxAmp\r\n                }\r\n                if (Math.abs(newDisplacement - dragOffset) > 0.5) {\r\n                    setDragOffset(newDisplacement)\r\n                }\r\n            }\r\n        } else {\r\n            // Gesture OPEN\r\n            if (isHandDragging) {\r\n                // Release\r\n                setIsHandDragging(false)\r\n                setParams(p => ({ ...p, amplitude: Math.abs(dragOffset), phase: dragOffset >= 0 ? 0 : Math.PI }))\r\n                reset()\r\n                setIsPlaying(true)\r\n            }\r\n        }\r\n\r\n    }, [handData, width, height, isHandDragging, dragOffset, setIsPlaying, setParams, reset, calculateState, timeRef])\r\n\r\n    // Drawing\r\n    const draw = useCallback((ctx: CanvasRenderingContext2D) => {\r\n        ctx.clearRect(0, 0, width, height)\r\n\r\n        const centerX = width / 2\r\n        const centerY = height / 2\r\n        const ceilingY = 50\r\n\r\n        // Get current state\r\n        const state = sys.calculateState(sys.timeRef.current)\r\n        const displacement = isHandDragging ? dragOffset : state.x\r\n        const massY = centerY + displacement\r\n\r\n        // Draw Ceiling\r\n        ctx.fillStyle = \"#64748b\"; ctx.fillRect(centerX - 50, ceilingY - 10, 100, 10)\r\n\r\n        // Draw Spring\r\n        ctx.strokeStyle = \"#cbd5e1\"\r\n        drawSpring(ctx, centerX, ceilingY, centerX, massY - 30, 15, 20)\r\n\r\n        // Draw Mass\r\n        ctx.fillStyle = isHandDragging ? \"#f97316\" : \"#3b82f6\"\r\n        ctx.beginPath()\r\n        ctx.arc(centerX, massY, 30, 0, Math.PI * 2)\r\n        ctx.fill()\r\n        ctx.strokeStyle = \"#fff\"\r\n        ctx.lineWidth = 2\r\n        ctx.stroke()\r\n\r\n        // Equilibrium Line\r\n        ctx.strokeStyle = \"rgba(74, 222, 128, 0.5)\"\r\n        ctx.setLineDash([5, 5])\r\n        ctx.beginPath(); ctx.moveTo(0, centerY); ctx.lineTo(width, centerY); ctx.stroke(); ctx.setLineDash([])\r\n\r\n        // Real-time Data Overlay (On Canvas for Performance)\r\n        const panelX = 20\r\n        const panelY = height - 140\r\n        const panelW = 200\r\n        const panelH = 120\r\n\r\n        ctx.fillStyle = \"rgba(15, 23, 42, 0.8)\"; ctx.fillRect(panelX, panelY, panelW, panelH)\r\n        ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"; ctx.strokeRect(panelX, panelY, panelW, panelH)\r\n\r\n        ctx.font = \"12px monospace\"\r\n        ctx.textBaseline = \"top\"\r\n\r\n        const lineHeight = 18\r\n        let textY = panelY + 10\r\n        const textX = panelX + 10\r\n\r\n        ctx.fillStyle = \"#fbbf24\"; ctx.fillText(`x: ${displacement.toFixed(2)} cm`, textX, textY); textY += lineHeight\r\n        ctx.fillStyle = \"#22c55e\"; ctx.fillText(`v: ${state.v.toFixed(2)} cm/s`, textX, textY); textY += lineHeight\r\n        ctx.fillStyle = \"#ef4444\"; ctx.fillText(`a: ${state.a.toFixed(2)} cm/s²`, textX, textY); textY += lineHeight\r\n        // Energy\r\n        textY += 5\r\n        ctx.fillStyle = \"#eab308\"; ctx.fillText(`Wđ: ${state.wd.toFixed(4)} J`, textX, textY); textY += lineHeight\r\n        ctx.fillStyle = \"#3b82f6\"; ctx.fillText(`Wt: ${state.wt.toFixed(4)} J`, textX, textY); textY += lineHeight\r\n        ctx.fillStyle = \"white\"; ctx.fillText(`Cơ: ${state.wTotal.toFixed(4)} J`, textX, textY)\r\n\r\n\r\n        // Info\r\n        ctx.fillStyle = \"white\"\r\n        ctx.font = \"14px monospace\"\r\n        ctx.fillText(`Biên độ: ${sys.params.amplitude.toFixed(1)} cm`, 20, 30)\r\n        if (isHandDragging) {\r\n            ctx.fillStyle = \"#f97316\"\r\n            ctx.fillText(`Kéo thả để thả vật!`, 20, 50)\r\n        }\r\n\r\n        // Draw Hand Cursor\r\n        if (handData) {\r\n            const cursorX = handData.cursor.x * width\r\n            const cursorY = handData.cursor.y * height\r\n\r\n            ctx.beginPath()\r\n            ctx.arc(cursorX, cursorY, 10, 0, Math.PI * 2)\r\n            ctx.fillStyle = handData.gesture === \"PINCH\" ? \"rgba(249, 115, 22, 0.8)\" : \"rgba(34, 197, 94, 0.8)\"\r\n            ctx.fill()\r\n            ctx.strokeStyle = \"white\"\r\n            ctx.lineWidth = 2\r\n            ctx.stroke()\r\n\r\n            // Draw skeleton for fun (thumb to index)\r\n            const thumb = handData.landmarks[4]\r\n            const index = handData.landmarks[8]\r\n            // Mapping needed purely for visual? handData.landmarks are 0-1 (but x is not mirrored in normalized raw, cursor is)\r\n            // Let's stick to cursor.\r\n        }\r\n\r\n    }, [width, height, sys.timeRef.current, isHandDragging, dragOffset, handData, sys.params])\r\n\r\n    // Canvas Render Loop (separate from physics loop to sync with React render if needed or independent)\r\n    // Actually we should put draw inside a requestAnimationFrame loop that matches the physics loop frequency or VSync.\r\n    // We already have `loop` which updates physics.\r\n    // Let's rely on a separate draw loop or the same one.\r\n\r\n    // Resize Canvas\r\n    useEffect(() => {\r\n        if (canvasRef.current && width > 0 && height > 0) {\r\n            canvasRef.current.width = width * pixelRatio\r\n            canvasRef.current.height = height * pixelRatio\r\n        }\r\n    }, [width, height, pixelRatio])\r\n\r\n    useEffect(() => {\r\n        if (!canvasRef.current || width === 0) return\r\n        const ctx = canvasRef.current.getContext(\"2d\")\r\n        if (!ctx) return\r\n\r\n        const render = () => {\r\n            ctx.save()\r\n            ctx.scale(pixelRatio, pixelRatio)\r\n            draw(ctx)\r\n            ctx.restore()\r\n            requestAnimationFrame(render)\r\n        }\r\n        const id = requestAnimationFrame(render)\r\n        return () => cancelAnimationFrame(id)\r\n    }, [draw, width, height, pixelRatio])\r\n\r\n    return (\r\n        <div className=\"flex flex-col md:flex-row gap-4 h-full\">\r\n\r\n            {/* LEFT: Hand Tracker & Controls */}\r\n            <div className=\"w-full md:w-[340px] flex flex-col gap-4\">\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700\">\r\n                    <h3 className=\"text-cyan-400 font-bold mb-3 flex items-center gap-2\">\r\n                        <Camera size={20} /> Camera Control\r\n                    </h3>\r\n                    <HandTracker onHandUpdate={handleHandUpdate} />\r\n                    <p className=\"text-xs text-slate-400 mt-2\">\r\n                        Đưa tay lên camera. <br />\r\n                        👉 <span className=\"text-white font-bold\">Chụm ngón cái và trỏ</span> để nắm vật.<br />\r\n                        👉 <span className=\"text-white font-bold\">Mở tay</span> để thả vật.\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700 flex gap-2 justify-center\">\r\n                    <button onClick={() => sys.setIsPlaying(!sys.isPlaying)} className=\"p-3 bg-slate-800 rounded-full hover:bg-slate-700 text-white\">\r\n                        {sys.isPlaying ? <Pause /> : <Play />}\r\n                    </button>\r\n                    <button onClick={() => sys.reset()} className=\"p-3 bg-slate-800 rounded-full hover:bg-slate-700 text-white\">\r\n                        <RotateCcw />\r\n                    </button>\r\n                </div>\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700\">\r\n                    <h3 className=\"text-cyan-400 font-bold mb-3\">Thông số hệ thống</h3>\r\n                    <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                        <div className=\"bg-slate-800 p-2 rounded\">\r\n                            <div className=\"text-slate-400 text-xs\">Khối lượng</div>\r\n                            <div className=\"text-white font-mono\">{sys.params.mass} kg</div>\r\n                        </div>\r\n                        <div className=\"bg-slate-800 p-2 rounded\">\r\n                            <div className=\"text-slate-400 text-xs\">Độ cứng</div>\r\n                            <div className=\"text-white font-mono\">{sys.params.k} N/m</div>\r\n                        </div>\r\n                        <div className=\"bg-slate-800 p-2 rounded\">\r\n                            <div className=\"text-slate-400 text-xs\">Chu kỳ (T)</div>\r\n                            <div className=\"text-white font-mono\">{sys.derived.period.toFixed(2)} s</div>\r\n                        </div>\r\n                        <div className=\"bg-slate-800 p-2 rounded\">\r\n                            <div className=\"text-slate-400 text-xs\">Tần số (f)</div>\r\n                            <div className=\"text-white font-mono\">{sys.derived.frequency.toFixed(2)} Hz</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT: Experiment View */}\r\n            <div\r\n                ref={containerRef}\r\n                className=\"flex-1 bg-[#1e293b] rounded-xl relative overflow-hidden border border-slate-700 shadow-inner\"\r\n            >\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    className=\"w-full h-full block\"\r\n                    style={{ width: '100%', height: '100%' }}\r\n                />\r\n                {/* Helper Overlay */}\r\n                <div className=\"absolute top-4 right-4 bg-black/40 backdrop-blur px-3 py-2 rounded border border-white/10 text-right pointer-events-none\">\r\n                    <div className=\"text-2xl font-bold text-white font-mono\">{handData?.gesture || \"NO HAND\"}</div>\r\n                    <div className=\"text-xs text-slate-300\">Gesture Status</div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12384, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/hooks/use-simple-pendulum-physics.ts"],"sourcesContent":["import React, { useState, useRef, useCallback, useMemo } from \"react\"\r\n\r\nexport interface PendulumParams {\r\n    length: number      // cm\r\n    gravity: number     // m/s²\r\n    initialAngle: number // degrees\r\n    mass: number         // kg\r\n}\r\n\r\nexport interface PendulumState {\r\n    t: number\r\n    theta: number // radians (angle from vertical)\r\n    x: number     // cm (horizontal displacement approx)\r\n    v: number     // cm/s (tangential velocity)\r\n    a: number     // cm/s² (tangential acceleration)\r\n    wd: number    // Joules (Kinetic)\r\n    wt: number    // Joules (Potential)\r\n    wTotal: number // Joules (Total)\r\n}\r\n\r\nexport const useSimplePendulumPhysics = (initialParams: PendulumParams) => {\r\n    const [isPlaying, setIsPlaying] = useState(false)\r\n    const [params, setParams] = useState(initialParams)\r\n    const [time, setTime] = useState(0)\r\n\r\n    const timeRef = useRef(0)\r\n    const historyRef = useRef<PendulumState[]>([])\r\n\r\n    // Derived Constants\r\n    const lengthM = params.length / 100\r\n    const omega = Math.sqrt(params.gravity / lengthM)\r\n    const period = (2 * Math.PI) / omega\r\n    const frequency = 1 / period\r\n\r\n    // Note: initialAngle here acts as the Amplitude (ThetaMax)\r\n    // In SHM approximation: theta = thetaMax * cos(omega * t + phi)\r\n    // We assume release from max angle at t=0, so phi=0.\r\n    const thetaMax = (params.initialAngle * Math.PI) / 180\r\n\r\n    const calculateState = useCallback(\r\n        (t: number): PendulumState => {\r\n            // SHM Approximation for small angles, but commonly used in HS physics for \"Simple Pendulum\" structure\r\n            const theta = thetaMax * Math.cos(omega * t)\r\n            const x = params.length * Math.sin(theta)\r\n\r\n            // Energy & Velocity (Conservation approach for consistency)\r\n            const h_current = lengthM * (1 - Math.cos(theta))\r\n            const h_max = lengthM * (1 - Math.cos(thetaMax))\r\n\r\n            // v = sqrt(2g(h_max - h_current))\r\n            // Direction based on SHM derivative: -sin(omega*t)\r\n            // If thetaMax > 0 (Right), v starts negative (Left).\r\n            // If thetaMax < 0 (Left), v starts positive (Right).\r\n            const v_mag = Math.sqrt(2 * params.gravity * Math.max(0, h_max - h_current))\r\n            let sign = -Math.sin(omega * t) >= 0 ? 1 : -1\r\n            if (thetaMax < 0) sign *= -1\r\n\r\n            const v = sign * v_mag * 100 // cm/s\r\n\r\n            // Acceleration (Tangential) = -g * sin(theta)\r\n            // or approx -omega^2 * s\r\n            const a = -params.gravity * Math.sin(theta) * 100 // cm/s²\r\n\r\n            // Energies\r\n            const wt = params.mass * params.gravity * h_current\r\n            const wTotal = params.mass * params.gravity * h_max\r\n            const wd = Math.max(0, wTotal - wt)\r\n\r\n            return { t, theta, x, v, a, wt, wd, wTotal }\r\n        },\r\n        [thetaMax, omega, params.length, params.gravity, params.mass, lengthM]\r\n    )\r\n\r\n    const step = useCallback((dt: number) => {\r\n        timeRef.current += dt\r\n        if (timeRef.current < 0) timeRef.current = 0\r\n        const state = calculateState(timeRef.current)\r\n\r\n        // Sync minimal state\r\n        setTime(timeRef.current)\r\n\r\n        return state\r\n    }, [calculateState])\r\n\r\n    const reset = useCallback(() => {\r\n        setIsPlaying(false)\r\n        timeRef.current = 0\r\n        setTime(0)\r\n        historyRef.current = []\r\n    }, [])\r\n\r\n    return useMemo(() => ({\r\n        params,\r\n        setParams,\r\n        isPlaying,\r\n        setIsPlaying,\r\n        time,\r\n        timeRef,\r\n        calculateState,\r\n        step,\r\n        reset,\r\n        derived: {\r\n            omega,\r\n            period,\r\n            frequency,\r\n            lengthM\r\n        }\r\n    }), [params, isPlaying, time, calculateState, step, reset, omega, period, frequency, lengthM])\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAoBO,MAAM,2BAA2B,CAAC;;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IAEjC,MAAM,UAAU,IAAA,uKAAM,EAAC;IACvB,MAAM,aAAa,IAAA,uKAAM,EAAkB,EAAE;IAE7C,oBAAoB;IACpB,MAAM,UAAU,OAAO,MAAM,GAAG;IAChC,MAAM,QAAQ,KAAK,IAAI,CAAC,OAAO,OAAO,GAAG;IACzC,MAAM,SAAS,AAAC,IAAI,KAAK,EAAE,GAAI;IAC/B,MAAM,YAAY,IAAI;IAEtB,2DAA2D;IAC3D,gEAAgE;IAChE,qDAAqD;IACrD,MAAM,WAAW,AAAC,OAAO,YAAY,GAAG,KAAK,EAAE,GAAI;IAEnD,MAAM,iBAAiB,IAAA,4KAAW;gEAC9B,CAAC;YACG,sGAAsG;YACtG,MAAM,QAAQ,WAAW,KAAK,GAAG,CAAC,QAAQ;YAC1C,MAAM,IAAI,OAAO,MAAM,GAAG,KAAK,GAAG,CAAC;YAEnC,4DAA4D;YAC5D,MAAM,YAAY,UAAU,CAAC,IAAI,KAAK,GAAG,CAAC,MAAM;YAChD,MAAM,QAAQ,UAAU,CAAC,IAAI,KAAK,GAAG,CAAC,SAAS;YAE/C,kCAAkC;YAClC,mDAAmD;YACnD,qDAAqD;YACrD,qDAAqD;YACrD,MAAM,QAAQ,KAAK,IAAI,CAAC,IAAI,OAAO,OAAO,GAAG,KAAK,GAAG,CAAC,GAAG,QAAQ;YACjE,IAAI,OAAO,CAAC,KAAK,GAAG,CAAC,QAAQ,MAAM,IAAI,IAAI,CAAC;YAC5C,IAAI,WAAW,GAAG,QAAQ,CAAC;YAE3B,MAAM,IAAI,OAAO,QAAQ,IAAI,OAAO;;YAEpC,8CAA8C;YAC9C,yBAAyB;YACzB,MAAM,IAAI,CAAC,OAAO,OAAO,GAAG,KAAK,GAAG,CAAC,SAAS,IAAI,QAAQ;;YAE1D,WAAW;YACX,MAAM,KAAK,OAAO,IAAI,GAAG,OAAO,OAAO,GAAG;YAC1C,MAAM,SAAS,OAAO,IAAI,GAAG,OAAO,OAAO,GAAG;YAC9C,MAAM,KAAK,KAAK,GAAG,CAAC,GAAG,SAAS;YAEhC,OAAO;gBAAE;gBAAG;gBAAO;gBAAG;gBAAG;gBAAG;gBAAI;gBAAI;YAAO;QAC/C;+DACA;QAAC;QAAU;QAAO,OAAO,MAAM;QAAE,OAAO,OAAO;QAAE,OAAO,IAAI;QAAE;KAAQ;IAG1E,MAAM,OAAO,IAAA,4KAAW;sDAAC,CAAC;YACtB,QAAQ,OAAO,IAAI;YACnB,IAAI,QAAQ,OAAO,GAAG,GAAG,QAAQ,OAAO,GAAG;YAC3C,MAAM,QAAQ,eAAe,QAAQ,OAAO;YAE5C,qBAAqB;YACrB,QAAQ,QAAQ,OAAO;YAEvB,OAAO;QACX;qDAAG;QAAC;KAAe;IAEnB,MAAM,QAAQ,IAAA,4KAAW;uDAAC;YACtB,aAAa;YACb,QAAQ,OAAO,GAAG;YAClB,QAAQ;YACR,WAAW,OAAO,GAAG,EAAE;QAC3B;sDAAG,EAAE;IAEL,OAAO,IAAA,wKAAO;4CAAC,IAAM,CAAC;gBAClB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA,SAAS;oBACL;oBACA;oBACA;oBACA;gBACJ;YACJ,CAAC;2CAAG;QAAC;QAAQ;QAAW;QAAM;QAAgB;QAAM;QAAO;QAAO;QAAQ;QAAW;KAAQ;AACjG;GAxFa"}},
    {"offset": {"line": 12510, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/hand-simple-pendulum.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useRef, useEffect, useState, useCallback } from \"react\"\r\nimport { useSimplePendulumPhysics } from \"@/hooks/use-simple-pendulum-physics\"\r\nimport { useCanvasScale } from \"@/hooks/use-canvas-scale\"\r\nimport HandTracker, { HandData } from \"../hand-gesture/hand-tracker\"\r\nimport { Play, Pause, RotateCcw, Camera } from \"lucide-react\"\r\n\r\nexport default function HandSimplePendulum() {\r\n    const containerRef = useRef<HTMLDivElement>(null)\r\n    const canvasRef = useRef<HTMLCanvasElement>(null)\r\n\r\n    // Physics\r\n    const sys = useSimplePendulumPhysics({\r\n        length: 120,\r\n        gravity: 9.8,\r\n        initialAngle: 30,\r\n        mass: 1.0\r\n    })\r\n\r\n    const { setIsPlaying, setParams, reset, calculateState, timeRef } = sys\r\n    const animationRef = useRef<number>()\r\n\r\n    const [dragLength, setDragLength] = useState(120) // cm\r\n\r\n    // Hand State\r\n    const [handData, setHandData] = useState<HandData | null>(null)\r\n    const [isHandDragging, setIsHandDragging] = useState(false)\r\n    const [dragAngle, setDragAngle] = useState(0) // radians\r\n\r\n    // Canvas Scale\r\n    const { width, height, pixelRatio } = useCanvasScale(containerRef)\r\n\r\n    // Hand Update Handler\r\n    const handleHandUpdate = useCallback((data: HandData | null) => {\r\n        setHandData(data)\r\n    }, [])\r\n\r\n    // Physics Loop\r\n    const loop = useCallback(() => {\r\n        if (sys.isPlaying && !isHandDragging) {\r\n            sys.step(0.016)\r\n        }\r\n    }, [sys, isHandDragging])\r\n\r\n    const renderRef = useRef(loop)\r\n    useEffect(() => { renderRef.current = loop }, [loop])\r\n\r\n    useEffect(() => {\r\n        const animate = () => {\r\n            renderRef.current()\r\n            animationRef.current = requestAnimationFrame(animate)\r\n        }\r\n        animationRef.current = requestAnimationFrame(animate)\r\n        return () => { if (animationRef.current) cancelAnimationFrame(animationRef.current) }\r\n    }, [])\r\n\r\n    // Interaction Logic\r\n    useEffect(() => {\r\n        if (!handData || !width || !height) return\r\n\r\n        const cursorX = handData.cursor.x * width\r\n        const cursorY = handData.cursor.y * height\r\n\r\n        const pivotX = width / 2\r\n        const pivotY = 50\r\n\r\n        // Current Bob Position (Visual)\r\n        // If system is playing, use system state. If dragging, use drag state.\r\n        // We need system state for initial hit test.\r\n        const state = sys.calculateState(sys.time)\r\n        const currentParams = sys.params // Use params directly from system\r\n        const currentAngle = isHandDragging ? dragAngle : state.theta\r\n        const currentLength = isHandDragging ? dragLength : currentParams.length\r\n\r\n        const bobX = pivotX + currentLength * Math.sin(currentAngle)\r\n        const bobY = pivotY + currentLength * Math.cos(currentAngle)\r\n\r\n        const dist = Math.sqrt(Math.pow(cursorX - bobX, 2) + Math.pow(cursorY - bobY, 2))\r\n        const isHover = dist < 60\r\n\r\n        if (handData.gesture === \"PINCH\") {\r\n            if (isHover && !isHandDragging) {\r\n                // Start Drag\r\n                setIsHandDragging(true)\r\n                sys.setIsPlaying(false)\r\n                // Initialize drag state from current physics state\r\n                setDragAngle(state.theta)\r\n                setDragLength(currentParams.length)\r\n            }\r\n\r\n            if (isHandDragging) {\r\n                // Dragging Logic\r\n                const dx = cursorX - pivotX\r\n                const dy = cursorY - pivotY\r\n\r\n                // 1. Calculate Angle\r\n                let newAngle = Math.atan2(dx, dy)\r\n                const MAX_ANGLE = 60 * Math.PI / 180\r\n                newAngle = Math.min(Math.max(newAngle, -MAX_ANGLE), MAX_ANGLE)\r\n\r\n                // 2. Calculate Length\r\n                let newLength = Math.sqrt(dx * dx + dy * dy)\r\n                // Limit Length (e.g., 50cm to 250cm)\r\n                newLength = Math.min(Math.max(newLength, 50), 250)\r\n\r\n                if (Math.abs(newAngle - dragAngle) > 0.01) setDragAngle(newAngle)\r\n                if (Math.abs(newLength - dragLength) > 1) setDragLength(newLength)\r\n            }\r\n        } else {\r\n            // OPEN (Release)\r\n            if (isHandDragging) {\r\n                setIsHandDragging(false)\r\n                // Release at this angle and length\r\n                // Use signed angle directly\r\n                const signedAngleDeg = dragAngle * 180 / Math.PI\r\n\r\n                sys.setParams(p => ({\r\n                    ...p,\r\n                    initialAngle: signedAngleDeg, // Signed!\r\n                    length: dragLength\r\n                }))\r\n                sys.reset()\r\n                sys.setIsPlaying(true)\r\n            }\r\n        }\r\n\r\n    }, [handData, width, height, isHandDragging, dragAngle, dragLength, sys])\r\n\r\n    // Drawing\r\n    const draw = useCallback((ctx: CanvasRenderingContext2D) => {\r\n        ctx.clearRect(0, 0, width, height)\r\n\r\n        const pivotX = width / 2\r\n        const pivotY = 50\r\n\r\n        const state = sys.calculateState(sys.time)\r\n        const angle = isHandDragging ? dragAngle : state.theta\r\n        const length = isHandDragging ? dragLength : sys.params.length\r\n\r\n        const bobX = pivotX + length * Math.sin(angle)\r\n        const bobY = pivotY + length * Math.cos(angle)\r\n\r\n        // Support\r\n        ctx.fillStyle = \"#64748b\"; ctx.fillRect(pivotX - 40, pivotY - 10, 80, 10)\r\n\r\n        // Dashed Vertical\r\n        ctx.strokeStyle = \"#475569\"; ctx.setLineDash([5, 5]); ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(pivotX, pivotY + 250); ctx.stroke(); ctx.setLineDash([])\r\n\r\n        // String\r\n        ctx.strokeStyle = \"#cbd5e1\"; ctx.lineWidth = 2\r\n        ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(bobX, bobY); ctx.stroke()\r\n\r\n        // Bob\r\n        ctx.fillStyle = isHandDragging ? \"#f97316\" : \"#fb923c\"\r\n        ctx.beginPath(); ctx.arc(bobX, bobY, 20, 0, Math.PI * 2); ctx.fill()\r\n        ctx.strokeStyle = \"white\"; ctx.lineWidth = 2; ctx.stroke()\r\n\r\n        // Angle Arc visualization\r\n        if (Math.abs(angle) > 0.1) {\r\n            ctx.beginPath()\r\n            ctx.strokeStyle = \"rgba(250, 204, 21, 0.5)\"\r\n            ctx.lineWidth = 1\r\n            // Draw arc from vertical to string\r\n            // Start angle: PI/2 (Standard canvas 0 is Right). No.\r\n            // Canvas arc 0 is right (3 o'clock). 90 is down (6 o'clock).\r\n            // Vertical is 90 deg = PI/2.\r\n            // Bob angle is PI/2 - angle? Or PI/2 + angle (if dx positive).\r\n            // atan2(dx, dy) returns angle from Y axis.\r\n            // Correct draw arc:\r\n            const startA = Math.PI / 2\r\n            const endA = Math.PI / 2 - angle // wait, Canvas Y is down.\r\n            // If angle is positive (right), bob is at right.\r\n            // x = sin(a), y = cos(a).\r\n            // vector angle is atan2(y, x). \r\n            // We can just draw line, but for arc:\r\n            ctx.arc(pivotX, pivotY, 40, Math.PI / 2, Math.PI / 2 - angle, angle > 0)\r\n            // Angle direction is tricky. simpler to just ignore arc if confusing or debug later.\r\n            // Let's print Angle text instead.\r\n        }\r\n\r\n        // Stats Panel\r\n        const panelX = 20\r\n        const panelY = height - 160\r\n        const panelW = 200\r\n        const panelH = 140\r\n\r\n        ctx.fillStyle = \"rgba(15, 23, 42, 0.8)\"; ctx.fillRect(panelX, panelY, panelW, panelH)\r\n        ctx.strokeStyle = \"rgba(56, 189, 248, 0.3)\"; ctx.strokeRect(panelX, panelY, panelW, panelH)\r\n\r\n        ctx.font = \"12px monospace\"; ctx.textBaseline = \"top\"; ctx.textAlign = \"left\"\r\n        let tY = panelY + 10; const tX = panelX + 10; const gap = 18\r\n\r\n        ctx.fillStyle = \"#e2e8f0\"; ctx.fillText(`Góc α: ${(angle * 180 / Math.PI).toFixed(1)}°`, tX, tY); tY += gap\r\n        ctx.fillStyle = \"#22d3ee\"; ctx.fillText(`Chu kỳ: ${sys.derived.period.toFixed(2)} s`, tX, tY); tY += gap\r\n        ctx.fillStyle = \"#4ade80\"; ctx.fillText(`Vận tốc: ${state.v.toFixed(1)} cm/s`, tX, tY); tY += gap\r\n        ctx.fillStyle = \"#ef4444\"; ctx.fillText(`Gia tốc: ${state.a.toFixed(1)} cm/s²`, tX, tY); tY += gap + 5\r\n        ctx.fillStyle = \"#eab308\"; ctx.fillText(`Wđ: ${state.wd.toFixed(3)} J`, tX, tY); tY += gap\r\n        ctx.fillStyle = \"#3b82f6\"; ctx.fillText(`Wt: ${state.wt.toFixed(3)} J`, tX, tY); tY += gap\r\n        ctx.fillStyle = \"white\"; ctx.fillText(`Cơ năng: ${state.wTotal.toFixed(3)} J`, tX, tY)\r\n\r\n        if (isHandDragging) {\r\n            ctx.fillStyle = \"#f97316\"\r\n            ctx.fillText(\"KÉO THẢ ĐỂ BẮT ĐẦU\", pivotX - 60, pivotY + 280)\r\n        }\r\n\r\n        // Hand Cursor\r\n        if (handData) {\r\n            const cx = handData.cursor.x * width\r\n            const cy = handData.cursor.y * height\r\n            ctx.beginPath(); ctx.arc(cx, cy, 10, 0, Math.PI * 2);\r\n            ctx.fillStyle = handData.gesture === \"PINCH\" ? \"#f97316\" : \"#22c55e\"; ctx.fill()\r\n            ctx.strokeStyle = \"white\"; ctx.stroke()\r\n        }\r\n\r\n    }, [width, height, sys.params, sys.derived, timeRef.current, isHandDragging, dragAngle, handData])\r\n\r\n    // Resize\r\n    useEffect(() => {\r\n        if (canvasRef.current && width > 0 && height > 0) {\r\n            canvasRef.current.width = width * pixelRatio\r\n            canvasRef.current.height = height * pixelRatio\r\n        }\r\n    }, [width, height, pixelRatio])\r\n\r\n    // Render loop\r\n    useEffect(() => {\r\n        if (!canvasRef.current || width === 0) return\r\n        const ctx = canvasRef.current.getContext(\"2d\")\r\n        if (!ctx) return\r\n        const render = () => {\r\n            ctx.save()\r\n            ctx.scale(pixelRatio, pixelRatio)\r\n            draw(ctx)\r\n            ctx.restore()\r\n            requestAnimationFrame(render)\r\n        }\r\n        const id = requestAnimationFrame(render)\r\n        return () => cancelAnimationFrame(id)\r\n    }, [draw, width, height, pixelRatio])\r\n\r\n    return (\r\n        <div className=\"flex flex-col md:flex-row gap-4 h-full\">\r\n            {/* Control Sidebar */}\r\n            <div className=\"w-full md:w-[340px] flex flex-col gap-4\">\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700\">\r\n                    <h3 className=\"text-cyan-400 font-bold mb-3 flex items-center gap-2\"><Camera size={20} /> Camera Control</h3>\r\n                    <HandTracker onHandUpdate={handleHandUpdate} />\r\n                </div>\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700 flex gap-2 justify-center\">\r\n                    <button onClick={() => sys.setIsPlaying(!sys.isPlaying)} className=\"p-3 bg-slate-800 rounded-full hover:bg-slate-700 text-white\">\r\n                        {sys.isPlaying ? <Pause /> : <Play />}\r\n                    </button>\r\n                    <button onClick={() => sys.reset()} className=\"p-3 bg-slate-800 rounded-full hover:bg-slate-700 text-white\">\r\n                        <RotateCcw />\r\n                    </button>\r\n                </div>\r\n                <div className=\"bg-slate-900 rounded-xl p-4 border border-slate-700 text-xs text-slate-400\">\r\n                    <p>Chiều dài dây: {sys.params.length} cm</p>\r\n                    <input type=\"range\" min=\"50\" max=\"200\" value={sys.params.length} onChange={(e) => sys.setParams(p => ({ ...p, length: Number(e.target.value) }))} className=\"w-full mt-2 accent-cyan-500 h-1 bg-slate-700 appearance-none rounded\" />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Canvas */}\r\n            <div ref={containerRef} className=\"flex-1 bg-[#1e293b] rounded-xl relative overflow-hidden border border-slate-700 shadow-inner\">\r\n                <canvas ref={canvasRef} className=\"w-full h-full block\" />\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12987, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/experiments/SuChuyenThe.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport React, { useEffect, useRef, useState, useMemo, useCallback } from 'react';\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\r\nimport {\r\n    FlaskConical,\r\n    PlayCircle,\r\n    StopCircle,\r\n    Settings2,\r\n    Minus,\r\n    Hand,\r\n    Moon,\r\n    Sun\r\n} from 'lucide-react';\r\n\r\n// --- TS Definitions ---\r\n\r\n// Ensure MediaPipe globals are typed if they are loaded via script tags (fallback) \r\n// or if we use the imported packages. The user requested using @mediapipe/hands and @mediapipe/camera_utils.\r\n// We will import them dynamically or use the window globals if strict types are hard, \r\n// but let's try to use the classes from the packages if available.\r\n// Since the user environment has them in package.json, we'll try standard imports.\r\n// Note: MediaPipe packages sometimes have issues with SSR/imports in Next.js. \r\n// We will mock/handle them carefully or use dynamic imports if needed.\r\n// For now, standard imports.\r\n// Remove static imports to avoid build errors with UMD modules\r\n// import { Hands, Results } from '@mediapipe/hands';\r\n// import { Camera } from '@mediapipe/camera_utils';\r\n\r\n// Helper for loading scripts\r\nconst loadScript = (src: string) => {\r\n    return new Promise((resolve, reject) => {\r\n        if (typeof document === 'undefined') {\r\n            resolve(false);\r\n            return;\r\n        }\r\n        if (document.querySelector(`script[src=\"${src}\"]`)) {\r\n            resolve(true);\r\n            return;\r\n        }\r\n        const script = document.createElement('script');\r\n        script.src = src;\r\n        script.crossOrigin = \"anonymous\";\r\n        script.onload = () => resolve(true);\r\n        script.onerror = () => reject(new Error(`Failed to load ${src}`));\r\n        document.body.appendChild(script);\r\n    });\r\n};\r\n\r\n// Declare globals on window\r\ndeclare global {\r\n    interface Window {\r\n        Hands: any;\r\n        Camera: any;\r\n    }\r\n}\r\n\r\ntype MaterialType = 'water' | 'oil' | 'iron' | 'copper' | 'custom';\r\n\r\ninterface MaterialData {\r\n    name: string;\r\n    Tm: number; // Melting point\r\n    Tb: number; // Boiling point\r\n    colorSolid: number;\r\n    colorLiquid: number;\r\n    range: [number, number];\r\n    cS: number; // Specific heat Solid\r\n    cL: number; // Specific heat Liquid\r\n    cG: number; // Specific heat Gas\r\n    Lf: number; // Latent heat Fusion\r\n    Lv: number; // Latent heat Vaporization\r\n    densityRatio: number;\r\n    emissive?: boolean;\r\n}\r\n\r\nconst MATERIALS: Record<MaterialType, MaterialData> = {\r\n    water: { name: \"Nước\", Tm: 0, Tb: 100, colorSolid: 0xa5f3fc, colorLiquid: 0x06b6d4, range: [-20, 150], cS: 2, cL: 4, cG: 2, Lf: 300, Lv: 800, densityRatio: 0.92 },\r\n    oil: { name: \"Dầu\", Tm: -20, Tb: 200, colorSolid: 0xfef08a, colorLiquid: 0xeab308, range: [-50, 300], cS: 1.5, cL: 2, cG: 1.5, Lf: 200, Lv: 500, densityRatio: 1.0 },\r\n    iron: { name: \"Sắt\", Tm: 1538, Tb: 2862, colorSolid: 0x475569, colorLiquid: 0xe64a19, range: [0, 3000], emissive: true, cS: 0.45, cL: 0.6, cG: 0.45, Lf: 270, Lv: 6000, densityRatio: 1.1 },\r\n    copper: { name: \"Đồng\", Tm: 1085, Tb: 2562, colorSolid: 0xd97706, colorLiquid: 0xffedd5, range: [0, 2800], emissive: true, cS: 0.38, cL: 0.5, cG: 0.38, Lf: 205, Lv: 4800, densityRatio: 1.1 },\r\n    custom: { name: \"Tự chọn\", Tm: 0, Tb: 100, colorSolid: 0xd8b4fe, colorLiquid: 0xa855f7, range: [-100, 200], cS: 2, cL: 3, cG: 2, Lf: 300, Lv: 800, densityRatio: 1.0 }\r\n};\r\n\r\nconst SuChuyenThe = () => {\r\n    // --- State ---\r\n    const [selectedMaterial, setSelectedMaterial] = useState<MaterialType>('water');\r\n    const [customProps, setCustomProps] = useState({ Tm: 0, Tb: 100 }); // Only for custom\r\n    const [isHeating, setIsHeating] = useState(false);\r\n    const [temp, setTemp] = useState(0); // UI Temp\r\n    const [isPanelVisible, setPanelVisible] = useState(true);\r\n    const [isGestureEnabled, setGestureEnabled] = useState(false);\r\n    const [handDebug, setHandDebug] = useState(\"Waiting for hands...\");\r\n    const [bigTempDisplay, setBigTempDisplay] = useState<number | null>(null);\r\n    const [theme, setTheme] = useState<'light' | 'dark'>('dark');\r\n\r\n    // --- Refs for 3D & Physics Logic (Mutable, no re-renders) ---\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const requestRef = useRef<number>(0);\r\n    const controlsRef = useRef<OrbitControls | null>(null);\r\n    const cameraRef = useRef<THREE.PerspectiveCamera | null>(null);\r\n\r\n    // Simulation Mutable State\r\n    const simRef = useRef({\r\n        scene: null as THREE.Scene | null,\r\n        renderer: null as THREE.WebGLRenderer | null,\r\n        mats: { // Materials referencing Three.js materials\r\n            solid: null as THREE.MeshStandardMaterial | null,\r\n            liquid: null as THREE.MeshPhysicalMaterial | null,\r\n            glass: null as THREE.MeshPhysicalMaterial | null,\r\n        },\r\n        meshes: {\r\n            solid: null as THREE.Mesh | null,\r\n            liquid: null as THREE.Mesh | null,\r\n            steam: [] as THREE.Mesh[],\r\n            glowLight: null as THREE.PointLight | null,\r\n        },\r\n        physics: {\r\n            currentTemp: 0,\r\n            simTime: 0,\r\n            currentQ: 0, // Heat/Latent accumulation\r\n            phaseState: 0, // 0=Solid, 1=Melt, 2=Liquid, 3=Boil, 4=Gas\r\n            visualMeltProgress: 0,\r\n            visualBoilProgress: 0,\r\n            graphData: [] as { t: number, T: number }[],\r\n            isHeating: false,\r\n        },\r\n        currentMatData: MATERIALS['water'],\r\n    });\r\n\r\n    // --- Helper Functions ---\r\n    const getBlackBodyColor = (tempC: number) => {\r\n        const color = new THREE.Color(0x000000);\r\n        if (tempC < 500) return color;\r\n        const t = Math.min(tempC, 3000);\r\n        if (t < 1000) {\r\n            const i = (t - 500) / 500;\r\n            color.setRGB(i, 0, 0);\r\n        } else if (t < 2000) {\r\n            const i = (t - 1000) / 1000;\r\n            color.setRGB(1, i * 0.8, 0);\r\n        } else {\r\n            const i = (t - 2000) / 1000;\r\n            color.setRGB(1, 0.8 + i * 0.2, i);\r\n        }\r\n        return color;\r\n    };\r\n\r\n    // --- 3D Initialization ---\r\n    useEffect(() => {\r\n        if (!containerRef.current) return;\r\n\r\n        console.log(\"Initializing 3D Scene...\");\r\n        try {\r\n            // Init Scene\r\n            const scene = new THREE.Scene();\r\n            scene.background = new THREE.Color(theme === 'class' ? 0x0f172a : (theme === 'dark' ? 0x0f172a : 0xf8fafc));\r\n            scene.fog = new THREE.Fog(scene.background, 10, 50);\r\n\r\n            const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);\r\n            camera.position.set(0, 6, 16);\r\n            cameraRef.current = camera;\r\n\r\n            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\r\n            renderer.setSize(window.innerWidth, window.innerHeight);\r\n            renderer.setPixelRatio(window.devicePixelRatio);\r\n            renderer.shadowMap.enabled = true;\r\n            containerRef.current.appendChild(renderer.domElement);\r\n\r\n            const controls = new OrbitControls(camera, renderer.domElement);\r\n            controls.enableDamping = true;\r\n            controls.maxDistance = 40;\r\n            controls.minDistance = 5;\r\n            controls.target.set(0, 2, 0);\r\n            controlsRef.current = controls;\r\n\r\n            // Lights\r\n            const ambient = new THREE.AmbientLight(0xffffff, 0.6);\r\n            scene.add(ambient);\r\n\r\n            const dirLight = new THREE.DirectionalLight(0xffffff, 1);\r\n            dirLight.position.set(5, 12, 8);\r\n            dirLight.castShadow = true;\r\n            scene.add(dirLight);\r\n\r\n            // Grid/Plane\r\n            const gridHelper = new THREE.GridHelper(30, 30,\r\n                theme === 'dark' ? 0x1e293b : 0xe2e8f0,\r\n                theme === 'dark' ? 0x1e293b : 0xe2e8f0\r\n            );\r\n            scene.add(gridHelper);\r\n\r\n            const plane = new THREE.Mesh(\r\n                new THREE.PlaneGeometry(30, 30),\r\n                new THREE.MeshStandardMaterial({\r\n                    color: theme === 'dark' ? 0x0f172a : 0xf8fafc,\r\n                    roughness: 0.8,\r\n                    metalness: 0.2\r\n                })\r\n            );\r\n            plane.rotation.x = -Math.PI / 2;\r\n            plane.receiveShadow = true;\r\n            scene.add(plane);\r\n\r\n            // Glow Light\r\n            const glowLight = new THREE.PointLight(0xff4500, 0, 10);\r\n            glowLight.position.set(0, 2, 0);\r\n            glowLight.castShadow = true;\r\n            scene.add(glowLight);\r\n\r\n            // Group\r\n            const group = new THREE.Group();\r\n            scene.add(group);\r\n\r\n            // 1. Beaker\r\n            const glassMat = new THREE.MeshPhysicalMaterial({\r\n                color: theme === 'dark' ? 0x88CCFF : 0xffffff,\r\n                metalness: 0,\r\n                roughness: 0.1,\r\n                transmission: 0.9,\r\n                transparent: true,\r\n                opacity: theme === 'dark' ? 0.2 : 0.4,\r\n                side: THREE.DoubleSide\r\n            });\r\n            const beaker = new THREE.Mesh(new THREE.CylinderGeometry(3.2, 3.2, 5, 32, 1, true), glassMat);\r\n            beaker.position.y = 2.5;\r\n            beaker.castShadow = true;\r\n            group.add(beaker);\r\n\r\n            const beakerBottom = new THREE.Mesh(new THREE.CylinderGeometry(3.2, 3.2, 0.2, 32), glassMat);\r\n            beakerBottom.position.y = 0.1;\r\n            beakerBottom.receiveShadow = true;\r\n            group.add(beakerBottom);\r\n\r\n            // 2. Substance\r\n            const solidMat = new THREE.MeshStandardMaterial({ color: 0x06b6d4, roughness: 0.4, metalness: 0.1 });\r\n            const solidMesh = new THREE.Mesh(new THREE.BoxGeometry(3, 3, 3), solidMat);\r\n            solidMesh.rotation.y = Math.PI / 4;\r\n            solidMesh.castShadow = true;\r\n            solidMesh.receiveShadow = true;\r\n            solidMesh.position.y = 1.7;\r\n            group.add(solidMesh);\r\n\r\n            const liquidMat = new THREE.MeshPhysicalMaterial({\r\n                color: 0x06b6d4, transmission: 0.6, opacity: 0.8,\r\n                transparent: true, roughness: 0.1, metalness: 0.1\r\n            });\r\n            const liquidMesh = new THREE.Mesh(new THREE.CylinderGeometry(3.1, 3.1, 1, 32), liquidMat);\r\n            liquidMesh.position.y = 1;\r\n            liquidMesh.scale.y = 0.01;\r\n            group.add(liquidMesh);\r\n\r\n            // 3. Steam\r\n            const steamParticles: THREE.Mesh[] = [];\r\n            const steamGeo = new THREE.SphereGeometry(0.2, 8, 8);\r\n            const steamMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.3 });\r\n            const steamGroup = new THREE.Group();\r\n            group.add(steamGroup);\r\n\r\n            for (let i = 0; i < 200; i++) {\r\n                const mesh = new THREE.Mesh(steamGeo, steamMat);\r\n                mesh.visible = false;\r\n                mesh.userData = { velocity: new THREE.Vector3(), age: 0, life: 100 };\r\n                steamGroup.add(mesh);\r\n                steamParticles.push(mesh);\r\n            }\r\n\r\n            // Store refs\r\n            simRef.current.scene = scene;\r\n            simRef.current.renderer = renderer;\r\n            simRef.current.mats = { solid: solidMat, liquid: liquidMat, glass: glassMat };\r\n            simRef.current.meshes = { solid: solidMesh, liquid: liquidMesh, steam: steamParticles, glowLight };\r\n\r\n            // Handle Resize\r\n            const handleResize = () => {\r\n                camera.aspect = window.innerWidth / window.innerHeight;\r\n                camera.updateProjectionMatrix();\r\n                renderer.setSize(window.innerWidth, window.innerHeight);\r\n            };\r\n            window.addEventListener('resize', handleResize);\r\n\r\n            // Cleanup\r\n            return () => {\r\n                window.removeEventListener('resize', handleResize);\r\n                if (requestRef.current) cancelAnimationFrame(requestRef.current);\r\n                if (containerRef.current) containerRef.current.removeChild(renderer.domElement);\r\n                renderer.dispose();\r\n                // Dispose geometries/materials ideally\r\n            };\r\n        } catch (e: any) {\r\n            console.error(\"3D Init Error:\", e);\r\n        }\r\n    }, []); // Run once on mount\r\n\r\n    // --- Update Theme ---\r\n    useEffect(() => {\r\n        if (!simRef.current.scene) return;\r\n        const color = theme === 'dark' ? 0x0f172a : 0xf8fafc;\r\n        const fogColor = new THREE.Color(color);\r\n        simRef.current.scene.background = fogColor;\r\n        if (simRef.current.scene.fog) simRef.current.scene.fog.color = fogColor;\r\n\r\n        if (simRef.current.mats.glass) {\r\n            simRef.current.mats.glass.color.setHex(theme === 'dark' ? 0x88CCFF : 0xffffff);\r\n            simRef.current.mats.glass.opacity = theme === 'dark' ? 0.2 : 0.4;\r\n        }\r\n    }, [theme]);\r\n\r\n    // --- Physics & Animation Loop ---\r\n    const updatePhysics = () => {\r\n        const sim = simRef.current;\r\n        const mat = sim.currentMatData;\r\n\r\n        // Sync custom props if needed\r\n        if (selectedMaterial === 'custom') {\r\n            mat.Tm = customProps.Tm;\r\n            mat.Tb = customProps.Tb;\r\n        }\r\n\r\n        if (sim.physics.isHeating) {\r\n            const dt = 0.5;\r\n            sim.physics.simTime += dt;\r\n            const dQ = 5;\r\n            let temp = sim.physics.currentTemp;\r\n            const { Tm, Tb, cS, cL, cG, Lf, Lv } = mat;\r\n\r\n            // Logic matching source\r\n            if (temp < Tm) {\r\n                // Solid Heating\r\n                sim.physics.phaseState = 0;\r\n                sim.physics.currentTemp += dQ / cS * 0.1;\r\n                if (sim.physics.currentTemp >= Tm) {\r\n                    sim.physics.currentTemp = Tm;\r\n                    sim.physics.currentQ = 0;\r\n                }\r\n            } else if (Math.abs(temp - Tm) < 0.1 && sim.physics.phaseState <= 1) {\r\n                // Melting\r\n                sim.physics.phaseState = 1;\r\n                sim.physics.currentQ += dQ;\r\n                sim.physics.visualMeltProgress = Math.min(1, sim.physics.currentQ / Lf);\r\n                if (sim.physics.currentQ >= Lf) {\r\n                    sim.physics.phaseState = 2;\r\n                    sim.physics.currentQ = 0;\r\n                    sim.physics.currentTemp += 0.5;\r\n                    sim.physics.visualMeltProgress = 1;\r\n                }\r\n            } else if (temp < Tb) {\r\n                // Liquid Heating\r\n                sim.physics.phaseState = 2;\r\n                sim.physics.currentTemp += dQ / cL * 0.1;\r\n                if (sim.physics.currentTemp >= Tb) {\r\n                    sim.physics.currentTemp = Tb;\r\n                    sim.physics.currentQ = 0;\r\n                }\r\n            } else if (Math.abs(temp - Tb) < 0.1 && sim.physics.phaseState <= 3) {\r\n                // Boiling\r\n                sim.physics.phaseState = 3;\r\n                sim.physics.currentQ += dQ;\r\n                const scaledLv = Lv / 4; // Speed up\r\n                sim.physics.visualBoilProgress = Math.min(1, sim.physics.currentQ / scaledLv);\r\n                if (sim.physics.currentQ >= scaledLv) {\r\n                    sim.physics.phaseState = 4;\r\n                    sim.physics.currentTemp += 0.5;\r\n                    sim.physics.visualBoilProgress = 1;\r\n                }\r\n            } else {\r\n                // Gas Heating\r\n                sim.physics.phaseState = 4;\r\n                sim.physics.currentTemp += dQ / cG * 0.1;\r\n                if (sim.physics.currentTemp > mat.range[1]) {\r\n                    sim.physics.currentTemp = mat.range[1];\r\n                }\r\n            }\r\n\r\n            // Record Graph Data\r\n            if (Math.floor(sim.physics.simTime) % 2 === 0) {\r\n                sim.physics.graphData.push({ t: sim.physics.simTime, T: sim.physics.currentTemp });\r\n                if (sim.physics.graphData.length > 200) sim.physics.graphData.shift(); // Keep buffer sane\r\n            }\r\n\r\n            // Sync React State roughly (every 5 frames or so to avoid too many re-renders?)\r\n            // Or just do it every frame if simple. \r\n            // We'll update the temp state so slider moves.\r\n            setTemp(sim.physics.currentTemp);\r\n        } else {\r\n            // Update internal physics temp from UI if not heating (Manual Slider)\r\n            // Handled via setTemp/useEffect or direct assignment? \r\n            // Let's rely on the ref for the loop, and update ref when state changes.\r\n        }\r\n    };\r\n\r\n    const spawnSteam = () => {\r\n        const sim = simRef.current;\r\n        const p = sim.meshes.steam.find(p => !p.visible);\r\n        if (!p || !sim.meshes.liquid) return;\r\n\r\n        p.visible = true;\r\n        const r = (Math.random() - 0.5) * 4;\r\n        const theta = Math.random() * Math.PI * 2;\r\n        const radius = Math.random() * 2.5;\r\n\r\n        p.position.set(\r\n            Math.cos(theta) * radius,\r\n            sim.meshes.liquid.visible ? (sim.meshes.liquid.position.y * 2) + 0.2 : 0.5,\r\n            Math.sin(theta) * radius\r\n        );\r\n\r\n        p.userData.age = 0;\r\n        p.userData.life = 100 + Math.random() * 50;\r\n        p.userData.velocity.set(\r\n            (Math.random() - 0.5) * 0.02,\r\n            0.05 + Math.random() * 0.05,\r\n            (Math.random() - 0.5) * 0.02\r\n        );\r\n        p.scale.setScalar(0.5 + Math.random());\r\n    };\r\n\r\n    const update3DObjects = (time: number) => {\r\n        const sim = simRef.current;\r\n        const mat = sim.currentMatData;\r\n        const tempVal = sim.physics.currentTemp;\r\n        const { Tm, Tb } = mat;\r\n\r\n        // Colors\r\n        if (sim.mats.solid && sim.mats.liquid) {\r\n            sim.mats.solid.color.setHex(mat.colorSolid);\r\n            sim.mats.liquid.color.setHex(mat.colorLiquid);\r\n        }\r\n\r\n        // Helpers\r\n        const isHeating = sim.physics.isHeating;\r\n        const meltRange = 10;\r\n        const boilRange = 10;\r\n\r\n        // --- Melting Logic ---\r\n        let meltProgress = 0;\r\n        if (isHeating) {\r\n            if (tempVal < Tm) meltProgress = 0;\r\n            else if (sim.physics.phaseState === 1) meltProgress = sim.physics.visualMeltProgress;\r\n            else if (tempVal >= Tm && sim.physics.phaseState >= 2) meltProgress = 1;\r\n        } else {\r\n            if (tempVal < Tm) meltProgress = 0;\r\n            else if (tempVal > Tm + meltRange) meltProgress = 1;\r\n            else meltProgress = (tempVal - Tm) / meltRange;\r\n        }\r\n\r\n        const solidScale = 1 - meltProgress;\r\n        if (sim.meshes.solid) {\r\n            if (solidScale > 0.01) {\r\n                sim.meshes.solid.visible = true;\r\n                sim.meshes.solid.scale.setScalar(solidScale);\r\n                sim.meshes.solid.position.y = 0.2 + (1.5 * solidScale);\r\n                sim.meshes.solid.rotation.y = time * 0.0005;\r\n            } else {\r\n                sim.meshes.solid.visible = false;\r\n            }\r\n        }\r\n\r\n        // --- Boiling Logic ---\r\n        let boilProgress = 0;\r\n        if (isHeating) {\r\n            if (tempVal < Tb) boilProgress = 0;\r\n            else if (sim.physics.phaseState === 3) boilProgress = sim.physics.visualBoilProgress;\r\n            else if (tempVal >= Tb && sim.physics.phaseState === 4) boilProgress = 1;\r\n        } else {\r\n            if (tempVal < Tb) boilProgress = 0;\r\n            else if (tempVal > Tb + boilRange) boilProgress = 1;\r\n            else boilProgress = (tempVal - Tb) / boilRange;\r\n        }\r\n\r\n        // --- Liquid Logic ---\r\n        let liquidAmount = meltProgress * (1 - boilProgress);\r\n        if (sim.meshes.liquid) {\r\n            if (liquidAmount > 0.01) {\r\n                sim.meshes.liquid.visible = true;\r\n                const ratio = mat.densityRatio || 1.0;\r\n                const baseHeight = 0.9;\r\n                const targetHeight = baseHeight * ratio * liquidAmount;\r\n                sim.meshes.liquid.scale.y = Math.max(0.01, targetHeight);\r\n                sim.meshes.liquid.position.y = 0.2 + (targetHeight / 2);\r\n            } else {\r\n                sim.meshes.liquid.visible = false;\r\n            }\r\n        }\r\n\r\n        // --- Emissive ---\r\n        if (mat.emissive && tempVal > 400 && sim.mats.solid && sim.mats.liquid) {\r\n            const glowColor = getBlackBodyColor(tempVal);\r\n            const intensity = Math.min(2, Math.max(0, (tempVal - 400) / 600));\r\n            sim.mats.solid.emissive.copy(glowColor);\r\n            sim.mats.solid.emissiveIntensity = intensity;\r\n\r\n            // Adjust transmission for metals\r\n            sim.mats.liquid.transmission = 0;\r\n            sim.mats.liquid.opacity = 1;\r\n            sim.mats.liquid.emissive.copy(glowColor);\r\n            sim.mats.liquid.emissiveIntensity = intensity;\r\n\r\n            if (sim.meshes.glowLight) {\r\n                sim.meshes.glowLight.color.copy(glowColor);\r\n                sim.meshes.glowLight.intensity = intensity * 1.5;\r\n            }\r\n        } else if (sim.mats.solid && sim.mats.liquid) {\r\n            sim.mats.solid.emissive.setHex(0x000000);\r\n            sim.mats.liquid.emissive.setHex(0x000000);\r\n            sim.mats.solid.emissiveIntensity = 0;\r\n            sim.mats.liquid.emissiveIntensity = 0;\r\n            sim.mats.liquid.transmission = 0.6; // Reset to water/oil\r\n            sim.mats.liquid.opacity = 0.8;\r\n            if (sim.meshes.glowLight) sim.meshes.glowLight.intensity = 0;\r\n        }\r\n\r\n        // --- Steam ---\r\n        if (tempVal > Tb - 20) {\r\n            const spawnRate = Math.max(0.1, (tempVal - (Tb - 20)) / 50);\r\n            if (Math.random() < spawnRate) spawnSteam();\r\n        }\r\n\r\n        sim.meshes.steam.forEach(p => {\r\n            if (!p.visible) return;\r\n            p.position.add(p.userData.velocity);\r\n            p.userData.age++;\r\n            const lifeRatio = p.userData.age / p.userData.life;\r\n            if (Array.isArray(p.material)) return; // TS guard\r\n            (p.material as THREE.MeshBasicMaterial).opacity = 0.4 * (1 - lifeRatio);\r\n            p.scale.multiplyScalar(1.005);\r\n            if (p.userData.age >= p.userData.life) p.visible = false;\r\n        });\r\n    };\r\n\r\n    const drawGraph = () => {\r\n        if (!canvasRef.current) return;\r\n        const ctx = canvasRef.current.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const w = canvasRef.current.width;\r\n        const h = canvasRef.current.height;\r\n        const isDark = theme === 'dark';\r\n\r\n        ctx.clearRect(0, 0, w, h);\r\n        ctx.fillStyle = isDark ? \"#1e293b\" : \"#f8fafc\";\r\n        ctx.fillRect(0, 0, w, h);\r\n\r\n        ctx.strokeStyle = \"#94a3b8\";\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(30, 10); ctx.lineTo(30, h - 20);\r\n        ctx.moveTo(30, h - 20); ctx.lineTo(w - 10, h - 20);\r\n        ctx.stroke();\r\n\r\n        ctx.fillStyle = \"#64748b\";\r\n        ctx.font = \"10px monospace\";\r\n        ctx.fillText(\"T°C\", 5, 10);\r\n        ctx.fillText(\"Time\", w - 30, h - 5);\r\n\r\n        const data = simRef.current.physics.graphData;\r\n        if (data.length < 2) return;\r\n\r\n        const maxTime = Math.max(200, data[data.length - 1].t);\r\n        const mat = simRef.current.currentMatData;\r\n        const minT = mat.range[0];\r\n        const maxT = mat.range[1];\r\n        const rangeT = maxT - minT;\r\n\r\n        ctx.strokeStyle = \"#06b6d4\";\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        data.forEach((p, i) => {\r\n            const x = 30 + (p.t / maxTime) * (w - 40);\r\n            const y = (h - 20) - ((p.T - minT) / rangeT) * (h - 30);\r\n            if (i === 0) ctx.moveTo(x, y);\r\n            else ctx.lineTo(x, y);\r\n        });\r\n        ctx.stroke();\r\n    };\r\n\r\n    // Animation Loop\r\n    useEffect(() => {\r\n        const animate = (time: number) => {\r\n            requestRef.current = requestAnimationFrame(animate);\r\n            try {\r\n                updatePhysics();\r\n                update3DObjects(time);\r\n                drawGraph();\r\n                if (controlsRef.current) controlsRef.current.update();\r\n                if (simRef.current.renderer && simRef.current.scene && cameraRef.current) {\r\n                    simRef.current.renderer.render(simRef.current.scene, cameraRef.current);\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Animation Loop Error:\", e);\r\n                cancelAnimationFrame(requestRef.current);\r\n            }\r\n        };\r\n        requestRef.current = requestAnimationFrame(animate);\r\n        return () => cancelAnimationFrame(requestRef.current);\r\n    }, [selectedMaterial]); // Dependencies? Actually refs cover mutable state, so we don't need to re-bind often.\r\n    // However, selectedMaterial change logic handles physics reset elsewhere.\r\n\r\n    // --- UI Handlers ---\r\n    const handleMaterialChange = (type: MaterialType) => {\r\n        setSelectedMaterial(type);\r\n        simRef.current.currentMatData = MATERIALS[type];\r\n        // Reset Logic\r\n        setIsHeating(false);\r\n        simRef.current.physics.isHeating = false;\r\n        simRef.current.physics.simTime = 0;\r\n        simRef.current.physics.graphData = [];\r\n        simRef.current.physics.visualMeltProgress = 0;\r\n        simRef.current.physics.visualBoilProgress = 0;\r\n\r\n        // Initial Temp\r\n        const initTemp = MATERIALS[type].range[0];\r\n        simRef.current.physics.currentTemp = initTemp;\r\n        setTemp(initTemp);\r\n    };\r\n\r\n    const toggleHeat = () => {\r\n        const newState = !isHeating;\r\n        setIsHeating(newState);\r\n        simRef.current.physics.isHeating = newState;\r\n        if (newState) {\r\n            // Start\r\n            simRef.current.physics.graphData = [{ t: 0, T: simRef.current.physics.currentTemp }];\r\n        }\r\n    };\r\n\r\n    const handleTempSlider = (val: number) => {\r\n        if (isHeating) return; // Prevent manual change while heating\r\n        setTemp(val);\r\n        simRef.current.physics.currentTemp = val;\r\n    };\r\n\r\n    // --- MediaPipe Hand Gestures ---\r\n    useEffect(() => {\r\n        if (!isGestureEnabled || !videoRef.current) {\r\n            return;\r\n        }\r\n\r\n        let camera: any = null;\r\n        let hands: any = null;\r\n        let active = true;\r\n        let prevHandPos = { x: 0, y: 0 };\r\n\r\n        const startHands = async () => {\r\n            try {\r\n                setHandDebug(\"Loading AI Models...\");\r\n                await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js');\r\n                await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js');\r\n\r\n                if (!active) return;\r\n\r\n                if (!window.Hands || !window.Camera) {\r\n                    throw new Error(\"Failed to load MediaPipe globals\");\r\n                }\r\n\r\n                hands = new window.Hands({ locateFile: (file: string) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });\r\n                hands.setOptions({\r\n                    maxNumHands: 2,\r\n                    modelComplexity: 1,\r\n                    minDetectionConfidence: 0.5,\r\n                    minTrackingConfidence: 0.5\r\n                });\r\n\r\n                hands.onResults((results: any) => {\r\n                    if (!active) return;\r\n                    const lm = results.multiHandLandmarks;\r\n                    if (lm && lm.length > 0) {\r\n                        setHandDebug(`Detected ${lm.length} hand(s)`);\r\n\r\n                        if (lm.length === 2) {\r\n                            // 2 HANDS -> ZOOM\r\n                            const h1 = lm[0][9];\r\n                            const h2 = lm[1][9];\r\n                            const dist = Math.hypot(h1.x - h2.x, h1.y - h2.y);\r\n                            const t = (Math.max(0.1, Math.min(0.8, dist)) - 0.1) / 0.7;\r\n                            const targetDist = 40 - (t * 35);\r\n                            if (cameraRef.current && controlsRef.current) {\r\n                                const curDist = cameraRef.current.position.distanceTo(controlsRef.current.target);\r\n                                const newDist = curDist + (targetDist - curDist) * 0.1;\r\n                                const dir = new THREE.Vector3().copy(cameraRef.current.position).sub(controlsRef.current.target).normalize();\r\n                                cameraRef.current.position.copy(controlsRef.current.target).add(dir.multiplyScalar(newDist));\r\n                            }\r\n                            setHandDebug(`👐 ZOOM: ${(t * 100).toFixed(0)}%`);\r\n                        } else {\r\n                            // 1 HAND\r\n                            const l = lm[0];\r\n                            const dist = (i: number, j: number) => Math.hypot(l[i].x - l[j].x, l[i].y - l[j].y);\r\n                            const isFolded = (tip: number, pip: number) => dist(tip, 0) < dist(pip, 0);\r\n\r\n                            const indexOpen = !isFolded(8, 6);\r\n                            const middleOpen = !isFolded(12, 10);\r\n                            const ringOpen = !isFolded(16, 14);\r\n                            const pinkyOpen = !isFolded(20, 18);\r\n\r\n                            // L-Shape / Pinch Logic (Thumb + Index)\r\n                            // Source logic: !isFolded(8, 6) && isFolded(12, 10)... means Index Open, others Closed.\r\n                            // Pinch distance typically 4 to 8.\r\n                            const sourceLControl = !isFolded(8, 6) && isFolded(12, 10) && isFolded(16, 14) && isFolded(20, 18);\r\n                            const isOpen = indexOpen && middleOpen && ringOpen && pinkyOpen;\r\n                            const pinchDist = dist(4, 8);\r\n\r\n                            if (sourceLControl) {\r\n                                const minP = 0.02, maxP = 0.20;\r\n                                const percent = Math.max(0, Math.min(1, (pinchDist - minP) / (maxP - minP)));\r\n                                const mat = simRef.current.currentMatData;\r\n                                const val = mat.range[0] + (mat.range[1] - mat.range[0]) * percent;\r\n\r\n                                if (!simRef.current.physics.isHeating) {\r\n                                    setTemp(val);\r\n                                    simRef.current.physics.currentTemp = val;\r\n                                    setBigTempDisplay(val);\r\n                                }\r\n                                setHandDebug(`👌 TEMP: ${val.toFixed(0)}°C`);\r\n                            } else if (isOpen) {\r\n                                setBigTempDisplay(null);\r\n                                const handX = 1 - l[9].x;\r\n                                const handY = l[9].y;\r\n                                const dx = handX - prevHandPos.x;\r\n                                const dy = handY - prevHandPos.y;\r\n\r\n                                if (Math.abs(dx) > 0.002 && cameraRef.current && controlsRef.current) {\r\n                                    const offset = new THREE.Vector3().copy(cameraRef.current.position).sub(controlsRef.current.target);\r\n                                    const spherical = new THREE.Spherical().setFromVector3(offset);\r\n                                    spherical.theta -= dx * 5;\r\n                                    spherical.phi -= dy * 5;\r\n                                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));\r\n                                    cameraRef.current.position.copy(controlsRef.current.target).add(new THREE.Vector3().setFromSpherical(spherical));\r\n                                    cameraRef.current.lookAt(controlsRef.current.target);\r\n                                }\r\n                                prevHandPos = { x: handX, y: handY };\r\n                                setHandDebug(\"🔄 ROTATE\");\r\n                            } else {\r\n                                setBigTempDisplay(null);\r\n                                setHandDebug(\"Waiting...\");\r\n                            }\r\n                        }\r\n                    } else {\r\n                        setHandDebug(\"No hand detected\");\r\n                        setBigTempDisplay(null);\r\n                    }\r\n                });\r\n\r\n                if (videoRef.current && window.Camera) {\r\n                    camera = new window.Camera(videoRef.current, {\r\n                        onFrame: async () => {\r\n                            if (hands && videoRef.current) await hands.send({ image: videoRef.current });\r\n                        },\r\n                        width: 320,\r\n                        height: 240\r\n                    });\r\n                    camera.start();\r\n                }\r\n\r\n            } catch (err: any) {\r\n                console.error(err);\r\n                if (active) setHandDebug(\"Error: \" + err.message);\r\n            }\r\n        };\r\n\r\n        startHands();\r\n\r\n        return () => {\r\n            active = false;\r\n            if (camera) camera.stop();\r\n            if (hands) hands.close();\r\n        };\r\n    }, [isGestureEnabled]);\r\n\r\n    // --- Render Helpers ---\r\n    const getPhaseLabel = () => {\r\n        const t = simRef.current.physics.currentTemp;\r\n        const mat = simRef.current.currentMatData;\r\n        if (t < mat.Tm) return { text: \"SOLID\", color: \"bg-blue-100 text-blue-600\", desc: \"Rắn: Hình dạng cố định\" };\r\n        if (t >= mat.Tm && t < mat.Tb) return { text: \"LIQUID\", color: \"bg-cyan-100 text-cyan-600\", desc: \"Lỏng: Hình dạng đáy bình\" };\r\n        return { text: \"GAS\", color: \"bg-red-100 text-red-600\", desc: \"Khí: Bay hơi tự do\" };\r\n    };\r\n\r\n    const phase = getPhaseLabel();\r\n\r\n    return (\r\n        <div className={`relative w-full h-screen overflow-hidden ${theme === 'dark' ? 'dark' : ''}`}>\r\n\r\n            {/* Background Container for 3D */}\r\n            <div\r\n                ref={containerRef}\r\n                className=\"absolute inset-0 z-0 bg-slate-50 dark:bg-slate-900 transition-colors duration-500\"\r\n            />\r\n\r\n            {/* Theme Toggle */}\r\n            <div className=\"absolute top-6 right-6 z-10\">\r\n                <button\r\n                    onClick={() => setTheme(t => t === 'dark' ? 'light' : 'dark')}\r\n                    className=\"p-3 bg-white/20 hover:bg-white/40 backdrop-blur-md rounded-full text-slate-800 dark:text-white shadow-lg border border-white/20 transition-all\"\r\n                >\r\n                    {theme === 'dark' ? <Moon size={24} /> : <Sun size={24} />}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Big Temp Display (Gesture) */}\r\n            {bigTempDisplay !== null && isGestureEnabled && (\r\n                <div className=\"fixed top-6 right-28 text-6xl font-bold text-white drop-shadow-lg z-40 font-mono pointer-events-none animate-pulse\">\r\n                    {bigTempDisplay.toFixed(0)}°C\r\n                </div>\r\n            )}\r\n\r\n            {/* Panel Toggle Button */}\r\n            {!isPanelVisible && (\r\n                <button\r\n                    onClick={() => setPanelVisible(true)}\r\n                    className=\"absolute bottom-6 left-6 z-40 bg-cyan-500 hover:bg-cyan-600 text-white p-3 rounded-full shadow-lg transition-transform hover:scale-110\"\r\n                >\r\n                    <Settings2 />\r\n                </button>\r\n            )}\r\n\r\n            {/* UI Panel */}\r\n            {isPanelVisible && (\r\n                <div className=\"absolute top-5 right-5 sm:right-20 w-[380px] max-h-[90vh] flex flex-col bg-white/95 dark:bg-slate-900/90 backdrop-blur-xl rounded-xl shadow-2xl z-50 transition-colors border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 cursor-move\">\r\n                        <h1 className=\"text-lg font-bold flex items-center gap-2 text-slate-800 dark:text-white uppercase tracking-wider\">\r\n                            <FlaskConical className=\"text-cyan-500\" /> Phân Tích\r\n                        </h1>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className={`text-xs font-mono px-2 py-0.5 rounded font-bold ${phase.color}`}>\r\n                                {phase.text}\r\n                            </div>\r\n                            <button onClick={() => setPanelVisible(false)} className=\"text-slate-400 hover:text-red-500\">\r\n                                <Minus size={20} />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"p-4 overflow-y-auto flex-1 space-y-4\">\r\n                        {/* Selector */}\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-semibold mb-1 text-slate-500 dark:text-slate-400\">Chọn Chất</label>\r\n                                <select\r\n                                    value={selectedMaterial}\r\n                                    onChange={(e) => handleMaterialChange(e.target.value as MaterialType)}\r\n                                    className=\"w-full p-2 rounded-lg bg-slate-100 dark:bg-slate-800 border-none text-slate-700 dark:text-slate-200 text-sm outline-none focus:ring-2 focus:ring-cyan-500\"\r\n                                >\r\n                                    {Object.entries(MATERIALS).map(([k, v]) => (\r\n                                        <option key={k} value={k}>{v.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Custom Inputs */}\r\n                        {selectedMaterial === 'custom' && (\r\n                            <div className=\"grid grid-cols-2 gap-4 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg\">\r\n                                <div>\r\n                                    <label className=\"text-xs text-slate-500 mb-1 block\">T.Nóng chảy</label>\r\n                                    <input type=\"number\" value={customProps.Tm} onChange={e => setCustomProps({ ...customProps, Tm: +e.target.value })} className=\"w-full p-1.5 rounded text-sm bg-white dark:bg-slate-700 dark:text-white border dark:border-slate-600\" />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"text-xs text-slate-500 mb-1 block\">T.Sôi</label>\r\n                                    <input type=\"number\" value={customProps.Tb} onChange={e => setCustomProps({ ...customProps, Tb: +e.target.value })} className=\"w-full p-1.5 rounded text-sm bg-white dark:bg-slate-700 dark:text-white border dark:border-slate-600\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Graph */}\r\n                        <div className=\"bg-slate-50 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700 p-1\">\r\n                            <canvas ref={canvasRef} width={300} height={150} className=\"w-full h-auto\" />\r\n                        </div>\r\n\r\n                        {/* Controls */}\r\n                        <div className=\"flex gap-2\">\r\n                            <button\r\n                                onClick={toggleHeat}\r\n                                className={`flex-1 py-2 rounded font-bold text-white flex justify-center items-center gap-2 transition-colors ${isHeating ? 'bg-red-500 hover:bg-red-600' : 'bg-cyan-600 hover:bg-cyan-700'\r\n                                    }`}\r\n                            >\r\n                                {isHeating ? <><StopCircle size={20} /> Dừng</> : <><PlayCircle size={20} /> Gia nhiệt</>}\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setGestureEnabled(!isGestureEnabled)}\r\n                                className={`w-12 flex items-center justify-center rounded transition-colors ${isGestureEnabled ? 'bg-cyan-500 text-white shadow shadow-cyan-500/50' : 'bg-slate-100 dark:bg-slate-700 text-slate-500'\r\n                                    }`}\r\n                                title=\"Bật điều khiển tay\"\r\n                            >\r\n                                <Hand size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Slider */}\r\n                        <div>\r\n                            <label className=\"flex justify-between text-sm font-semibold mb-2 text-slate-600 dark:text-slate-300\">\r\n                                <span>Nhiệt Độ (T)</span>\r\n                                <span className=\"font-mono text-cyan-500 text-lg\">{temp.toFixed(0)}°C</span>\r\n                            </label>\r\n                            <input\r\n                                type=\"range\"\r\n                                min={simRef.current.currentMatData.range[0]}\r\n                                max={simRef.current.currentMatData.range[1]}\r\n                                value={temp}\r\n                                disabled={isHeating}\r\n                                onChange={(e) => handleTempSlider(Number(e.target.value))}\r\n                                className=\"w-full h-3 bg-gradient-to-r from-blue-500 via-purple-500 to-red-500 rounded-lg appearance-none cursor-pointer disabled:opacity-50\"\r\n                            />\r\n                            <div className=\"flex justify-between mt-2 text-[10px] font-mono text-slate-400\">\r\n                                <span>{simRef.current.currentMatData.range[0]}°C</span>\r\n                                <span className=\"text-blue-400\">Tm: {simRef.current.currentMatData.Tm}</span>\r\n                                <span className=\"text-red-400\">Tb: {simRef.current.currentMatData.Tb}</span>\r\n                                <span>{simRef.current.currentMatData.range[1]}°C</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Info */}\r\n                        <div className=\"text-xs text-slate-500 dark:text-slate-400 italic\">\r\n                            {phase.desc}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Webcam Feed & Guide */}\r\n            <div className={`absolute bottom-5 right-5 z-40 transition-all duration-300 ${!isGestureEnabled ? 'translate-y-96 opacity-0' : 'translate-y-0 opacity-100'}`}>\r\n                <video\r\n                    ref={videoRef}\r\n                    className=\"w-40 h-32 bg-black rounded-xl border-2 border-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.5)] object-cover scale-x-[-1]\"\r\n                    autoPlay\r\n                    playsInline\r\n                    muted\r\n                />\r\n                <div className=\"absolute bottom-36 right-0 bg-slate-900/90 backdrop-blur-md p-3 rounded-xl border border-white/10 text-white w-48 text-xs\">\r\n                    <div className=\"flex items-center gap-2 mb-2 font-bold text-cyan-400\">\r\n                        <span className=\"w-2 h-2 rounded-full bg-cyan-400 animate-pulse\"></span>\r\n                        ĐIỀU KHIỂN TAY\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"flex gap-2 items-center\">\r\n                            <span className=\"text-lg\">👐</span>\r\n                            <div>\r\n                                <strong>2 Tay</strong>\r\n                                <div className=\"text-slate-400\">Zoom ra/vào</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 items-center\">\r\n                            <span className=\"text-lg\">👌</span>\r\n                            <div>\r\n                                <strong>Chụm (L)</strong>\r\n                                <div className=\"text-slate-400\">Chỉnh nhiệt độ</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 items-center\">\r\n                            <span className=\"text-lg\">🖐</span>\r\n                            <div>\r\n                                <strong>Mở tay</strong>\r\n                                <div className=\"text-slate-400\">Xoay Camera</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-2 pt-2 border-t border-white/10 font-mono text-cyan-200\">\r\n                            {handDebug}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SuChuyenThe;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 14462, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/components/physics-lab.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useState, useEffect, useRef } from \"react\"\nimport Link from \"next/link\"\nimport {\n  FlaskConical,\n  Menu,\n  X,\n  Activity,\n  Waves,\n  Zap,\n  Anchor,\n  TrendingDown,\n  Mic,\n  Aperture,\n  Infinity,\n  Box,\n  PlusCircle,\n  Trash2,\n  Atom,\n  Terminal,\n  FileCode,\n  Hand\n} from \"lucide-react\"\n\n// Import UI Library\nimport { LabLayout, NeonButton } from \"./ui/sci-fi-lab\"\nimport { ThemeToggle } from \"./ui/theme-toggle\"\n\n// Imports Experiments\nimport PhysicsIntro from \"./experiments/physics-intro\"\nimport SpringOscillator from \"./experiments/spring-oscillator\"\nimport SimplePendulum from \"./experiments/simple-pendulum\"\nimport DampedOscillation from \"./experiments/damped-oscillation\"\nimport HarmonicOscillation from \"./experiments/harmonic-oscillation\"\nimport MechanicalWaves from \"./experiments/mechanical-waves\"\nimport SoundWaves from \"./experiments/sound-waves\"\nimport WaveInterference from \"./experiments/wave-interference\"\nimport StandingWaves from \"./experiments/standing-waves\"\nimport SoundSpeedExperiment from \"./experiments/sound-speed\"\nimport HandSpringOscillator from \"./experiments/hand-spring-oscillator\"\nimport HandSimplePendulum from \"./experiments/hand-simple-pendulum\"\nimport PhaseChangeExperiment from \"./experiments/SuChuyenThe\"\n// Tách mục Intro ra riêng để xử lý hiển thị đặc biệt\nconst INTRO_ITEM = { id: \"intro\", label: \"Giới thiệu chung\", icon: FlaskConical }\n\n// Danh sách các bài thí nghiệm (Không bao gồm Intro)\nconst EXPERIMENTS = [\n  { id: \"harmonic-oscillation\", label: \"Dao động điều hòa\", icon: Zap },\n  { id: \"spring-oscillator\", label: \"Con lắc lò xo\", icon: Activity },\n  { id: \"simple-pendulum\", label: \"Con lắc đơn\", icon: Anchor },\n  { id: \"damped-oscillation\", label: \"Dao động tắt dần\", icon: TrendingDown },\n  { id: \"mechanical-waves\", label: \"Sóng cơ\", icon: Waves },\n  { id: \"sound-waves\", label: \"Sóng âm\", icon: Mic },\n  { id: \"wave-interference\", label: \"Giao thoa sóng\", icon: Aperture },\n  { id: \"sound-speed\", label: \"Đo tốc độ truyền âm\", icon: Mic },\n  { id: \"standing-waves\", label: \"Sóng dừng\", icon: Infinity },\n  { id: \"phase-change\", label: \"Sự chuyển thể\", icon: FlaskConical },\n  { id: \"hand-spring\", label: \"Lò xo (Hand Control)\", icon: Hand },\n  { id: \"hand-pendulum\", label: \"Con lắc đơn (Hand)\", icon: Hand },\n\n]\n\nexport default function PhysicsLab() {\n  const [activeTab, setActiveTab] = useState(\"intro\")\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false)\n  const [customModules, setCustomModules] = useState<any[]>([])\n  const mainContentRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    // Scroll handling\n    if (mainContentRef.current) {\n      mainContentRef.current.scrollTo({ top: 0, behavior: 'auto' })\n    }\n  }, [activeTab])\n\n  useEffect(() => {\n    // Fetch user modules\n    fetch('/api/modules')\n      .then(res => res.json())\n      .then(data => setCustomModules(data))\n      .catch(err => console.error(\"Failed to load modules\", err))\n  }, [])\n\n  const handleDeleteModule = async (e: React.MouseEvent, id: string) => {\n    e.stopPropagation()\n    if (!confirm(\"Bạn có chắc muốn xóa module này không?\")) return\n\n    try {\n      const res = await fetch('/api/modules', {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ id })\n      })\n      if (res.ok) {\n        setCustomModules(prev => prev.filter(m => m.id !== id))\n        if (activeTab === id) setActiveTab('intro')\n      } else {\n        alert(\"Xóa thất bại\")\n      }\n    } catch (err) {\n      console.error(\"Failed to delete\", err)\n      alert(\"Có lỗi xảy ra\")\n    }\n  }\n\n  const currentItem = activeTab === 'intro'\n    ? INTRO_ITEM\n    : EXPERIMENTS.find(e => e.id === activeTab) || customModules.find(m => m.id === activeTab)\n\n  const ActiveIcon = currentItem?.icon || (currentItem?.type === 'iframe' ? Box : FlaskConical)\n\n  const renderContent = () => {\n    // Check built-in experiments\n    switch (activeTab) {\n      case \"intro\": return <PhysicsIntro onSelectExperiment={setActiveTab} />\n      case \"spring-oscillator\": return <SpringOscillator />\n      case \"simple-pendulum\": return <SimplePendulum />\n      case \"damped-oscillation\": return <DampedOscillation />\n      case \"harmonic-oscillation\": return <HarmonicOscillation />\n      case \"mechanical-waves\": return <MechanicalWaves />\n      case \"sound-waves\": return <SoundWaves />\n      case \"wave-interference\": return <WaveInterference />\n      case \"standing-waves\": return <StandingWaves />\n      case \"sound-speed\": return <SoundSpeedExperiment />\n      case \"phase-change\": return <PhaseChangeExperiment />\n      case \"hand-spring\": return <HandSpringOscillator />\n      case \"hand-pendulum\": return <HandSimplePendulum />\n\n    }\n\n    // Check custom modules\n    const custom = customModules.find(m => m.id === activeTab)\n    if (custom) {\n      return (\n        <div className=\"w-full h-full bg-[#1e293b] rounded-xl overflow-hidden border border-slate-700 relative\">\n          <iframe\n            src={custom.path}\n            className=\"w-full h-full border-0\"\n            title={custom.label}\n            sandbox=\"allow-scripts allow-same-origin\"\n          />\n        </div>\n      )\n    }\n\n    return <PhysicsIntro onSelectExperiment={setActiveTab} />\n  }\n\n  return (\n    <LabLayout>\n      {/* HEADER BAR */}\n      <header className=\"flex items-center justify-between mb-6 pb-4 border-b border-slate-200 dark:border-slate-800/60 shrink-0 transition-colors\">\n        <div className=\"flex items-center gap-4\">\n          <NeonButton\n            onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n            className=\"!px-3 !py-2\"\n          >\n            {isSidebarOpen ? <X size={20} /> : <Menu size={20} />}\n          </NeonButton>\n\n          <div className=\"flex flex-col\">\n            <h1 className=\"text-2xl md:text-3xl font-bold font-sans tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-blue-700 dark:from-cyan-400 dark:to-blue-600 uppercase\">\n              PHÒNG THÍ NGHIỆM VẬT LÝ <span className=\"text-xs align-top opacity-50 text-slate-500 dark:text-slate-400\">v2.1</span>\n            </h1>\n            <div className=\"flex items-center gap-2 text-[10px] text-slate-500 dark:text-slate-500 font-sans font-bold uppercase tracking-widest\">\n              <span className=\"w-2 h-2 rounded-full bg-cyan-500 animate-pulse\"></span>\n              Hệ thống: Sẵn sàng\n            </div>\n          </div>\n        </div>\n\n        <div className=\"hidden md:flex items-center gap-6\">\n          <ThemeToggle />\n          <div className=\"w-[1px] h-8 bg-slate-300 dark:bg-slate-800\"></div>\n          <div className=\"text-right\">\n            <div className=\"text-sky-700 dark:text-cyan-400 font-sans font-bold flex items-center justify-end gap-2\">\n              {currentItem?.label || \"Giới thiệu\"} <ActiveIcon size={16} />\n            </div>\n          </div>\n          <div className=\"w-[1px] h-8 bg-slate-300 dark:bg-slate-800\"></div>\n          <div className=\"text-right\">\n            <div className=\"text-[10px] text-slate-500 uppercase font-sans font-bold\">Chủ dự án</div>\n            <div className=\"font-sans font-bold text-sky-600 dark:text-cyan-500\">Hồ Hoàng Anh</div>\n          </div>\n        </div>\n      </header>\n\n      {/* MAIN BODY */}\n      <div className=\"flex flex-1 overflow-hidden gap-6 relative\">\n\n        {/* SIDEBAR NAVIGATION */}\n        <aside\n          className={`\n            fixed md:static inset-y-0 left-0 z-50 w-64 bg-white/95 dark:bg-[#02040a]/95 md:bg-transparent backdrop-blur-xl md:backdrop-blur-none border-r border-slate-200 dark:border-slate-800/50 md:border-none\n            transform transition-transform duration-300 ease-out flex flex-col gap-2 p-4 md:p-0\n            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:hidden'}\n          `}\n        >\n          <div className=\"md:hidden flex justify-end mb-4\">\n            <button onClick={() => setIsSidebarOpen(false)} className=\"text-slate-500 hover:text-sky-600 dark:hover:text-cyan-400\"><X /></button>\n          </div>\n\n          {/* SECTION 1: GIỚI THIỆU CHUNG */}\n          <div className=\"mb-6 px-0\">\n            <button\n              onClick={() => {\n                setActiveTab(INTRO_ITEM.id);\n                if (window.innerWidth < 768) setIsSidebarOpen(false);\n              }}\n              className={`\n                  w-full text-left px-4 py-3 rounded border font-sans text-xs font-bold uppercase tracking-wide transition-all group relative overflow-hidden\n                  ${activeTab === INTRO_ITEM.id\n                  ? 'bg-sky-100 dark:bg-cyan-950/40 border-sky-300 dark:border-cyan-500/50 text-sky-700 dark:text-cyan-400 shadow-sm dark:shadow-[0_0_10px_rgba(6,182,212,0.1)]'\n                  : 'bg-transparent border-transparent text-slate-600 dark:text-slate-500 hover:bg-sky-50 dark:hover:bg-slate-900 hover:text-sky-600 dark:hover:text-cyan-300'}\n                `}\n            >\n              <div className=\"absolute inset-0 w-[150%] -translate-x-[120%] group-hover:translate-x-[100%] transition-transform duration-700 ease-out bg-gradient-to-r from-transparent via-sky-300/30 dark:via-cyan-400/20 to-transparent skew-x-12 pointer-events-none\" />\n              <div className=\"relative z-10 flex items-center gap-3\">\n                <INTRO_ITEM.icon size={16} className={activeTab === INTRO_ITEM.id ? \"animate-pulse\" : \"\"} />\n                {INTRO_ITEM.label}\n              </div>\n            </button>\n          </div>\n\n          {/* SECTION 2: DANH MỤC CƠ BẢN */}\n          <div className=\"text-xs font-bold text-slate-500 dark:text-slate-600 uppercase font-sans tracking-widest mb-2 px-2\">Danh mục thí nghiệm</div>\n          <div className=\"space-y-1 overflow-y-auto scrollbar-hide mb-4\">\n            {EXPERIMENTS.map((item) => (\n              <button\n                key={item.id}\n                onClick={() => {\n                  setActiveTab(item.id);\n                  if (window.innerWidth < 768) setIsSidebarOpen(false);\n                }}\n                className={`\n                  w-full text-left px-4 py-3 rounded border font-sans text-xs font-bold uppercase tracking-wide transition-all group relative overflow-hidden\n                  ${activeTab === item.id\n                    ? 'bg-sky-100 dark:bg-cyan-950/40 border-sky-300 dark:border-cyan-500/50 text-sky-700 dark:text-cyan-400 shadow-sm dark:shadow-[0_0_10px_rgba(6,182,212,0.1)]'\n                    : 'bg-transparent border-transparent text-slate-600 dark:text-slate-500 hover:bg-sky-50 dark:hover:bg-slate-900 hover:text-sky-600 dark:hover:text-cyan-300'}\n                `}\n              >\n                <div className=\"absolute inset-0 w-[150%] -translate-x-[120%] group-hover:translate-x-[100%] transition-transform duration-700 ease-out bg-gradient-to-r from-transparent via-sky-300/30 dark:via-cyan-400/20 to-transparent skew-x-12 pointer-events-none\" />\n                <div className=\"relative z-10 flex items-center gap-3\">\n                  <item.icon size={16} className={activeTab === item.id ? \"animate-pulse\" : \"\"} />\n                  {item.label}\n                </div>\n              </button>\n            ))}\n          </div>\n\n          {/* SECTION 3: USER MODULES */}\n\n\n          {/* CREATE NEW BUTTON */}\n          <div className=\"mt-auto pt-4 border-t border-slate-200 dark:border-slate-800/50 flex flex-col gap-3\">\n\n\n            <div className=\"p-3 rounded-lg bg-white/50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-800/60 text-center backdrop-blur-sm group hover:border-sky-300 dark:hover:border-cyan-500/30 transition-colors\">\n              <div className=\"text-xs text-slate-500 dark:text-slate-400 font-medium mb-1 font-sans\">\n                Dev & Designer by : <span className=\"text-slate-800 dark:text-slate-200 font-bold\">Hồ Hoàng Anh</span>\n              </div>\n              <div className=\"text-[10px] text-sky-600 dark:text-cyan-400 font-sans font-bold mt-0.5\">Class: A1 - K50</div>\n            </div>\n\n            <div className=\"text-[10px] text-slate-500 dark:text-slate-600 text-center font-medium pb-2\">\n              2025 © <span className=\"text-slate-600 dark:text-slate-500 hover:text-sky-600 dark:hover:text-cyan-500 cursor-pointer transition-colors\">Metronic Physics Theme</span>\n            </div>\n          </div>\n        </aside>\n\n        {/* CONTENT AREA */}\n        <main\n          ref={mainContentRef}\n          className=\"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-slate-800 scrollbar-track-transparent pr-2 pb-10\"\n        >\n          {isSidebarOpen && <div className=\"fixed inset-0 bg-black/50 z-40 md:hidden\" onClick={() => setIsSidebarOpen(false)}></div>}\n\n          <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-500 h-full\">\n            {renderContent()}\n          </div>\n        </main>\n      </div>\n    </LabLayout>\n  )\n}"],"names":[],"mappings":"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"}}]
}