{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///E:/test_python/vat-ly-11-lab/test/app/api/modules/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport fs from 'fs'\r\nimport path from 'path'\r\n\r\nexport async function GET() {\r\n    const publicDir = path.join(process.cwd(), 'public')\r\n    const listPath = path.join(publicDir, 'modules.json')\r\n\r\n    if (!fs.existsSync(listPath)) {\r\n        return NextResponse.json([])\r\n    }\r\n\r\n    try {\r\n        const fileContent = fs.readFileSync(listPath, 'utf8')\r\n        const modules = JSON.parse(fileContent)\r\n        return NextResponse.json(modules, {\r\n            headers: {\r\n                'Cache-Control': 'no-store, max-age=0'\r\n            }\r\n        })\r\n    } catch (error) {\r\n        return NextResponse.json([], { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const { name, description, code, language } = await request.json()\r\n\r\n        if (!name || !code) {\r\n            return NextResponse.json({ error: 'Name and Code are required' }, { status: 400 })\r\n        }\r\n\r\n        // Slugify name for filename\r\n        const timestamp = Date.now()\r\n        const cleanName = name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '') || 'untitled'\r\n        const slug = `${cleanName}-${timestamp}`\r\n        const fileName = `${slug}.html`\r\n        const publicDir = path.join(process.cwd(), 'public')\r\n        const userModulesDir = path.join(publicDir, 'user-modules')\r\n        const listPath = path.join(publicDir, 'modules.json')\r\n\r\n        // Ensure directory exists\r\n        if (!fs.existsSync(userModulesDir)) {\r\n            fs.mkdirSync(userModulesDir, { recursive: true })\r\n        }\r\n\r\n        // Generate content based on language\r\n        let finalCode = code\r\n        const lang = language || 'html'\r\n\r\n        if (lang === 'python') {\r\n            finalCode = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>${name}</title>\r\n    <meta charset=\"utf-8\">\r\n    <script src=\"https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js\"></script>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <style>body { background-color: #0f172a; color: #e2e8f0; font-family: monospace; padding: 24px; }</style>\r\n</head>\r\n<body>\r\n    <h1 class=\"text-xl font-bold text-cyan-400 mb-4\">Python Output:</h1>\r\n    <div id=\"output\" class=\"whitespace-pre-wrap bg-slate-900 p-4 rounded-lg border border-slate-700 shadow-inner min-h-[200px]\">Initializing Python environment...</div>\r\n    <script>\r\n        async function main() {\r\n            try {\r\n                const pyodide = await loadPyodide();\r\n                const outputDiv = document.getElementById(\"output\");\r\n                outputDiv.innerText = \"Python Ready.\\\\n------------------\\\\n\";\r\n                // Redirect stdout\r\n                pyodide.setStdout({ batched: (msg) => outputDiv.innerText += msg + \"\\\\n\" });\r\n                await pyodide.runPythonAsync(\\`${code.replace(/`/g, '\\\\`').replace(/\\${/g, '\\\\${')}\\`);\r\n            } catch (err) {\r\n                 document.getElementById(\"output\").innerText += \"\\\\nError:\\\\n\" + err;\r\n            }\r\n        }\r\n        main();\r\n    </script>\r\n</body>\r\n</html>`\r\n        } else if (lang === 'react') {\r\n            finalCode = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>${name}</title>\r\n    <meta charset=\"utf-8\">\r\n    <script src=\"https://unpkg.com/react@18/umd/react.development.js\" crossorigin></script>\r\n    <script src=\"https://unpkg.com/react-dom@18/umd/react-dom.development.js\" crossorigin></script>\r\n    <script src=\"https://unpkg.com/@babel/standalone/babel.min.js\"></script>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <style>body { background-color: #0f172a; color: white; margin: 0; min-height: 100vh; }</style>\r\n</head>\r\n<body>\r\n    <div id=\"root\"></div>\r\n    <script type=\"text/babel\">\r\n        ${code}\r\n    </script>\r\n</body>\r\n</html>`\r\n        }\r\n\r\n        // Write the HTML file\r\n        const filePath = path.join(userModulesDir, fileName)\r\n        fs.writeFileSync(filePath, finalCode, 'utf8')\r\n\r\n        // Update list\r\n        let modules = []\r\n        if (fs.existsSync(listPath)) {\r\n            try {\r\n                const fileContent = fs.readFileSync(listPath, 'utf8')\r\n                modules = JSON.parse(fileContent)\r\n            } catch (e) {\r\n                modules = []\r\n            }\r\n        }\r\n\r\n        const newModule = {\r\n            id: `user-${slug}`,\r\n            label: name,\r\n            description: description || '',\r\n            type: 'iframe',\r\n            path: `/user-modules/${fileName}`,\r\n            language: lang,\r\n            createdAt: new Date().toISOString()\r\n        }\r\n\r\n        modules.push(newModule)\r\n        fs.writeFileSync(listPath, JSON.stringify(modules, null, 2), 'utf8')\r\n\r\n        return NextResponse.json({ success: true, module: newModule })\r\n    } catch (error) {\r\n        console.error('Error creating module:', error)\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\nexport async function DELETE(request: Request) {\r\n    try {\r\n        const { id } = await request.json()\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ error: 'Module ID is required' }, { status: 400 })\r\n        }\r\n\r\n        const publicDir = path.join(process.cwd(), 'public')\r\n        const listPath = path.join(publicDir, 'modules.json')\r\n\r\n        if (!fs.existsSync(listPath)) {\r\n            return NextResponse.json({ error: 'Modules list not found' }, { status: 404 })\r\n        }\r\n\r\n        let modules = []\r\n        try {\r\n            const fileContent = fs.readFileSync(listPath, 'utf8')\r\n            modules = JSON.parse(fileContent)\r\n        } catch (e) {\r\n            return NextResponse.json({ error: 'Invalid modules data' }, { status: 500 })\r\n        }\r\n\r\n        const moduleToDelete = modules.find((m: any) => m.id === id)\r\n        if (!moduleToDelete) {\r\n            return NextResponse.json({ error: 'Module not found' }, { status: 404 })\r\n        }\r\n\r\n        // Delete the HTML file\r\n        if (moduleToDelete.path) {\r\n            const filePath = path.join(publicDir, moduleToDelete.path) // path starts with /\r\n            if (fs.existsSync(filePath)) {\r\n                fs.unlinkSync(filePath)\r\n            }\r\n        }\r\n\r\n        // Remove from list\r\n        modules = modules.filter((m: any) => m.id !== id)\r\n        fs.writeFileSync(listPath, JSON.stringify(modules, null, 2), 'utf8')\r\n\r\n        return NextResponse.json({ success: true })\r\n\r\n    } catch (error) {\r\n        console.error('Error deleting module:', error)\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}